/*
# mithgrid JavaScript Library v0.0.1
#
# Date: Tue Apr 3 15:51:37 2012 -0400
#
# (c) Copyright University of Maryland 2011-2012.  All rights reserved.
#
# (c) Copyright Texas A&M University 2010.  All rights reserved.
#
# 2. Redistributions in binary form must reproduce the above copyright
#    documentation and/or other materials provided with the distribution.
#
# 3. The name of the author may not be used to endorse or promote products
#    derived from this software without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
# IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
# OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
# IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
# NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
# DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
# THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
# THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
				#
				# Returns a list of item IDs in the set.
				#
				# Parameters: None.
				#
				# Returns:
				#
				# An array of item IDs.
				#
				# Adds an item ID to the set.
				#
				# Parameters:
				#
				# * item - item ID to be added to the set
				#
				# Returns:
				#
				# Removes the item ID from the set.
				#
				# Parameters:
				#
				# * item - item ID to be removed from the set
				#
				# Returns:
				#
				# Removes all items from the set.
				#
				# Parameters: None.
				#
				# Returns:
				#
				# Returns nothing.
				#
				# Calls a function with each item ID in the set. This will terminate if the called function returns the
				# "true" value.
				#
				# Parameters:
				#
				# * fn - function taking one argument (the item ID being visited)
				#
				#
				# Returns true if the item ID is in the set.
				#
				# Parameters:
				#
				# * o - item ID to be tested
				#
				# Returns:
				#
				# Returns the number of item IDs in the set.
				#
				# Parameters: None.
				#
				# Returns:
				#
				# The number of item IDs in the set.
				that
	
		
		# # Data Types
		#
		# This object type is used to encapsulate information about item types. Used within data store objects and parsed
		# expressions.
		#
		Data.namespace 'Type', (Type) ->
			Type.initInstance = (t) ->
					name: t
					custom: {}
		
		# # Data Properties
		#
		# This object type is used to encapsulate information about item properties. Used within data store objects and
		# parsed expressions.
		#
		Data.namespace 'Property', (Property) ->
				that =
					name: p
					getValueType: () ->
						that.valueType ? 'text'
		
		# # Data Store
		#
		# MITHGrid.Data.Store is a basic triple store that allows updating and deletion of triples.
		# Data stores are usually used as sources for data views.
		Data.namespace 'Store', (Store) ->
			# ## Store.initInstance
			#
			# Initializes a data store instance.
			#
			# Parameters:
			#
			# * options - object containing configuration options
			#
			#
			# The configured data store instance.
			#
			Store.initInstance = (options) ->
				quiesc_events = false
				set = Data.initSet()
				types = {}
				properties = {}
				spo = {}
		
				options ?= {}
	
				that = MITHGrid.initInstance "MITHGrid.Data.Store", options
	
				that.items = set.items
				
				that.contains = set.contains
				
				that.visit = set.visit
				
				#
				# Puts a triple into an index. This manages reference counting.
				#
				# Parameters:
				#
				# * index - the index to which the triple is added
				# * x, y, z - the triple to insert into the index (s,p,o or o,p,s)
				#
	
					counts = hash.counts[y]
	
					if !array?
						array = []
						hash.values[y] = array
					if !counts?
						counts = {}
						hash.counts[y] = counts
					else if z in array
						return
					array.push z
					counts[z] = 1
	
					#
					# Removes a triple from an index if the reference count is zero.
					#
					# Parameters:
					#
					# * index
					# * x, y, z
					#
	
						if counts[z] < 1
							i = $.inArray z, array
							if i == 0
								array = array[1...array.length]
							else if i == array.length - 1
								array = array[0 ... i]
							else if i > 0
								array = array[0 ... i].concat array[i + 1 ... array.length]
							if array.length > 0
							else
								delete hash.values[y]
							delete counts[z]
							# TODO: if counts empty, then we need to bubble up the deletion
							sum = 0
							for k, v of counts
								sum += v
							if sum == 0
								delete index[x]
					indexFn = (s, p, o) ->
						indexPut spo, s, p, o
						indexPut ops, o, p, s
	
				that.items = set.items
	
				that.addType = that.dataStore.addType
				
				#
				that.setKey = (k) ->
					key = k
					that.eventModelChange options.dataStore, options.dataStore.items()
	
				expressions = options.dataStore.prepare(options.expressions)
				
			#
			# Renders the given item using the appropriate lens.
			#
			# Parameters:
			#
			# c - DOM container into which the item should be rendered
			# m - data store or data view providing information for the item
			# i - the item ID
			#
			# Builds a standard HTML scaffold for facets.
			#
			# Parameters:
			#
			# * container - the DOM element in which to build the scaffolding
			# * options - an object holding the configuration options
			#
			# * .setSelectionCount(count)
			that.constructFacetFrame = (container, options) ->
				dom = {}
			
				$(container).addClass "mithgrid-facet"
				dom.header = $("<div class='header' />")
				if options.onClearAllSelections?
					dom.controls = $("<div class='control' title='Clear Selection'>")
					dom.counter = $("<span class='counter'></span>")
					dom.controls.append(dom.counter)
				dom.title = $("<span class='title'></span>")
				dom.title.text(options.facetLabel or "")
				dom.header.append(dom.title)
				dom.bodyFrame = $("<div class='body-frame'></div>")
				dom.body = $("<div class='body'></div>")
				dom.bodyFrame.append(dom.body)
			
				$(container).append(dom.header)
				$(container).append(dom.bodyFrame)
				if options.onClearAllSelections?
					dom.controls.bind "click", options.onClearAllSelections
			
				dom.setSelectionCount = (count) ->
					dom.counter.innerHTML = count
					if count > 0
						dom.counter.show()
					else
						dom.counter.hide()
				dom
		
			options.dataView.registerFilter that
		
			that
		
		Facet.namespace 'TextSearch', (TextSearch) ->
			# ## TextSearch Facet
			#
			TextSearch.initInstance = (container, options) ->
				that = Facet.initInstance("MITHGrid.Facet.TextSearch", container, options)
		
				options = that.options
		
				if options.expressions?
					if !$.isArray(options.expressions)
						options.expressions = [ options.expressions ]
						parsed = (MITHGrid.Expression.initParser().parse(ex) for ex in options.expressions)
				that.eventFilterItem = (dataSource, id) ->
					if that.text? and options.expressions?
						for ex in parsed
							items = ex.evaluateOnItem id, dataSource
							for v in items.values.items()
								if v.toLowerCase().indexOf(that.text) >= 0
									return
			
					return false
				that.eventModelChange = (dataView, itemList) ->
		
				that.selfRender = () ->
					dom = that.constructFacetFrame container, null,
						facetLabel: options.facetLabel
					$(container).addClass "mithgrid-facet-textsearch"
					inputElement = $("<input type='text'>")
					dom.body.append(inputElement)
					inputElement.keyup () ->
						that.events.onFilterChange.fire()
		
				that
	
		Facet.namespace 'List', (List) ->
			List.initInstance = (container, options) ->
				that = Facet.initInstance("MITHGrid.Facet.List", container, options)
		
							el = $(element).find(selector)
						return el
					return undefined
			
				binding.fastLocate = (internalSelector) ->
					selector = options.selectors[internalSelector]
					if selector?
						if bindingsCache[selector]?
							return bindingsCache[selector]
								bindingsCache[selector] = $(element).find(selector)
			
				binding.clearCache = () ->
					bindingsCache = { '': $(element) }
	
				binding
		
			initRaphaelBinding = (raphaelDrawing) ->
				binding = initDOMBinding raphaelDrawing.node
	
				superFastLocate = binding.fastLocate
				superRefresh = binding.refresh
				superBind = binding.bind
	
				binding.locate = (internalSelector) ->
					if internalSelector == 'raphael'
						raphaelDrawing
					else
						superLocate internalSelector
				binding.fastLocate = (internalSelector) ->
					if internalSelector == 'raphael'
						raphaelDrawing
					else
						superFastLocate internalSelector
	
				binding.refresh = (listOfSelectors) ->
					listOfSelectors = (s for s in listOfSelectors when s != 'raphael')
					superRefresh listOfSelectors
				binding
			
				#
				# See the section on #addFacet.
				#
				if options?.facets?
					for fName, fconfig of options.facets
						that.addFacet fName, fconfig
					
				#
				# See the section on #addComponent
				#
				if options?.components?
					for cName, cconfig of options.components
						that.addComponent cName, cconfig
						
				#
				# See the section on #addPresentation.
				#
				if options?.presentations?
					for pName, pconfig of options.presentations
						that.addPresentation pName, pconfig
		
				#
				# See the section on #addPlugin.
				#
				if options?.plugins?
					for pconfig in options.plugins
						that.addPlugin pconfig
				
			that.ready = (fn) -> onReady.push fn
			#
			# Adds a managed variable to the application object.
			#
			# Parameters:
			#
			# * varName - the name of the variable
			#
			# * config - object holding configuration options
			# * **event** - the name of the event associated with this variable. This event will fire when the value of the variable changes.
			#
			# * **setter** - the name of the method that will be used to set the variable. This defaults to 'set' + varName.
			#
			# * **getter** - the name of the method that will be used to retrieve the variable. This defaults to 'get' + varName.
			#
			# * **validate** - a function that will be called to validate the value the variable is being set to. This function
			#              should expect the new value and return "true" or "false".
			#
			# * **filter** - a function that will be called to filter the value the variable is being set to. This function
			#            options are set, the filter will be run before the validate function.
			#
			that.addVariable = (varName, config) ->
				value = config.default
				config.is or= 'rw'
				if config.is in ['rw', 'w']
					filter = config.filter
					validate = config.validate
					eventName = config.event || ('on' + varName + 'Change')
					that.events[eventName] = MITHGrid.initEventFirer()
					if filter?
						if validate?
							that[setName] = (v) ->
								v = validate filter v
								if value != v
									value = v
									that.events[eventName].fire(value)
						else
								v = filter v
								if value != v
									value = v
									that.events[eventName].fire(value)
					else
						if validate?
							that[setName] = (v) ->
								v = validate v
								if value != v
									that.events[eventName].fire(value)
						else
							that[setName] = (v) ->
								if value != v
									value = v
									that.events[eventName].fire(value)
				if config.is in ['r', 'rw']
					getName = config.getter || ('get' + varName)
					that[getName] = () -> value
			#
			# Adds a data store to the application.
			#
			# Parameters:
			#
			# * storeName - name for the data store
			#
			# * config - object holding configuration options
					store.addProperty 'type',
					store.addProperty 'id',
						valueType: 'text'
				else
					store = that.dataStore[storeName]
	
				if config?.types?
					store.addType type for type, typeInfo of config.types
	
				if config?.properties?
		
			#
			# Adds a data view to the application.
			#
			# Parameters:
			#
			# * viewName - name for the data view
			#
			# * viewConfig - object holding configuration options
			# See the documentation for the particular data view type for other configuration options.
			that.addDataView = (viewName, viewConfig) ->
				if viewConfig.type? and viewConfig.type.initInstance?
					initFn = viewConfig.type.initInstance
				else
					initFn = MITHGrid.Data.View.initInstance
				viewOptions =
					dataStore: that.dataStore[viewConfig.dataStore] || that.dataView[viewConfig.dataStore]
		
				if !that.dataView[viewName]?
						if k != "type" && !viewOptions[k]
							viewOptions[k] = v
				
					view = initFn viewOptions
					that.dataView[viewName] = view
		
			#
			# Adds a controller to the application.
			#
			# Parameters:
			#
			# * cName - name for the controller
			#
			# * cconfig - object holding configuration options
			#
			# Adds a facet to the application.
			#
			# Parameters:
			#
			# * fName - name of the facet
			#
			# * fconfig - object holding configuration options
					foptions.application = that
					facet = fconfig.type.initFacet fcontainer, foptions
					that.facet[fName] = facet
					facet.selfRender()
		
			#
			# Adds a component to the application. Components tie together renderings with controllers, but do not base
			# their DOM content on data. Components are good for things like bounding boxes used by a presentation, menus,
			# or other UI elements that might be considered chrome.
			#
			# Parameters:
			#
			# * cName - name of the component
					coptions.application = that
						coptions.components = {}
						for ccName, cconfig of cconfig.components
							if typeof cconfig == "string"
								coptions.components[ccName] = that.component[ccName]
							else
								ccoptions = $.extend(true, {}, ccconfig)
								ccoptions.application = that
								coptions.components[ccName] = cconfig.type.initInstance ccoptions
					if cconfig.controllers?
						for ccName, cconfig of pconfig.controllers
							if typeof cconfig == "string"
								coptions.controllers[ccName] = that.controller[ccName]
							else
								ccoptions = $.extend(true, {}, ccconfig)
								ccoptions.application = that
								coptions.controllers[ccName] = cconfig.type.initController ccoptions
	
					that.component[cName] = cconfig.type.initInstance ccontainer, coptions
			#
			# Adds a presentation to the application.
			#
			# Parameters:
			#
			# * pName - name of the presentation
			#
			# * pconfig - object holding configuration options
					if pconfig.components?
						for ccName, cconfig of pconfig.components
							if typeof cconfig == "string"
								poptions.components[ccName] = that.component[ccName]
							else
								ccoptions = $.extend(true, {}, ccconfig)
								ccoptions.application = that
								poptions.components[ccName] = cconfig.type.initInstance ccoptions
					if pconfig.controllers?
						poptions.controllers = {}
							if typeof cconfig == "string"
								poptions.controllers[cName] = that.controller[cName]
							else
								coptions = $.extend(true, {}, cconfig)
								coptions.application = that
								poptions.controllers[cName] = cconfig.type.initController coptions
			
					presentation = pconfig.type.initPresentation pcontainer, poptions
					that.presentation[pName] = presentation
				
			#
			# Adds a plugin to the application.
			#
			# Parameters:
			#
			# * pconf - object holding configuration options
			#
			# Returns: Nothing.
							# add
	
							plugin.dataView.addProperty prop, propOptions for prop, propOptions of plugin.getProperties()
	
						for pname, prconfig of plugin.getPresentations()
							proptions = $.extend(true, {}, prconfig.options)
							pcontainer = $(container).find(prconfig.container)
							#pcontainer = $("#" + $(container).attr('id') + ' > ' + prconfig.container)
							pcontainer = pcontainer[0] if $.isArray(pcontainer)
	
							if prconfig.dataView?
								proptions.dataView = that.dataView[prconfig.dataView] 
							else if pconfig.dataView?
								proptions.dataView = that.dataView[pconfig.dataView]
							proptions.application = that
							presentation = prconfig.type.initPresentation pcontainer, proptions
							plugin.presentation[pname] = presentation
							presentation.selfRender()
		
	
			#
			# Finishes configuring the application by running all queued or pending functions registered through
			# the #ready() method. The #ready() method will be redefined to run functions after the current thread
			# finishes.
			that.run = () ->
				$(document).ready () ->
					fn() for fn in onReady						
					onReady = []
	    #
	    #    var that = MITHGrid.Plugin.initPlugin('MyPlugin', options, { ... })
	    #  };
	    #
	    #  var myApp = MITHGrid.Application({
	    #    plugins: [ { name: 'MyPlugin', ... } ]
	    #  });
		#
		
		exports.initPlugin = (klass, options) ->
			readyFns = [ ]
		
			that.getTypes = () ->
				if options?.types?
					options.types
				else
					[ ]
		
			that.getProperties = () ->
					options.properties
				else
					[ ]
					
			that.getComponents = () ->
				if options?.components?
					options.components
				else
					[ ]
			that.getPresentations = () ->
				if options?.presentations?
					options.presentations
				else
					[ ]
		
			that.ready = readyFns.push
		
			that.eventReady = (app) ->
					fn app
				readyFns = []
				that.ready = (fn) ->
					fn app
		
			that


	# Here, we have our deprecated ways of referring to initializers
	MITHGrid.initView = MITHGrid.initInstance
	MITHGrid.Data.initSet = MITHGrid.Data.Set.initInstance
	MITHGrid.Data.initType = MITHGrid.Data.Type.initInstance
	MITHGrid.Data.initProperty = MITHGrid.Data.Property.initInstance
	MITHGrid.Data.initStore = MITHGrid.Data.Store.initInstance
	MITHGrid.Data.initView = MITHGrid.Data.View.initInstance
	MITHGrid.Controller.initController = MITHGrid.Controller.initInstance
	MITHGrid.Controller.initRaphaelController = MITHGrid.Controller.initController
	MITHGrid.Presentation.initPresentation = MITHGrid.Presentation.initInstance
	MITHGrid.Application.initApp = MITHGrid.Application.initInstance
	
)(jQuery, MITHGrid)

MITHGrid.defaults "MITHGrid.Data.Store",
    events:
        onModelChange: null
        onBeforeLoading: null
        onAfterLoading: null
        onAfterUpdating: null

MITHGrid.defaults "MITHGrid.Data.View",
    events:
        onModelChange: null
        onFilterItem: "preventable"

MITHGrid.defaults "MITHGrid.Data.SubSet",
 */
/*
# mithgrid JavaScript Library v0.0.1
#
# Date: Tue Apr 3 15:51:37 2012 -0400
#
# (c) Copyright University of Maryland 2011-2012.  All rights reserved.
#
# (c) Copyright Texas A&M University 2010.  All rights reserved.
#
# Portions of this code are copied from The SIMILE Project:
#  (c) Copyright The SIMILE Project 2006. All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
#
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
#
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
#
# 3. The name of the author may not be used to endorse or promote products
#    derived from this software without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
# IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
# OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
# IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
# INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
# NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
# DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
# THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
# THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
(function(){var a,b,c,d,e=Array.prototype.slice,f=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};a=(c=this.MITHGrid)!=null?c:this.MITHGrid={},b=(d=this.jQuery)!=null?d:this.jQuery={},function(a,b){var c,d,g,h;(typeof window!="undefined"&&window!==null?(h=window.console)!=null?h.log:void 0:void 0)!=null?b.debug=window.console.log:b.debug=function(){},b.error=function(){b.debug.call({},arguments);return{arguments:arguments}},b.namespace=function(a,c){return d(b,a,c)},d=function(a,c,e){var f,g;f=c.split(".");while(f.length>1)a[f[0]]||(a=d(a,f[0]),f.shift());a[f[0]]==null&&(g={namespace:function(a,b){return d(g,a,b)},debug:b.debug}),a[f[0]]=g,e!=null&&e(a[f[0]]);return a[f[0]]},b.globalNamespace=function(a,c){var e,f,g;e=window,e[a]||(e[a]={}),(f=e[a]).debug||(f.debug=b.debug),(g=e[a]).namespace||(g.namespace=function(b,c){return d(e[a],b,c)}),c!=null&&c(e[a]);return e[a]},b.normalizeArgs=function(b,c,d,e){e==null&&a.isPlainObject(d)&&(e=d,d=void 0),d==null&&typeof c!="string"&&(a.isArray(c)||(d=c,c=[])),e==null?typeof c=="string"?(c=[c,b],e={}):a.isArray(c)?(c.push(b),e={}):(e=c,c=b):typeof c=="string"?c=[c,b]:a.isArray(c)?c.push(b):c=b;return[c,d,e]},c={},b.defaults=function(b,d){c[b]||(c[b]={});return c[b]=a.extend(!0,c[b],d)},b.initSynchronizer=function(a){var b,c,d,e;e={},b=1,c=!1,d=!1,a.done==null?(e.increment=function(){},e.decrement=e.increment,e.done=e.increment,e.add=function(a){}):(e.increment=function(){return b+=1},e.add=function(a){return b+=a},e.decrement=function(){b-=1,b<=0&&c&&!d&&(setTimeout(a.done,0),d=!0);return b},e.done=function(){c=!0;return e.decrement()});return e},b.initEventFirer=function(a,b){var c,d;d={},d.isPreventable=a,d.isUnicast=b,c=[],d.addListener=function(a,b){return c.push([a,b])},d.removeListener=function(a){var b;return typeof a=="string"?c=function(){var d,e,f;f=[];for(d=0,e=c.length;d<e;d++)b=c[d],b[1]!==a&&f.push(b);return f}():c=function(){var d,e,f;f=[];for(d=0,e=c.length;d<e;d++)b=c[d],b[0]!==a&&f.push(b);return f}()},b?d.fire=function(){var a,b;a=1<=arguments.length?e.call(arguments,0):[];if(c.length<=0)return!0;try{return(b=c[0])[0].apply(b,a)}catch(d){return console.log(d)}}:a?d.fire=function(){var a,b,d,f,g,h;a=1<=arguments.length?e.call(arguments,0):[],f=!0;for(g=0,h=c.length;g<h;g++){d=c[g],b=d[0];try{f=b.apply(null,a)}catch(i){console.log(i)}if(f===!1)return!1}return!0}:d.fire=function(){var a,b,d,f;a=1<=arguments.length?e.call(arguments,0):[];for(d=0,f=c.length;d<f;d++){b=c[d];try{b[0].apply(b,a)}catch(g){console.log(b[0],a,g)}}return!0};return d},g=0,b.initInstance=function(d,e,h){var i,j,k,l,m,n,o,p,q;h==null&&(h=e,e=void 0),h==null&&typeof d!="string"&&!a.isArray(d)&&(h=d,d=null),n={},m={};if(d!=null){typeof d=="string"&&(d=[d]),d.reverse();for(o=0,p=d.length;o<p;o++){l=d[o],i=l.split("."),l=i.shift(),m=a.extend(!0,{},c[l]||{});while(i.length>0)l=l+"."+i.shift(),m=a.extend(!0,m,c[l]||{})}}m=a.extend(!0,m,h||{}),g+=1,n.id=g,n.options=m,n.container=e,n.events={};if(n.options.events!=null){q=n.options.events;for(k in q)j=q[k],j!=null?typeof j=="string"&&(j=[j]):j=[],n.events[k]=b.initEventFirer(f.call(j,"preventable")>=0,f.call(j,"unicast")>=0)}return n},b.namespace("Data",function(c){c.namespace("Set",function(a){return a.initInstance=function(a){var b,c,d,e,f,g,h,i;g={},d={},b=0,f=!0,e=[],g.isSet=!0,g.items=function(){var a;if(f){e=[];for(a in d)typeof a=="string"&&d[a]===!0&&e.push(a)}return e},g.add=function(a){if(d[a]==null){d[a]=!0,f=!0;return b+=1}},g.remove=function(a){if(d[a]!=null){delete d[a],f=!0;return b-=1}},g.empty=function(){d={},b=0,f=!1,e=[];return},g.visit=function(a){var b,c;c=[];for(b in d){if(a(b)===!0)break;c.push(void 0)}return c},g.contains=function(a){return d[a]!=null},g.size=function(){return f?g.items().length:e.length};if(a instanceof Array)for(h=0,i=a.length;h<i;h++)c=a[h],g.add(c);return g}}),c.namespace("Type",function(a){return a.initInstance=function(a){var b;return b={name:a,custom:{}}}}),c.namespace("Property",function(a){return a.initInstance=function(a){var b;return b={name:a,getValueType:function(){var a;return(a=b.valueType)!=null?a:"text"}}}}),c.namespace("Store",function(d){return d.initInstance=function(d){var e,g,h,i,j,k,l,m,n,o;k=!1,l=c.initSet(),o={},j={},m={},i={},d==null&&(d={}),n=b.initInstance("MITHGrid.Data.Store",d),n.items=l.items,n.contains=l.contains,n.visit=l.visit,n.size=l.size,h=function(a,b,c,d){var e,g,h;h=a[b],h==null&&(h={values:{},counts:{}},a[b]=h),e=h.values[c],g=h.counts[c],e==null&&(e=[],h.values[c]=e);if(g==null)g={},h.counts[c]=g;else if(f.call(e,d)>=0){g[d]+=1;return}e.push(d);return g[d]=1},g=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n;g=a[b];if(g!=null){f=g.values[c];if(f!=null){if(e!=null){m=[];for(i=0,k=f.length;i<k;i++)h=f[i],e.contains(h)?m.push(d.add(h)):m.push(void 0);return m}n=[];for(j=0,l=f.length;j<l;j++)h=f[j],n.push(d.add(h));return n}}},e=function(a,b,d,e,f){e==null&&(e=c.initSet()),b.visit(function(b){return g(a,b,d,e,f)});return e},n.addProperty=function(a,b){var d;d=c.initProperty(a),(b!=null?b.valueType:void 0)!=null&&(d.valueType=b.valueType,j[a]=d);return d},n.getProperty=function(a){var b;return(b=j[a])!=null?b:c.initProperty(a)},n.addType=function(a,b){var d;d=c.initType(a),o[a]=d;return d},n.getType=function(a){var b;return(b=o[a])!=null?b:c.initType(a)},n.getItem=function(a){var b,c;return(b=(c=m[a])!=null?c.values:void 0)!=null?b:{}},n.getItems=function(b){if(!a.isArray(b))return[n.getItem(b)];return a.map(b,function(a,b){return n.getItem(a)})},n.removeItems=function(b,c){var d,e,f,g,h,j,k,o;e=[],f=function(b,c,d,e){var f,g,h,i,j,k,l;h=b[c];if(h!=null){f=h.values[d],g=h.counts[d];if(f==null||g==null)return;g[e]-=1;if(g[e]<1){i=a.inArray(e,f),i===0?f=f.slice(1,f.length):i===f.length-1?f=f.slice(0,i):i>0&&(f=f.slice(0,i).concat(f.slice(i+1,f.length))),f.length>0?h.values[d]=f:delete h.values[d],delete g[e],k=0;for(j in g)l=g[j],k+=l;if(k===0)return delete b[c]}}},g=function(a,b,c){f(m,a,b,c);return f(i,c,b,a)},j=function(a,b,c){var d,e,f,h;h=[];for(e=0,f=c.length;e<f;e++)d=c[e],h.push(g(a,b,d));return h},h=function(b){var c,d,e,f;c=n.getItem(b),f=c.type,a.isArray(f)&&(f=f[0]);for(e in c){d=c[e];if(typeof e!="string"||e==="id"||e==="type")continue;j(b,e,d)}return j(b,"type",[f])};for(k=0,o=b.length;k<o;k++)d=b[k],h(d),e.push(d),l.remove(d);n.events.onModelChange.fire(n,e);if(c!=null)return c()},n.updateItems=function(b,c){var d,e,f,g,j,k,l,o;f=[],j=function(b,c,d,e){var f,g,h,i;h=b[c];if(h!=null){f=h.values[d],g=h.counts[d];if(f==null||g==null)return;g[e]-=1;if(g[e]<1){i=a.inArray(e,f),i===0?f=f.slice(1,f.length):i===f.length-1?f=f.slice(0,i):i>0&&(f=f.slice(0,i).concat(f.slice(i+1,f.length))),f.length>0?h.values[d]=f:delete h.values[d];return delete g[e]}}},g=function(a,b,c){h(m,a,b,c);return h(i,c,b,a)},k=function(a,b,c){j(m,a,b,c);return j(i,c,b,a)},o=function(b){var c,d,e,f,h,i,j,l,m,o;d=b.id,o=b.type,c=!1,e=function(a,b){var c,d,e;d=!0;if(a.length!==b.length)return!1;for(c=0,e=a.length;0<=e?c<e:c>e;0<=e?c++:c--)a[c]!==b[c]&&(d=!1);return d},l=function(a,b,c){var d,e,f,g;g=[];for(e=0,f=c.length;e<f;e++)d=c[e],g.push(k(a,b,d));return g},j=function(a,b,c){var d,e,f,h;h=[];for(e=0,f=c.length;e<f;e++)d=c[e],h.push(g(a,b,d));return h},a.isArray(d)&&(d=d[0]),a.isArray(o)&&(o=o[0]),h=n.getItem(d);for(i in b){f=b[i];if(typeof i!="string"||i==="id"||i==="type")continue;a.isArray(f)||(f=[f]),m=f.length,h[i]==null?(j(d,i,f),c=!0):e(f,h[i])||(c=!0,l(d,i,h[i]),j(d,i,f))}return c},n.events.onBeforeUpdating.fire(n),l=b.length,d=parseInt(l/100,10),d>200&&(d=200),d<1&&(d=1),e=function(a){var g,h,i;g=a+d,g>l&&(g=l);for(i=a;a<=g?i<g:i>g;a<=g?i++:i--)h=b[i],typeof h=="object"&&o(h)&&f.push(h.id);if(g<l)return setTimeout(function(){return e(g)},0);n.events.onAfterUpdating.fire(n),n.events.onModelChange.fire(n,f);if(c!=null)return c()};return e(0)},n.loadItems=function(c,d){var e,f,g,j,k,o;g=[],j=function(a,b,c){h(m,a,b,c);return h(i,c,b,a)},k=function(c){var d,e,f,h,i,k;if(c.id==null)throw b.error("Item entry has no id: ",c);if(c.type==null)throw b.error("Item entry has no type: ",c);d=c.id,f=c.type,a.isArray(d)&&(d=d[0]),a.isArray(f)&&(f=f[0]),l.add(d),g.push(d),j(d,"type",f),j(d,"id",d),k=[];for(e in c){h=c[e];if(typeof e!="string")continue;e!=="id"&&e!=="type"?a.isArray(h)?k.push(function(){var a,b,c;c=[];for(a=0,b=h.length;a<b;a++)i=h[a],c.push(j(d,e,i));return c}()):h!=null?k.push(j(d,e,h)):k.push(void 0):k.push(void 0)}return k},n.events.onBeforeLoading.fire(n),o=c.length,d!=null?(e=parseInt(o/100,10),e>200&&(e=200)):e=o,e<1&&(e=1),f=function(a){var b,h,i;b=a+e,b>o&&(b=o);for(i=a;a<=b?i<b:i>b;a<=b?i++:i--)h=c[i],typeof h=="object"&&k(h);if(b<o)return setTimeout(function(){return f(b)},0);n.events.onAfterLoading.fire(n),n.events.onModelChange.fire(n,g);if(d!=null)return setTimeout(d,0)};return f(0)},n.prepare=function(a){var c,d,e,f;e=b.Expression.initParser(),d=function(){var b,d,f;f=[];for(b=0,d=a.length;b<d;b++)c=a[b],f.push(e.parse(c));return f}(),f=void 0;return{evaluate:function(a){var b,c,e,g,h;c=[],f=void 0,e=function(b){var d;d=b.evaluateOnItem(a,n),f||(f=d.valueType);return c=c.concat(d.values.items())};for(g=0,h=d.length;g<h;g++)b=d[g],e(b);return c},valueType:function(){return f}}},n.getObjectsUnion=function(a,b,c,d){return e(m,a,b,c,d)},n.getSubjectsUnion=function(a,b,c,d){return e(i,a,b,c,d)},n.registerPresentation=function(a){n.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)});return a.eventModelChange(n,n.items())};return n}}),c.namespace("View",function(a){return a.initInstance=function(a){var d,e,g,h,i,j,k,l,m,n;l=b.initView("MITHGrid.Data.View",a),j=c.initSet(),e=function(a){return!1!==l.events.onFilterItem.fire(l.dataStore,a)},g=function(a){var b,c,d,f;d=l.dataStore.items(),f=d.length;if(f===0)a();else{f>200?(b=parseInt(f/100,10),b>200&&(b=200)):b=f,b<1&&(b=1),c=function(g){var h,i,k;h=g+b,h>f&&(h=f);for(i=g;g<=h?i<h:i>h;g<=h?i++:i--)k=d[i],e(k)?j.add(k):j.remove(k);if(h<f)return setTimeout(function(){return c(h)},0);l.items=j.items,l.size=j.size,l.contains=j.contains,l.visit=j.visit;if(a!=null)return setTimeout(a,0)};return c(0)}},l.registerFilter=function(a){l.events.onFilterItem.addListener(function(b,c){return a.eventFilterItem(b,c)}),l.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)});return a.events.onFilterChange.addListener(l.eventFilterChange)},l.registerPresentation=function(a){l.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)});return g(function(){return a.eventModelChange(l,l.items())})},l.items=j.items,l.contains=j.contains,l.visit=j.visit,l.size=j.size,l.eventFilterChange=function(){var a;a=c.initSet(l.items());return g(function(){var b,d,e,f,g,h,i,j;b=c.initSet(),i=a.items();for(e=0,g=i.length;e<g;e++)d=i[e],l.contains(d)||b.add(d);j=l.items();for(f=0,h=j.length;f<h;f++)d=j[f],a.contains(d)||b.add(d);if(b.size()>0)return l.events.onModelChange.fire(l,b.items())})},l.eventModelChange=function(a,b){var d,f,g,h;d=c.initSet();for(g=0,h=b.length;g<h;g++)f=b[g],a.contains(f)?e(f)?(j.add(f),d.add(f)):j.contains(f)&&(d.add(f),j.remove(f)):(d.add(f),j.remove(f));if(d.size()>0)return l.events.onModelChange.fire(l,d.items())},(a!=null?(m=a.types)!=null?m.length:void 0:void 0)>0&&function(a){return l.registerFilter({eventFilterItem:function(b,c){var d,e,g,h;d=b.getItem(c);if(d.type==null)return!1;for(g=0,h=a.length;g<h;g++){e=a[g];if(f.call(d.type,e)>=0)return}return!1},eventModelChange:function(a,b){},events:{onFilterChange:{addListener:function(a){}}}})}(a.types),(a!=null?(n=a.filters)!=null?n.length:void 0:void 0)>0&&function(a){var c,d,e;e=b.Expression.initParser(),d=function(){var b,d,f;f=[];for(b=0,d=a.length;b<d;b++)c=a[b],f.push(e.parse(c));return f}();return l.registerFilter({eventFilterItem:function(a,b){var c,e,f,g,h,i,j;for(g=0,i=d.length;g<i;g++){c=d[g],f=c.evaluateOnItem(b,a),f=f.values.items();for(h=0,j=f.length;h<j;h++){e=f[h];if(e!=="false")return}}return!1},eventModelChange:function(a,b){},events:{onFilterChange:{addListener:function(a){}}}})}(a.filters),(a!=null?a.collection:void 0)!=null&&l.registerFilter({eventFilterItem:a.collection,eventModelChange:function(a,b){},events:{onFilterChange:{addListener:function(a){}}}}),(a!=null?a.expressions:void 0)!=null&&(d=a.dataStore.prepare(a.expressions),i=l.eventModelChange,h=b.Data.initStore({}),k=b.Data.initSet(),l.eventModelChange=function(a,c){var e,g,j,l,m,n,o,p,q,r,s,t,u;m=[],o=[],j=b.Data.initSet(),j=h.getObjectsUnion(k,"mapsTo",j);for(q=0,s=c.length;q<s;q++){e=c[q];if(j.contains(e))m.push(e),a.contains(e)||(g=b.Data.initSet(),h.getSubjectsUnion(b.Data.initSet([e]),"mapsTo",g),g.visit(function(a){var b,c,d;c=h.getItem(a),d=c.mapsTo;if(d!=null){b=d.indexOf(e),b===0?d=d.slice(1,d.length):b===d.length-1?d=d.slice(0,d.length-1):b>-1&&(d=d.slice(0,b).concat(d.slice(b+1,d.length)));return h.updateItems([{id:a,mapsTo:d}])}}));else if(a.contains(e)){n=b.Data.initSet(),u=d.evaluate([e]);for(r=0,t=u.length;r<t;r++)p=u[r],n.add(p);h.contains(e)?h.updateItems([{id:e,mapsTo:n.items()}]):h.loadItems([{id:e,mapsTo:n.items()}])}else m=m.concat(h.getItem(e).mapsTo),o.push(e)}o.length>0&&h.removeItems(o),j=b.Data.initSet(),h.getObjectsUnion(k,"mapsTo",j),m=function(){var a,b,d;d=[];for(a=0,b=m.length;a<b;a++)l=m[a],f.call(c,l)>=0&&d.push(l);return d}();return i(j,m)}),l.dataStore=a.dataStore,l.getItems=l.dataStore.getItems,l.getItem=l.dataStore.getItem,l.removeItems=l.dataStore.removeItems,l.updateItems=l.dataStore.updateItems,l.loadItems=l.dataStore.loadItems,l.prepare=l.dataStore.prepare,l.addType=l.dataStore.addType,l.getType=l.dataStore.getType,l.addProperty=l.dataStore.addProperty,l.getProperty=l.dataStore.getProperty,l.getObjectsUnion=l.dataStore.getObjectsUnion,l.getSubjectsUnion=l.dataStore.getSubjectsUnion,l.dataStore.events.onModelChange.addListener(l.eventModelChange),l.eventModelChange(l.dataStore,l.dataStore.items());return l}}),c.namespace("SubSet",function(a){return a.initInstance=function(a){var d,e,f,g;g=b.initView("MITHGrid.Data.SubSet",a),a=g.options,e=a.key,f=c.initSet(),g.items=f.items,g.contains=f.contains,g.visit=f.visit,g.size=f.size,g.setKey=function(b){e=b;return g.eventModelChange(a.dataStore,a.dataStore.items())},d=a.dataStore.prepare(a.expressions),g.eventModelChange=function(a,b){var h,i,j,k,l;e!=null?j=c.initSet(d.evaluate([e])):j=c.initSet(),h=[];for(k=0,l=b.length;k<l;k++)i=b[k],f.contains(i)?(h.push(i),j.contains(i)||f.remove(i)):j.contains(i)&&(f.add(i),h.push(i));if(h.length>0)return g.events.onModelChange.fire(g,h)},g.dataStore=a.dataStore,g.getItems=g.dataStore.getItems,g.getItem=g.dataStore.getItem,g.removeItems=g.dataStore.removeItems,g.fetchData=g.dataStore.fetchData,g.updateItems=g.dataStore.updateItems,g.loadItems=g.dataStore.loadItems,g.prepare=g.dataStore.prepare,g.addType=g.dataStore.addType,g.getType=g.dataStore.getType,g.addProperty=g.dataStore.addProperty,g.getProperty=g.dataStore.getProperty,g.getObjectsUnion=g.dataStore.getObjectsUnion,g.getSubjectsUnion=g.dataStore.getSubjectsUnion,g.dataStore.events.onModelChange.addListener(g.eventModelChange),g.eventModelChange(g.dataStore,g.dataStore.items()),g.registerPresentation=function(a){g.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)});return setTimeout(function(){return a.eventModelChange(g,g.items())},0)};return g}}),c.namespace("ListPager",function(a){return a.initInstance=function(a){var d,e,g,h,i,j,k,l;l=b.initInstance("MITHGrid.Data.ListPager",a),a=l.options,e=[],g=0,h=-1,i=void 0,j=void 0,d=function(a){return e.indexOf(a)},k=c.initSet(),l.items=k.items,l.size=k.size,l.contains=k.contains,l.visit=k.visit,l.dataStore=a.dataStore,l.getItems=l.dataStore.getItems,l.getItem=l.dataStore.getItem,l.removeItems=l.dataStore.removeItems,l.fetchData=l.dataStore.fetchData,l.updateItems=l.dataStore.updateItems,l.loadItems=l.dataStore.loadItems,l.prepare=l.dataStore.prepare,l.addType=l.dataStore.addType,l.getType=l.dataStore.getType,l.addProperty=l.dataStore.addProperty,l.getProperty=l.dataStore.getProperty,l.getObjectsUnion=l.dataStore.getObjectsUnion,l.getSubjectsUnion=l.dataStore.getSubjectsUnion,l.setList=function(a){var b,c,d,i,j,m,n,o,p;e=a,b=[];for(d=0,j=e.length;d<j;d++)c=e[d],l.dataStore.contains(c)&&!k.contains(c)?g<=(n=e.indexOf(c))&&n<h&&(b.push(c),k.add(c)):k.contains(c)&&!l.dataStore.contains(c)&&(b.push(c),k.remove(c));o=k.items();for(i=0,m=o.length;i<m;i++){c=o[i];if((p=!c,f.call(e,p)>=0)||!l.dataStore.contains(c))b.push(c),k.remove(c)}if(b.length>0)return l.events.onModelChange.fire(l,b)},l.eventModelChange=function(a,b){var c,e,f,i,j;c=[];for(i=0,j=b.length;i<j;i++)e=b[i],a.contains(e)?(f=d(e),k.contains(e)?(c.push(e),(g>f||f>=h)&&k.remove(e)):g<=f&&f<h&&(k.add(e),c.push(e))):(k.remove(e),c.push(e));if(c.length>0)return l.events.onModelChange.fire(l,c)},l.setKeyRange=function(a,b){var d,f,i,j;a<b?(g=a,h=b):(g=b,h=a),j=k,d=c.initSet(),k=c.initSet(),l.items=k.items,l.size=k.size,l.contains=k.contains,l.visit=k.visit;if(g<h)for(f=g;g<=h?f<=h:f>=h;g<=h?f++:f--)i=e[f],j.contains(i)||d.add(i),k.add(i);j.visit(function(a){if(!k.contains(a))return d.add(a)});if(d.size()>0)return l.events.onModelChange.fire(l,d.items())},l.dataStore.registerPresentation(l),l.registerPresentation=function(a){l.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)});return a.eventModelChange(l,l.items())};return l}}),c.namespace("Pager",function(a){return a.initInstance=function(a){var d,e,f,g,h,i,j,k,l,m,n;n=b.initInstance("MITHGrid.Data.Pager",a),a=n.options,h=[],i=-1,j=-1,k=void 0,l=void 0,f=function(a){var b,c,d;if(a==null)return 0;b=0;if(a!=null){d=h.length-1;while(b<d)c=~~((b+d)/2),h[c][0]<a?b=c+1:h[c][0]===a?d=c:d=c-1}return b},g=function(a){var b,c,d;if(a==null)return h.length-1;b=0,d=h.length-1;if(a!=null)while(b<d)c=~~((b+d)/2),h[c][0]>a?d=c-1:b=c+1;return d},e=function(a){var b,c;for(b=0,c=h.length;0<=c?b<c:b>c;0<=c?b++:b--)if(h[b][1]===a)return b;return-1},m=c.initSet(),n.items=m.items,n.size=m.size,n.contains=m.contains,n.visit=m.visit,n.dataStore=a.dataStore,n.getItems=n.dataStore.getItems,n.getItem=n.dataStore.getItem,n.removeItems=n.dataStore.removeItems,n.fetchData=n.dataStore.fetchData,n.updateItems=n.dataStore.updateItems,n.loadItems=n.dataStore.loadItems,n.prepare=n.dataStore.prepare,n.addType=n.dataStore.addType,n.getType=n.dataStore.getType,n.addProperty=n.dataStore.addProperty,n.getProperty=n.dataStore.getProperty,n.getObjectsUnion=n.dataStore.getObjectsUnion,n.getSubjectsUnion=n.dataStore.getSubjectsUnion,d=n.prepare(a.expressions),n.eventModelChange=function(a,b){var c,o,p,q,r,s,t;c=[];for(s=0,t=b.length;s<t;s++)p=b[s],a.contains(p)?(r=d.evaluate(p),r.length>0?(d.valueType()==="numeric"?q=parseFloat(r[0]):q=r[0],m.contains(p)?(o=e(p),o===-1?h.push([q,p]):h[o][0]=q,c.push(p),(k!=null&&q<k||l!=null&&q>l)&&m.remove(p)):(h.push([q,p]),(k==null||q>=k)&&(l==null||q<=l)&&(m.add(p),c.push(p)))):m.contains(p)&&(o=e(p),o===0?h=h.slice(1,h.length):o===h.length-1?h=h.slice(0,h.length-1):o!==-1&&(h=h.slice(0,o).concat(h.slice(o+1,h.length))),m.remove(p),c.push(p))):(m.remove(p),c.push(p));h.sort(function(a,b){if(a[0]<b[0])return-1;if(a[0]>b[0])return 1;return 0}),i=f(k),j=g(l);if(c.length>0)return n.events.onModelChange.fire(n,c)},n.setKeyRange=function(a,b){var d,e,o,p;a!=null&&b!=null?a<b?(k=a,l=b):(k=b,l=a):(k=a,l=b),i=f(k),j=g(l),d=c.initSet(),p=m,m=c.initSet(),n.items=m.items,n.size=m.size,n.contains=m.contains,n.visit=m.visit;if(i<j)for(e=i;i<=j?e<=j:e>=j;i<=j?e++:e--)o=h[e][1],p.contains(o)||d.add(o),m.add(o);p.visit(function(a){if(!m.contains(a))return d.add(a)});if(d.size()>0)return n.events.onModelChange.fire(n,d.items())},n.dataStore.registerPresentation(n),n.registerPresentation=function(a){n.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)});return a.eventModelChange(n,n.items())};return n}});return c.namespace("RangePager",function(a){return a.initInstance=function(a){var d,e,f,g;g=b.initInstance("MITHGrid.Data.RangePager",a),a=g.options,d=c.Pager.initInstance({dataStore:a.dataStore,expressions:a.leftExpressions}),e=c.Pager.initInstance({dataStore:a.dataStore,expressions:a.rightExpressions}),f=c.initSet(),g.items=f.items,g.size=f.size,g.contains=f.contains,g.visit=f.visit,g.dataStore=a.dataStore,g.getItems=g.dataStore.getItems,g.getItem=g.dataStore.getItem,g.removeItems=g.dataStore.removeItems,g.fetchData=g.dataStore.fetchData,g.updateItems=g.dataStore.updateItems,g.loadItems=g.dataStore.loadItems,g.prepare=g.dataStore.prepare,g.addType=g.dataStore.addType,g.getType=g.dataStore.getType,g.addProperty=g.dataStore.addProperty,g.getProperty=g.dataStore.getProperty,g.getObjectsUnion=g.dataStore.getObjectsUnion,g.getSubjectsUnion=g.dataStore.getSubjectsUnion,g.eventModelChange=function(a,b){var c,h,i,j;c=[];for(i=0,j=b.length;i<j;i++)h=b[i],d.contains(h)&&e.contains(h)?(c.push(h),f.add(h)):(f.contains(h)&&c.push(h),f.remove(h));if(c.length>0)return g.events.onModelChange.fire(g,c)},g.setKeyRange=function(a,b){var c;a>b&&(c=[b,a],a=c[0],b=c[1]),d.setKeyRange(void 0,b);return e.setKeyRange(a,void 0)},g.setKeyRange(void 0,void 0),d.registerPresentation(g),e.registerPresentation(g),g.registerPresentation=function(a){g.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)});return a.eventModelChange(g,g.items())};return g}})}),b.namespace("Expression",function(a){var c,d;c={},d={"+":{argumentType:"number",valueType:"number",f:function(a,b){return a+b}},"-":{argumentType:"number",valueType:"number",f:function(a,b){return a-b}},"*":{argumentType:"number",valueType:"number",f:function(a,b){return a*b}},"/":{argumentType:"number",valueType:"number",f:function(a,b){return a/b}},"=":{valueType:"boolean",f:function(a,b){return a===b}},"<>":{valueType:"boolean",f:function(a,b){return a!==b}},"><":{valueType:"boolean",f:function(a,b){return a!==b}},"<":{valueType:"boolean",f:function(a,b){return a<b}},">":{valueType:"boolean",f:function(a,b){return a>b}},"<=":{valueType:"boolean",f:function(a,b){return a<=b}},">=":{valueType:"boolean",f:function(a,b){return a>=b}}},c.controls=a.controls={"if":{f:function(a,b,c,d,e){var f,g;g=a[0].evaluate(b,c,d,e),f=!1,g.forEachValue(function(a){if(a){f=!0;return!0}});return f?a[1].evaluate(b,c,d,e):a[2].evaluate(b,c,d,e)}},foreach:{f:function(a,b,d,e,f){var g,h,i,j,k;g=a[0].evaluate(b,d,e,f),h=b.value,i=d.value,j=[],k="text",d.value=g.valueType,g.forEachValue(function(c){var g;b.value=c,g=a[1].evaluate(b,d,e,f),k=g.valueType;return g.forEachValue(function(a){return j.push(a)})}),b.value=h,d.value=i;return c.initCollection(j,k)}},"default":{f:function(a,b,d,e,f){var g,h,i,j;for(i=0,j=a.length;i<j;i++){g=a[i],h=g.evaluate(b,d,e,f);if(h.size()>0)return h}return c.initCollection([],"text")}}},c.initExpression=function(a){var b;b={},b.evaluate=function(b,c,d,e){var f;f=a.evaluate(b,c,d,e);return{values:f.getSet(),valueType:f.valueType,size:f.size}},b.evaluateOnItem=function(a,b){return this.evaluate({value:a},{value:"item"},"value",b)},b.evaluateSingle=function(b,c,d,e){var f,g;f=a.evaluate(b,c,d,e),g={value:null,valueType:f.valueType},f.forEachValue(function(a){g.value=a;return!0});return g},b.isPath=a.isPath,b.isPath?(b.getPath=function(){return a},b.testExists=function(b,c,d,e){return a.testExists(b,c,d,e)}):(b.getPath=function(){return null},b.testExists=function(a,c,d,e){return b.evaluate(a,c,d,e).values.size()>0}),b.evaluateBackward=function(b,c,d,e){return a.walkBackward([b],c,d,e)},b.walkForward=function(b,c,d){return a.walkForward(b,c,d)},b.walkBackward=function(b,c,d,e){return a.walkBackward(b,c,d,e)};return b},c.initCollection=a.initCollection=function(a,c){var d;d={valueType:c},a instanceof Array?(d.forEachValue=function(b){var c,d,e,f;f=[];for(d=0,e=a.length;d<e;d++){c=a[d];if(b(c)===!0)break;f.push(void 0)}return f},d.getSet=function(){return b.Data.initSet(a)},d.contains=function(b){return f.call(a,b)>=0},d.size=function(){return a.length}):(d.forEachValue=a.visit,d.size=a.size,d.getSet=function(){return a},d.contains=a.contains),d.isPath=!1;return d},c.initConstant=function(a,b){var d;d={},d.evaluate=function(d,e,f,g){return c.initCollection([a],b)},d.isPath=!1;return d},c.initOperator=function(a,b){var e,f,g;e={},g=a,f=b,e.evaluate=function(e,h,i,j){var k,l,m,n,o;m=[],b=[];for(n=0,o=f.length;n<o;n++)k=f[n],b.push(k.evaluate(e,h,i,j));a=d[g],l=a.f,a.argumentType==="number"?b[0].forEachValue(function(a){typeof a!="number"&&(a=parseFloat(a));return b[1].forEachValue(function(b){typeof b!="number"&&(b=parseFloat(b));return m.push(l(a,b))})}):b[0].forEachValue(function(a){return b[1].forEachValue(function(b){return m.push(l(a,b))})});return c.initCollection(m,a.valueType)},e.isPath=!1;return e},c.initFunctionCall=function(a,b){var d,e;d={},e=b,d.evaluate=function(d,f,g,h){var i,j,k,l;b=[];for(j=0,k=e.length;j<k;j++)i=e[j],b.push(i.evaluate(d,f,g,h));if(((l=c.functions[a])!=null?l.f:void 0)!=null)return c.functions[a].f(b);throw new Error("No such function named "+_name)},d.isPath=!1;return d},c.initControlCall=function(a,b){var d;d={},d.evaluate=function(d,e,f,g){return c.controls[a].f(b,d,e,f,g)},d.isPath=!1;return d},c.initPath=function(a,d){var e,f,g,h,i;e={},h=null,i=[],g=function(b,d){var e,f,g,h,j,k,l,m;g=function(a){var c;c=[],b.forEachValue(function(b){return d.getObjects(b,a.property).visit(function(a){return c.push(a)})});return c},f=function(a){var c;c=[],b.forEachValue(function(b){return d.getSubjects(b,a.property).visit(function(a){return c.push(a)})});return c};for(h=0,m=i.length;0<=m?h<m:h>m;0<=m?h++:h--)j=i[h],j.isMultiple?(e=[],j.forward?(e=g(j),a=d.getProperty(j.property),k=a!=null?a.getValueType():"text"):(e=f(j),k="item"),b=c.initCollection(e,k)):j.forward?(l=d.getObjectsUnion(b.getSet(),j.property),a=d.getProperty(j.property),k=a!=null?a.getValueType():"text",b=c.initCollection(l,k)):(l=d.getSubjectsUnion(b.getSet(),j.property),b=c.initCollection(l,"item"));return b},f=function(d,e,f){var g,h,j,k,l,m,n,o;j=function(a){var b;b=[],d.forEachValue(function(c){return f.getSubjects(c,a.property).visit(function(a){if(k>0||e==null||e.contains(a))return b.push(a)})});return b},h=function(a){var b;b=[],d.forEachValue(function(c){return f.getObjects(c,a.property).visit(function(a){if(k>0||e==null||e.contains(a))return b.push(a)})});return b},e instanceof Array&&(e=b.Data.initSet(e));for(k=o=i.length-1;o<=0?k<=0:k>=0;o<=0?k++:k--)l=i[k],l.isMultiple?(g=[],l.forward?(g=j(l),a=f.getProperty(l.property),m=a!=null?a.getValueType():"text"):(g=h(l),m="item"),d=c.initCollection(g,m)):l.forward?(n=f.getSubjectsUnion(d.getSet(),l.property,null,k===0?e:null),d=c.initCollection(n,"item")):(n=f.getObjectsUnion(d.getSet(),l.property,null,k===0?e:null),a=f.getProperty(l.property),m=a!=null?a.getValueType():"text",d=c.initCollection(n,m));return d},a!=null&&i.push({property:a,forward:d,isMultiple:!1}),e.isPath=!0,e.setRootName=function(a){return h=a},e.appendSegment=function(a,b){return i.push({property:a,forward:b[0]===".",isMultiple:b.length>1})},e.getSegment=function(a){var b;if(a<i.length){b=i[a];return{property:b.property,forward:b.forward,isMultiple:b.isMultiple}}return null},e.getLastSegment=function(){return e.getSegment(i.length-1)},e.getSegmentCount=function(){return i.length},e.rangeBackward=function(c,d,e,f){var g,h,j,k,l;j=b.Data.initSet(),k="item";if(i.length>0){h=i[i.length-1];if(h.forward)f.getSubjectsInRange(h.property,c,d,!1,j,i.length===1?e:null);else throw new Error("Last path of segment must be forward");for(g=l=i.length-2;l<=0?g<=0:g>=0;l<=0?g++:g--)h=i[g],h.forward?(j=f.getSubjectsUnion(j,h.property,null,g===0?e:null),k="item"):(j=f.getObjectsUnion(j,h.property,null,g===0?e:null),a=f.getPropertysegment.property,k=a!=null?a.getValueType():"text")}return{valueType:k,values:j,count:j.size()}},e.evaluate=function(a,b,d,e){var f,i,j,k;j=h!=null?h:d,k=b[j]!=null?b[j]:"text",f=null;if(a[j]!=null){i=a[j],i.isSet||i instanceof Array?f=c.initCollection(i,k):f=c.initCollection([i],k);return g(f,e)}throw new Error("No such variable called "+j)},e.testExists=function(a,b,c,d){return e.evaluate(a,b,c,d).size()>0},e.evaluateBackward=function(a,b,d,e){var g;g=c.initCollection([a],b);return f(g,d,e)},e.walkForward=function(a,b,d){return g(c.initCollection(a,b),d)},e.walkBackward=function(a,b,d,e){return f(c.initCollection(a,b),d,e)};return e},c.initParser=a.initParser=function(){var a,b;b={},a=function(a,b){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;p=a.token(),d=c.initScanner,g=function(){a.next();return p=a.token()},m=function(){var a,b,e;b=j();while(p!=null&&p.type===d.OPERATOR&&((e=p.value)==="*"||e==="/"))a=p.value,g(),b=c.initOperator(a,[b,j()]);return b},l=function(){var a,b,e;b=m();while(p!=null&&p.type===d.OPERATOR&&((e=p.value)==="+"||e==="-"))a=p.value,g(),b=c.initOperator(a,[b,m()]);return b},h=function(){var a,b,e;a=l();while(p!=null&&p.type===d.OPERATOR&&((e=p.value)==="="||e==="<>"||e==="<"||e===">"||e==="<="||e===">="))b=p.value,g(),a=c.initOperator(b,[a,l()]);return a},i=function(){var a;a=[h()];while(p!=null&&p.type===d.DELIMITER&&p.value===",")g(),a.push(h());return a},f=function(){return p!=null?p.start:a.index()},k=function(){var a,b;b=c.initPath();while(p!=null&&p.type===d.PATH_OPERATOR){a=p.value,g();if(p!=null&&p.type===d.IDENTIFIER)b.appendSegment(p.value,a),g();else throw new Error("Missing property ID at position "+f())}return b},j=function(){var a,b,e;e=null,a=[];if(p==null)throw new Error("Missing factor at end of expression");switch(p.type){case d.NUMBER:e=c.initConstant(p.value,"number"),g();break;case d.STRING:e=c.initConstant(p.value,"text"),g();break;case d.PATH_OPERATOR:e=k();break;case d.IDENTIFIER:b=p.value,g();if(c.controls[b]!=null){if(p==null||p.type!==d.DELIMITER||p.value!=="(")throw new Error("Missing ( to start "+b+" at position "+f());g(),p!=null&&p.type===d.DELIMITER&&p.value===")"?a=[]:a=i(),e=c.initControlCall(b,a);if(p!=null&&p.type===d.DELIMITER&&p.value===")")g();else throw new Error("Missing ) to end "+b+" at position "+f())}else if(p!=null&&p.type===d.DELIMITER&&p.value==="("){g(),p!=null&&p.type===d.DELIMITER&&p.value===")"?a=[]:a=i(),e=c.initFunctionCall(b,a);if(p!=null&&p.type===d.DELIMITER&&p.value===")")g();else throw new Error("Missing ) after function call "+b+" at position "+f())}else e=k(),e.setRootName(b);break;case d.DELIMITER:if(p.value!=="(")throw new Error("Unexpected text "+p.value+" at position "+f());g(),e=h();if(p!=null&&p.type===d.DELIMITER&&p.value===")")g();else throw new Error("Missing ) at position "+f());break;default:throw new Error("Unexpected text "+p.value+" at position "+f())}return e};if(b){o=i(),e=[];for(q=0,r=o.length;q<r;q++)n=o[q],e.push(c.initExpression(n));return e}return[c.initExpression(h())]},b.parse=function(b,d,e){var f;d==null&&(d=0),e==null&&(e={}),f=c.initScanner(b,d);try{return a(f,!1)[0]}finally{e.index=f.token()!=null?f.token().start:f.index()}};return b},c.initScanner=function(a,b){var d,e,f,g,h,i;e={},h=a+" ",g=a.length,f=b,i=null,d=function(a){return"0123456789"
.indexOf(a)>=0},e.token=function(){return i},e.index=function(){return f},e.next=function(){var a,b,e,j;i=null;while(f<g&&" \t\r\n".indexOf(h.charAt(f))>=0)f+=1;if(f<g){b=h.charAt(f),e=h.charAt(f+1);if(".!".indexOf(b)<0){if("<>".indexOf(b)<0){if("+-*/=".indexOf(b)<0){if("()".indexOf(b)<0){if("\"'".indexOf(b)<0){if(d(b)){j=f;while(j<g&&d(h.charAt(j)))j+=1;if(j<g&&h.charAt(j)==="."){j+=1;while(j<g&&d(h.charAt(j)))j+=1}i={type:c.initScanner.NUMBER,value:parseFloat(h.substring(f,j)),start:f,end:j};return f=j}j=f;while(j<g){a=h.charAt(j);if("(),.!@ \t".indexOf(a)>=0)break;j+=1}i={type:c.initScanner.IDENTIFIER,value:h.substring(f,j),start:f,end:j};return f=j}j=f+1;while(j<g){if(h.charAt(j)===b&&h.charAt(j-1)!=="\\")break;j+=1}if(j<g){i={type:c.initScanner.STRING,value:h.substring(f+1,j).replace(/\\'/g,"'").replace(/\\"/g,'"'),start:f,end:j+1};return f=j+1}throw new Error("Unterminated string starting at "+String(f))}i={type:c.initScanner.DELIMITER,value:b,start:f,end:f+1};return f+=1}i={type:c.initScanner.OPERATOR,value:b,start:f,end:f+1};return f+=1}if(e==="="||"<>".indexOf(e)>=0&&b!==e){i={type:c.initScanner.OPERATOR,value:b+e,start:f,end:f+2};return f+=2}i={type:c.initScanner.OPERATOR,value:b,start:f,end:f+1};return f+=1}if(e==="@"){i={type:c.initScanner.PATH_OPERATOR,value:b+e,start:f,end:f+2};return f+=2}i={type:c.initScanner.PATH_OPERATOR,value:b,start:f,end:f+1};return f+=1}},e.next();return e},c.initScanner.DELIMITER=0,c.initScanner.NUMBER=1,c.initScanner.STRING=2,c.initScanner.IDENTIFIER=3,c.initScanner.OPERATOR=4,c.initScanner.PATH_OPERATOR=5,c.functions={},c.FunctionUtilities={};return a.registerSimpleMappingFunction=function(a,d,e){return c.functions[a]={f:function(a){var f,g,h,i,j;h=b.Data.initSet(),g=function(a){return a.forEachValue(function(a){var b;b=d(a);if(b!=null)return h.add(b)})};for(i=0,j=a.length;i<j;i++)f=a[i],g(f);return c.initCollection(h,e)}}}}),b.namespace("Presentation",function(c){c.initInstance=function(c,d,e){var f,g,h,i,j,k;k=b.normalizeArgs("MITHGrid.Presentation",c,d,e),c=k[0],d=k[1],e=k[2],j=b.initInstance(c,d,e),f=null,i={},h=j.options.lenses||{},e=j.options,a(d).empty(),g=void 0,e.lensKey||(e.lensKey=[".type"]),j.getLens=function(a){var b,c;g!=null&&(c=g.evaluate([a]),b=c[0]);if(b!=null&&h[b]!=null)return{render:h[b]}},j.addLens=function(a,b){return h[a]=b},j.removeLens=function(a){return delete h[a]},j.hasLens=function(a){return h[a]!=null},j.visitRenderings=function(a){var b,c;for(b in i){c=i[b];if(!1===a(b,c))return}},j.renderingFor=function(a){return i[a]},j.renderItems=function(a,b){var c,h,k;g==null&&(g=a.prepare(e.lensKey)),h=b.length,k=h,k>200&&(k=parseInt(Math.sqrt(k),10)+1),k<1&&(k=1),c=function(e){var g,l,m,o,p;if(e<h){g=e+k,g>h&&(g=h);for(m=e;e<=g?m<g:m>g;e<=g?m++:m--)o=b[m],l=a.contains(o),i[o]!=null?l?i[o].update(a.getItem(o)):(f===o&&i[o].eventUnfocus!=null&&i[o].eventUnfocus(),i[o].remove!=null&&i[o].remove(),delete i[o]):l&&(p=j.render(d,a,o),p!=null&&(i[o]=p,f===o&&p.eventFocus!=null&&p.eventFocus()));return setTimeout(function(){return c(g)},0)}return j.finishDisplayUpdate()},j.startDisplayUpdate();return c(0)},j.render=function(a,b,c){var d;d=j.getLens(c);if(d!=null)return d.render(a,j,b,c)},j.eventModelChange=j.renderItems,j.startDisplayUpdate=function(){},j.finishDisplayUpdate=function(){},j.selfRender=function(){return j.renderItems(j.dataView,j.dataView.items())},j.eventFocusChange=function(a){var b;f!=null&&(b=j.renderingFor(f)),f!==a&&(b!=null&&b.eventUnfocus!=null&&b.eventUnfocus(),a!=null&&(b=j.renderingFor(a),b!=null&&b.eventFocus!=null&&b.eventFocus()),f=a);return f},j.getFocusedRendering=function(){return f!=null?j.renderingFor(f):null},j.dataView=j.options.dataView,j.dataView.registerPresentation(j);return j};return c.namespace("SimpleText",function(a){return a.initInstance=function(a,c,d){var e,f;f=b.normalizeArgs("MITHGrid.Presentation.SimpleText",a,c,d),a=f[0],c=f[1],d=f[2],e=b.Presentation.initInstance(a,c,d);return e}})}),b.namespace("Facet",function(c){c.initInstance=function(c,d,e){var f;f=b.initInstance(c,d,e),e=f.options,f.selfRender=function(){},f.eventFilterItem=function(a,b){return!1},f.eventModelChange=function(a,b){},f.constructFacetFrame=function(b,c){var d;d={},a(b).addClass("mithgrid-facet"),d.header=a("<div class='header' />"),c.onClearAllSelections!=null&&(d.controls=a("<div class='control' title='Clear Selection'>"),d.counter=a("<span class='counter'></span>"),d.controls.append(d.counter),d.header.append(d.controls)),d.title=a("<span class='title'></span>"),d.title.text(c.facetLabel||""),d.header.append(d.title),d.bodyFrame=a("<div class='body-frame'></div>"),d.body=a("<div class='body'></div>"),d.bodyFrame.append(d.body),a(b).append(d.header),a(b).append(d.bodyFrame),c.onClearAllSelections!=null&&d.controls.bind("click",c.onClearAllSelections),d.setSelectionCount=function(a){d.counter.innerHTML=a;return a>0?d.counter.show():d.counter.hide()};return d},e.dataView.registerFilter(f);return f},c.namespace("TextSearch",function(d){return d.initInstance=function(d,e){var f,g,h;h=c.initInstance("MITHGrid.Facet.TextSearch",d,e),e=h.options,e.expressions!=null&&(a.isArray(e.expressions)||(e.expressions=[e.expressions],g=function(){var a,c,d,g;d=e.expressions,g=[];for(a=0,c=d.length;a<c;a++)f=d[a],g.push(b.Expression.initParser().parse(f));return g}())),h.eventFilterItem=function(a,b){var c,d,f,i,j,k,l,m;if(h.text!=null&&e.expressions!=null)for(i=0,k=g.length;i<k;i++){c=g[i],d=c.evaluateOnItem(b,a),m=d.values.items();for(j=0,l=m.length;j<l;j++){f=m[j];if(f.toLowerCase().indexOf(h.text)>=0)return}}return!1},h.eventModelChange=function(a,b){},h.selfRender=function(){var b,c;b=h.constructFacetFrame(d,null,{facetLabel:e.facetLabel}),a(d).addClass("mithgrid-facet-textsearch"),c=a("<input type='text'>"),b.body.append(c);return c.keyup(function(){h.text=a.trim(c.val().toLowerCase());return h.events.onFilterChange.fire()})};return h}}),c.namespace("List",function(d){return d.initInstance=function(d,e){var g,h,i;i=c.initInstance("MITHGrid.Facet.List",d,e),e=i.options,i.selections=[],e.expressions!=null&&(a.isArray(e.expressions)||(e.expressions=[e.expressions],h=function(){var a,c,d,f;d=e.expressions,f=[];for(a=0,c=d.length;a<c;a++)g=d[a],f.push(b.Expression.initParser().parse(g));return f}())),i.eventFilterItem=function(a,b){var c,d,g,j,k,l,m,n;if(i.text!=null&&e.expressions!=null)for(j=0,l=h.length;j<l;j++){c=h[j],d=c.evaluateOnItem(b,a),n=d.values.items();for(k=0,m=n.length;k<m;k++){g=n[k];if(f.call(i.selections,g)>=0)return}}},i.selfRender=function(){var a;return a=i.constructFacetFrame(d,null,{facetLabel:e.facetLabel,resizable:!0})};return i}});return c.namespace("Range",function(b){return b.initInstance=function(b,d){var e;e=c.initInstance("MITHGrid.Facet.Range",b,d),d=e.options,d.min==null&&(d.min=0),d.max==null&&(d.max=100),d.step==null&&(d.step=1/30),e.selfRender=function(){var c,f;c=e.constructFacetFrame(b,null,{facetLabel:d.facetLabel,resizable:!1}),f=a("<input type='range'>"),f.attr({min:d.min,max:d.max,step:d.step}),c.body.append(f);return f.event(function(){e.value=f.val();return e.events.onFilterChange.fire()})};return e}})}),b.namespace("Controller",function(c){return c.initInstance=function(c,d){var f,g,h,i,j;j=b.normalizeArgs("MITHGrid.Controller",c,void 0,d),c=j[0],f=j[1],d=j[2],i=b.initView(c,d),d=i.options,d.selectors||(d.selectors={}),g=function(c){var e,f;e=b.initInstance(d.bind),f={"":a(c)},e.locate=function(b){var e,g;g=d.selectors[b];if(g!=null){g===""?e=a(c):e=a(c).find(g),f[g]=e;return e}},e.fastLocate=function(a){var b;b=d.selectors[a];if(b!=null){if(f[b]!=null)return f[b];return e.locate(a)}},e.refresh=function(b){var e,g,h,i;for(h=0,i=b.length;h<i;h++)e=b[h],g=d.selectors[e],g!=null&&(g===""?f[""]=a(c):f[g]=a(c).find(g))},e.clearCache=function(){return f={"":a(c)}};return e},h=function(a){var b,c,d,e,f;b=g(a.node),e=b.locate,d=b.fastLocate,f=b.refresh,c=b.bind,b.locate=function(b){return b==="raphael"?a:e(b)},b.fastLocate=function(b){return b==="raphael"?a:d(b)},b.refresh=function(a){var b;a=function(){var c,d,e;e=[];for(c=0,d=a.length;c<d;c++)b=a[c],b!=="raphael"&&e.push(b);return e}();return f(a)};return b},i.initBind=function(b){return typeof b=="string"?g(a(b)):b.node!=null?h(b):g(b)},i.bind=function(){var a,b,c;c=arguments[0],a=2<=arguments.length?e.call(arguments,1):[],b=i.initBind(c),i.applyBindings.apply(i,[b].concat(e.call(a)));return b},i.applyBindings=function(){var a,b;b=arguments[0],a=2<=arguments.length?e.call(arguments,1):[]};return i}}),b.namespace("Application",function(c){return c.initInstance=function(c,d,e){var f,g,h,i;i=b.normalizeArgs("MITHGrid.Application",c,d,e),c=i[0],d=i[1],e=i[2],h=b.initView(c,d,e),g=[],h.presentation={},h.facet={},h.component={},h.dataStore={},h.dataView={},h.controller={},e=h.options,f=function(){var b,c,f,g,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;if((e!=null?e.variables:void 0)!=null){u=e.variables;for(m in u)f=u[m],h.addVariable(m,f)}if((e!=null?e.dataStores:void 0)!=null){v=e.dataStores;for(l in v)f=v[l],h.addDataStore(l,f)}if((e!=null?e.dataViews:void 0)!=null){w=e.dataViews;for(o in w)n=w[o],h.addDataView(o,n)}if((e!=null?e.controllers:void 0)!=null){x=e.controllers;for(b in x)c=x[b],h.addController(b,c)}(e!=null?e.viewSetup:void 0)!=null&&(a.isFunction(e.viewSetup)?h.ready(function(){return e.viewSetup(a(d))}):h.ready(function(){return a(d).append(e.viewSetup)}));if((e!=null?e.facets:void 0)!=null){y=e.facets;for(g in y)i=y[g],h.addFacet(g,i)}if((e!=null?e.components:void 0)!=null){r=e.components;for(b in r)c=r[b],h.addComponent(b,c)}if((e!=null?e.presentations:void 0)!=null){s=e.presentations;for(j in s)k=s[j],h.addPresentation(j,k)}if((e!=null?e.plugins:void 0)!=null){t=e.plugins,z=[];for(p=0,q=t.length;p<q;p++)k=t[p],z.push(h.addPlugin(k));return z}},h.ready=function(a){return g.push(a)},h.addVariable=function(a,c){var d,e,f,g,i,j,k,l;j=c["default"],c.is||(c.is="rw");if((k=c.is)==="rw"||k==="w")e=c.filter,i=c.validate,d=c.event||"on"+a+"Change",g=c.setter||"set"+a,h.events[d]=b.initEventFirer(),e!=null?i!=null?h[g]=function(a){a=i(e(a));if(j!==a){j=a;return h.events[d].fire(j)}}:h[g]=function(a){a=e(a);if(j!==a){j=a;return h.events[d].fire(j)}}:i!=null?h[g]=function(a){a=i(a);if(j!==a){j=a;return h.events[d].fire(j)}}:h[g]=function(a){if(j!==a){j=a;return h.events[d].fire(j)}};if((l=c.is)==="r"||l==="rw"){f=c.getter||"get"+a;return h[f]=function(){return j}}},h.addDataStore=function(a,c){var d,e,f,g,i,j,k,l;h.dataStore[a]==null?(f=b.Data.Store.initInstance(),h.dataStore[a]=f,f.addType("Item"),f.addProperty("label",{valueType:"text"}),f.addProperty("type",{valueType:"text"}),f.addProperty("id",{valueType:"text"})):f=h.dataStore[a];if((c!=null?c.types:void 0)!=null){j=c.types;for(g in j)i=j[g],f.addType(g)}if((c!=null?c.properties:void 0)!=null){k=c.properties,l=[];for(d in k)e=k[d],l.push(f.addProperty(d,e));return l}},h.addDataView=function(a,c){var d,e,f,g,i;c.type!=null&&c.type.initInstance!=null?d=c.type.initInstance:d=b.Data.View.initInstance,i={dataStore:h.dataStore[c.dataStore]||h.dataView[c.dataStore]};if(h.dataView[a]==null){for(e in c)f=c[e],e!=="type"&&!i[e]&&(i[e]=f);g=d(i);return h.dataView[a]=g}},h.addController=function(b,c){var d;d=a.extend(!0,{},c);return h.ready(function(){var a;d.application=h,a=c.type.initController(d);return h.controller[b]=a})},h.addFacet=function(b,c){var e;e=a.extend(!0,{},c);return h.ready(function(){var f,g;g=a(d).find(c.container),a.isArray(g)&&(g=g[0]),e.dataView=h.dataView[c.dataView],e.application=h,f=c.type.initFacet(g,e),h.facet[b]=f;return f.selfRender()})},h.addComponent=function(b,c){var e;e=a.extend(!0,{},cconfig);return h.ready(function(){var f,g,i,j,k,l;i=a(d).find(e.container),a.isArray(i)&&(i=i[0]),e.application=h;if(g.components!=null){e.components={},k=g.components;for(f in k)g=k[f],typeof g=="string"?e.components[f]=h.component[f]:(j=a.extend(!0,{},ccconfig),j.application=h,e.components[f]=g.type.initInstance(j))}if(g.controllers!=null){e.controllers={},l=c.controllers;for(f in l)g=l[f],typeof g=="string"?e.controllers[f]=h.controller[f]:(j=a.extend(!0,{},ccconfig),j.application=h,e.controllers[f]=g.type.initController(j))}return h.component[b]=g.type.initInstance(i,e)})},h.addPresentation=function(b,c){var e;e=a.extend(!0,{},c);return h.ready(function(){var f,g,i,j,k,l,m,n,o;l=a(d).find(e.container),a.isArray(l)&&(l=l[0]),e.dataView=h.dataView[c.dataView],e.application=h;if(c.components!=null){e.components={},n=c.components;for(g in n)i=n[g],typeof i=="string"?e.components[g]=h.component[g]:(j=a.extend(!0,{},ccconfig),j.application=h,e.components[g]=i.type.initInstance(j))}if(c.controllers!=null){e.controllers={},o=c.controllers;for(f in o)i=o[f],typeof i=="string"?e.controllers[f]=h.controller[f]:(k=a.extend(!0,{},i),k.application=h,e.controllers[f]=i.type.initController(k))}m=c.type.initPresentation(l,e),h.presentation[b]=m;return m.selfRender()})},h.addPlugin=function(b){var c;c=a.extend(!0,{},b),c.application=h;return h.ready(function(){var b,e,f,g,i,j,k,l,m,n,o,p,q,r;e=c.type.initPlugin(c);if(e!=null){if((c!=null?c.dataView:void 0)!=null){e.dataView=h.dataView[c.dataView],o=e.getTypes();for(m in o)n=o[m],e.dataView.addType(m);p=e.getProperties();for(j in p)k=p[j],e.dataView.addProperty(j,k)}q=e.getPresentations(),r=[];for(f in q)g=q[f],l=a.extend(!0,{},g.options),b=a(d).find(g.container),a.isArray(b)&&(b=b[0]),(g!=null?g.lenses:void 0)!=null&&(l.lenses=g.lenses),g.dataView!=null?l.dataView=h.dataView[g.dataView]:c.dataView!=null&&(l.dataView=h.dataView[c.dataView]),l.application=h,i=g.type.initPresentation(b,l),e.presentation[f]=i,r.push(i.selfRender());return r}})},f(),h.run=function(){return a(document).ready(function(){var a,b,c;for(b=0,c=g.length;b<c;b++)a=g[b],a();g=[];return h.ready=function(a){return setTimeout(a,0)}})};return h}}),b.namespace("Plugin",function(a){return a.initPlugin=function(a,b){var c,d;d={options:b,presentation:{}},c=[],d.getTypes=function(){return(b!=null?b.types:void 0)!=null?b.types:[]},d.getProperties=function(){return(b!=null?b.properties:void 0)!=null?b.properties:[]},d.getComponents=function(){return(b!=null?b.components:void 0)!=null?b.components:[]},d.getPresentations=function(){return(b!=null?b.presentations:void 0)!=null?b.presentations:[]},d.ready=c.push,d.eventReady=function(a){var b,e,f;for(e=0,f=c.length;e<f;e++)b=c[e],b(a);c=[];return d.ready=function(b){return b(a)}};return d}}),b.initView=b.initInstance,b.Data.initSet=b.Data.Set.initInstance,b.Data.initType=b.Data.Type.initInstance,b.Data.initProperty=b.Data.Property.initInstance,b.Data.initStore=b.Data.Store.initInstance,b.Data.initView=b.Data.View.initInstance,b.Controller.initController=b.Controller.initInstance,b.Controller.initRaphaelController=b.Controller.initController,b.Presentation.initPresentation=b.Presentation.initInstance,b.Presentation.SimpleText.initPresentation=b.Presentation.SimpleText.initInstance;return b.Application.initApp=b.Application.initInstance}(b,a),a.defaults("MITHGrid.Data.Store",{events:{onModelChange:null,onBeforeLoading:null,onAfterLoading:null,onBeforeUpdating:null,onAfterUpdating:null}}),a.defaults("MITHGrid.Data.View",{events:{onModelChange:null,onFilterItem:"preventable"}}),a.defaults("MITHGrid.Data.SubSet",{events:{onModelChange:null}}),a.defaults("MITHGrid.Data.Pager",{events:{onModelChange:null}}),a.defaults("MITHGrid.Data.RangePager",{events:{onModelChange:null}}),a.defaults("MITHGrid.Data.ListPager",{events:{onModelChange:null}}),a.defaults("MITHGrid.Facet",{events:{onFilterChange:null}}),a.defaults("MITHGrid.Facet.TextSearch",{facetLabel:"Search",expressions:[".label"]})}).call(this);