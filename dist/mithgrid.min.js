/*
 * mithgrid JavaScript Library v0.0.1
 *
 * Date: Sat May 5 15:28:28 2012 -0400
 *
 * (c) Copyright University of Maryland 2011-2012.  All rights reserved.
 *
 * (c) Copyright Texas A&M University 2010.  All rights reserved.
 *
 * Portions of this code are copied from The SIMILE Project:
 *  (c) Copyright The SIMILE Project 2006. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * 3. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
(function(){var a,b,c,d,e=Array.prototype.slice,f=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};a=(c=this.MITHGrid)!=null?c:this.MITHGrid={},b=(d=this.jQuery)!=null?d:this.jQuery={},function(a,b){var c,d,g,h;(typeof window!="undefined"&&window!==null?(h=window.console)!=null?h.log:void 0:void 0)!=null?b.debug=window.console.log:b.debug=function(){},b.error=function(){b.debug.call({},arguments);return{arguments:arguments}},b.namespace=function(a,c){return d(b,a,c)},d=function(a,c,e){var f,g;f=c.split(".");while(f.length>1)a[f[0]]||(a=d(a,f[0]),f.shift());a[f[0]]==null&&(g={namespace:function(a,b){return d(g,a,b)},debug:b.debug},a[f[0]]=g),e!=null&&e(a[f[0]]);return a[f[0]]},b.globalNamespace=function(a,c){var e,f,g;e=window,e[a]||(e[a]={}),(f=e[a]).debug||(f.debug=b.debug),(g=e[a]).namespace||(g.namespace=function(b,c){return d(e[a],b,c)}),c!=null&&c(e[a]);return e[a]},b.normalizeArgs=function(){var b,c,d,f,g,h,i,j,k;b=1<=arguments.length?e.call(arguments,0):[],c=[],g=[],i=b.pop();while(a.isFunction(i)||a.isPlainObject(i))a.isFunction(i)?c.push(i):g.push(i),i=b.pop();b.push(i),c.length===0?d=function(){var a;a=1<=arguments.length?e.call(arguments,0):[]}:c.length===1?d=c[0]:d=function(){var a,b,d,f,g;b=1<=arguments.length?e.call(arguments,0):[],g=[];for(d=0,f=c.length;d<f;d++)a=c[d],g.push(a.apply(null,b));return g},g.length===0?h={}:g.length===1?h=g[0]:(g=g.reverse(),h=a.extend.apply(a,[!0,{}].concat(e.call(g)))),j=[];while(typeof b[0]=="string"){if((k=b[0].substr(0,1))==="#"||k===".")break;j.push(b.shift())}j=j.reverse(),a.isArray(b[0])&&(j=j.concat(b.shift())),b.length>0?f=b.pop():f=null;return[j,f,h,d]},c={},b.defaults=function(b,d){c[b]||(c[b]={});return c[b]=a.extend(!0,c[b],d)},b.initSynchronizer=function(a){var b,c,d,e;e={},b=1,c=!1,d=!1,a.done==null?(e.increment=function(){},e.decrement=e.increment,e.done=e.increment,e.add=function(a){}):(e.increment=function(){return b+=1},e.add=function(a){return b+=a},e.decrement=function(){b-=1,b<=0&&c&&!d&&(d=!0,a.done);return b},e.done=function(){c=!0;return e.decrement()});return e},b.initEventFirer=function(a,b){var c,d;d={},d.isPreventable=a,d.isUnicast=b,c=[],d.addListener=function(a,b){return c.push([a,b])},d.removeListener=function(a){var b;return typeof a=="string"?c=function(){var d,e,f;f=[];for(d=0,e=c.length;d<e;d++)b=c[d],b[1]!==a&&f.push(b);return f}():c=function(){var d,e,f;f=[];for(d=0,e=c.length;d<e;d++)b=c[d],b[0]!==a&&f.push(b);return f}()},b?d.fire=function(){var a,b;a=1<=arguments.length?e.call(arguments,0):[];if(c.length<=0)return!0;try{return(b=c[0])[0].apply(b,a)}catch(d){return console.log(d)}}:a?d.fire=function(){var a,b,d,f,g,h;a=1<=arguments.length?e.call(arguments,0):[],f=!0;for(g=0,h=c.length;g<h;g++){d=c[g],b=d[0];try{f=b.apply(null,a)}catch(i){console.log(i)}if(f===!1)return!1}return!0}:d.fire=function(){var a,b,d,f;a=1<=arguments.length?e.call(arguments,0):[];for(d=0,f=c.length;d<f;d++){b=c[d];try{b[0].apply(b,a)}catch(g){console.log(b[0],a,g)}}return!0};return d},g=0,b.initInstance=function(){var d,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;d=1<=arguments.length?e.call(arguments,0):[],w=b.normalizeArgs.apply(b,d),n=w[0],l=w[1],k=w[2],j=w[3],r={},q=[];if(n!=null){typeof n=="string"&&(n=[n]),n.reverse();for(u=0,v=n.length;u<v;u++){o=n[u],h=o.split("."),o=h.shift(),c[o]!=null&&q.push(c[o]);while(h.length>0)o=o+"."+h.shift(),c[o]!=null&&q.push(c[o])}}k!=null&&q.push(k),p=a.extend.apply(a,[!0,{}].concat(e.call(q))),g+=1,r.id=g,r.options=p,r.container=l,r.events={};if(r.options.events!=null){x=r.options.events;for(m in x)i=x[m],i!=null?typeof i=="string"&&(i=[i]):i=[],r.events[m]=b.initEventFirer(f.call(i,"preventable")>=0,f.call(i,"unicast")>=0)}r.addVariable=function(a,c){var d,e,g,h,i,j,k,l,m,n,o;o=c["default"],c.is||(c.is="rw"),f.call(c.is,"w")>=0&&(e=c.filter,n=c.validate,d=c.event||"on"+a+"Change",k=c.setter||"set"+a,h=c.locker||"lock"+a,m=c.unlocker||"unlock"+a,r.events[d]=b.initEventFirer(),e!=null?n!=null?l=function(a){a=n(e(a));if(o!==a){o=a;return r.events[d].fire(o)}}:l=function(a){a=e(a);if(o!==a){o=a;return r.events[d].fire(o)}}:n!=null?l=function(a){a=n(a);if(o!==a){o=a;return r.events[d].fire(o)}}:l=function(a){if(o!==a){o=a;return r.events[d].fire(o)}},f.call(c.is,"l")>=0&&(i=0,r[h]=function(){return i+=1},r[m]=function(){return i-=1},j=l,l=function(a){if(i===0)return j(a)}),r[k]=l);if(f.call(c.is,"r")>=0){g=c.getter||"get"+a;return r[g]=function(){return o}}};if(((y=r.options)!=null?y.variables:void 0)!=null){z=p.variables;for(s in z)k=z[s],r.addVariable(s,k)}(p!=null?p.viewSetup:void 0)!=null&&l!=null&&(t=p.viewSetup,a.isFunction(t)?a(document).ready(function(){return t(a(l))}):a(document).ready(function(){return a(l).append(t)})),j!=null&&j(r,l);return r},b.namespace("events",function(c){c.onWindowResize=b.initEventFirer(!1,!1);return a(document).ready(function(){return a(window).resize(function(){return setTimeout(b.events.onWindowResize.fire,0)})})}),b.namespace("mouse",function(b){var c;c=[],b.capture=function(b){var d;d=c[0],c.unshift(b),c.length===1&&(a(document).mousemove(function(a){a.preventDefault();return c[0].call(a,"mousemove")}),a(document).mouseup(function(a){a.preventDefault();return c[0].call(a,"mouseup")}));return d};return b.uncapture=function(){var b;b=c.shift(),c.length===0&&(a(document).unbind("mousemove"),a(document).unbind("mouseup"));return b}}),b.namespace("Data",function(c){c.namespace("Set",function(a){return a.initInstance=function(a){var b,c,d,e,f,g,h,i;g={},d={},b=0,f=!0,e=[],g.isSet=!0,g.items=function(){var a;if(f){e=[];for(a in d)typeof a=="string"&&d[a]===!0&&e.push(a)}return e},g.add=function(a){if(d[a]==null){d[a]=!0,f=!0;return b+=1}},g.remove=function(a){if(d[a]!=null){delete d[a],f=!0;return b-=1}},g.empty=function(){d={},b=0,f=!1,e=[];return},g.visit=function(a){var b,c;c=[];for(b in d){if(a(b)===!0)break;c.push(void 0)}return c},g.contains=function(a){return d[a]!=null},g.size=function(){return f?g.items().length:e.length};if(a instanceof Array)for(h=0,i=a.length;h<i;h++)c=a[h],g.add(c);return g}}),c.namespace("Type",function(a){return a.initInstance=function(a){var b;return b={name:a,custom:{}}}}),c.namespace("Property",function(a){return a.initInstance=function(a){var b;return b={name:a,getValueType:function(){var a;return(a=b.valueType)!=null?a:"text"}}}}),c.namespace("Store",function(d){return d.initInstance=function(){var d;d=1<=arguments.length?e.call(arguments,0):[];return b.initInstance.apply(b,["MITHGrid.Data.Store"].concat(e.call(d),[function(d){var e,g,h,i,j,k,l,m,n,o;l=!1,m=c.initSet(),o={},k={},n={},i={},j=d.options,d.items=m.items,d.contains=m.contains,d.visit=m.visit,d.size=m.size,h=function(a,b,c,d){var e,g,h;h=a[b],h==null&&(h={values:{},counts:{}},a[b]=h),e=h.values[c],g=h.counts[c],e==null&&(e=[],h.values[c]=e);if(g==null)g={},h.counts[c]=g;else if(f.call(e,d)>=0){g[d]+=1;return}e.push(d);return g[d]=1},g=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n;g=a[b];if(g!=null){f=g.values[c];if(f!=null){if(e!=null){m=[];for(i=0,k=f.length;i<k;i++)h=f[i],e.contains(h)?m.push(d.add(h)):m.push(void 0);return m}n=[];for(j=0,l=f.length;j<l;j++)h=f[j],n.push(d.add(h));return n}}},e=function(a,b,d,e,f){e==null&&(e=c.initSet()),b.visit(function(b){return g(a,b,d,e,f)});return e},d.addProperty=function(a,b){var d;d=c.initProperty(a),(b!=null?b.valueType:void 0)!=null&&(d.valueType=b.valueType,k[a]=d);return d},d.getProperty=function(a){var b;return(b=k[a])!=null?b:c.initProperty(a)},d.addType=function(a,b){var d;d=c.initType(a),o[a]=d;return d},d.getType=function(a){var b;return(b=o[a])!=null?b:c.initType(a)},d.getItem=function(a){var b,c;return(b=(c=n[a])!=null?c.values:void 0)!=null?b:{}},d.getItems=function(b){if(!a.isArray(b))return[d.getItem(b)];return a.map(b,function(a,b){return d.getItem(a)})},d.removeItems=function(b,c){var e,f,g,h,j,k,l,o;f=[],g=function(b,c,d,e){var f,g,h,i,j,k,l;h=b[c];if(h!=null){f=h.values[d],g=h.counts[d];if(f==null||g==null)return;g[e]-=1;if(g[e]<1){i=a.inArray(e,f),i===0?f=f.slice(1,f.length):i===f.length-1?f=f.slice(0,i):i>0&&(f=f.slice(0,i).concat(f.slice(i+1,f.length))),f.length>0?h.values[d]=f:delete h.values[d],delete g[e],k=0;for(j in g)l=g[j],k+=l;if(k===0)return delete b[c]}}},h=function(a,b,c){g(n,a,b,c);return g(i,c,b,a)},k=function(a,b,c){var d,e,f,g;g=[];for(e=0,f=c.length;e<f;e++)d=c[e],g.push(h(a,b,d));return g},j=function(b){var c,e,f,g;c=d.getItem(b),g=c.type,a.isArray(g)&&(g=g[0]);for(f in c){e=c[f];if(typeof f!="string"||f==="id"||f==="type")continue;k(b,f,e)}return k(b,"type",[g])};for(l=0,o=b.length;l<o;l++)e=b[l],j(e),f.push(e),m.remove(e);d.events.onModelChange.fire(d,f);if(c!=null)return c()},d.updateItems=function(b,c){var e,f,g,j,k,l,m,o;g=[],k=function(b,c,d,e){var f,g,h,i;h=b[c];if(h!=null){f=h.values[d],g=h.counts[d];if(f==null||g==null)return;g[e]-=1;if(g[e]<1){i=a.inArray(e,f),i===0?f=f.slice(1,f.length):i===f.length-1?f=f.slice(0,i):i>0&&(f=f.slice(0,i).concat(f.slice(i+1,f.length))),f.length>0?h.values[d]=f:delete h.values[d];return delete g[e]}}},j=function(a,b,c){h(n,a,b,c);return h(i,c,b,a)},l=function(a,b,c){k(n,a,b,c);return k(i,c,b,a)},o=function(b){var c,e,f,g,h,i,k,m,n,o;e=b.id,o=b.type,c=!1,f=function(a,b){var c,d,e;d=!0;if(a.length!==b.length)return!1;for(c=0,e=a.length;0<=e?c<e:c>e;0<=e?c++:c--)a[c]!==b[c]&&(d=!1);return d},m=function(a,b,c){var d,e,f,g;g=[];for(e=0,f=c.length;e<f;e++)d=c[e],g.push(l(a,b,d));return g},k=function(a,b,c){var d,e,f,g;g=[];for(e=0,f=c.length;e<f;e++)d=c[e],g.push(j(a,b,d));return g},a.isArray(e)&&(e=e[0]),a.isArray(o)&&(o=o[0]),h=d.getItem(e);for(i in b){g=b[i];if(typeof i!="string"||i==="id"||i==="type")continue;a.isArray(g)||(g=[g]),n=g.length,h[i]==null?(k(e,i,g),c=!0):f(g,h[i])||(c=!0,m(e,i,h[i]),k(e,i,g))}return c},d.events.onBeforeUpdating.fire(d),m=b.length,e=parseInt(m/100,10),e>500&&(e=500),e<100&&(e=100),f=function(a){var h,i,j;h=a+e,h>m&&(h=m);for(j=a;a<=h?j<h:j>h;a<=h?j++:j--)i=b[j],typeof i=="object"&&o(i)&&g.push(i.id);if(h<m)return setTimeout(function(){return f(h)},0);d.events.onAfterUpdating.fire(d),d.events.onModelChange.fire(d,g);if(c!=null)return c()};return f(0)},d.loadItems=function(c,e){var f,g,j,k,l,o;j=[],k=function(a,b,c){h(n,a,b,c);return h(i,c,b,a)},l=function(c){var d,e,f,g,h,i;if(c.id==null)throw b.error("Item entry has no id: ",c);if(c.type==null)throw b.error("Item entry has no type: ",c);d=c.id,f=c.type,a.isArray(d)&&(d=d[0]),a.isArray(f)&&(f=f[0]),m.add(d),j.push(d),k(d,"type",f),k(d,"id",d),i=[];for(e in c){g=c[e];if(typeof e!="string")continue;e!=="id"&&e!=="type"?a.isArray(g)?i.push(function(){var a,b,c;c=[];for(a=0,b=g.length;a<b;a++)h=g[a],c.push(k(d,e,h));return c}()):g!=null?i.push(k(d,e,g)):i.push(void 0):i.push(void 0)}return i},d.events.onBeforeLoading.fire(d),o=c.length,e!=null?(f=parseInt(o/100,10),f>500&&(f=500)):f=o,f<100&&(f=100),g=function(a){var b,h,i;b=a+f,b>o&&(b=o);for(i=a;a<=b?i<b:i>b;a<=b?i++:i--)h=c[i],typeof h=="object"&&l(h);if(b<o)return setTimeout(function(){return g(b)},0);d.events.onAfterLoading.fire(d),d.events.onModelChange.fire(d,j);if(e!=null)return e()};return g(0)},d.prepare=function(a){var c,e,f,g;f=b.Expression.initParser(),e=function(){var b,d,e;e=[];for(b=0,d=a.length;b<d;b++)c=a[b],e.push(f.parse(c));return e}(),g=void 0;return{evaluate:function(a){var b,c,f,h,i;c=[],g=void 0,f=function(b){var e;e=b.evaluateOnItem(a,d),g||(g=e.valueType);return c=c.concat(e.values.items())};for(h=0,i=e.length;h<i;h++)b=e[h],f(b);return c},valueType:function(){return g}}},d.getObjectsUnion=function(a,b,c,d){return e(n,a,b,c,d)},d.getSubjectsUnion=function(a,b,c,d){return e(i,a,b,c,d)};return d.registerPresentation=function(a){d.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)});return a.eventModelChange(d,d.items())}}]))}}),c.namespace("View",function(a){return a.initInstance=function(){var a;a=1<=arguments.length?e.call(arguments,0):[];return b.initInstance.apply(b,["MITHGrid.Data.View"].concat(e.call(a),[function(a){var d,e,g,h,i,j,k,l,m,n;k=c.initSet(),i=a.options,e=function(b){return!1!==a.events.onFilterItem.fire(a.dataStore,b)},g=function(b){var c,d,f,g;f=a.dataStore.items(),g=f.length;if(g===0)b();else{g>200?(c=parseInt(g/100,10),c>500&&(c=500)):c=g,c<100&&(c=100),d=function(h){var i,j,l;i=h+c,i>g&&(i=g);for(j=h;h<=i?j<i:j>i;h<=i?j++:j--)l=f[j],e(l)?k.add(l):k.remove(l);if(i<g)return setTimeout(function(){return d(i)},0);a.items=k.items,a.size=k.size,a.contains=k.contains,a.visit=k.visit;if(b!=null)return b()};return d(0)}},a.registerFilter=function(b){a.events.onFilterItem.addListener(function(a,c){return b.eventFilterItem(a,c)}),a.events.onModelChange.addListener(function(a,c){return b.eventModelChange(a,c)});return b.events.onFilterChange.addListener(a.eventFilterChange)},a.registerPresentation=function(b){a.events.onModelChange.addListener(function(a,c){return b.eventModelChange(a,c)});return g(function(){return b.eventModelChange(a,a.items())})},a.items=k.items,a.contains=k.contains,a.visit=k.visit,a.size=k.size,a.eventFilterChange=function(){var b;b=c.initSet(a.items());return g(function(){var d,e,f,g,h,i,j,k;d=c.initSet(),j=b.items();for(f=0,h=j.length;f<h;f++)e=j[f],a.contains(e)||d.add(e);k=a.items();for(g=0,i=k.length;g<i;g++)e=k[g],b.contains(e)||d.add(e);if(d.size()>0)return a.events.onModelChange.fire(a,d.items())})},a.eventModelChange=function(b,d){var f,g,h,i;f=c.initSet();for(h=0,i=d.length;h<i;h++)g=d[h],b.contains(g)?e(g)?(k.add(g),f.add(g)):k.contains(g)&&(f.add(g),k.remove(g)):(f.add(g),k.remove(g));return a.events.onModelChange.fire(a,f.items())},(i!=null?(m=i.types)!=null?m.length:void 0:void 0)>0&&function(b){return a.registerFilter({eventFilterItem:function(a,c){var d,e,g,h;d=a.getItem(c);if(d.type==null)return!1;for(g=0,h=b.length;g<h;g++){e=b[g];if(f.call(d.type,e)>=0)return}return!1},eventModelChange:function(a,b){},events:{onFilterChange:{addListener:function(a){}}}})}(i.types),(i!=null?(n=i.filters)!=null?n.length:void 0:void 0)>0&&function(c){var d,e,f;f=b.Expression.initParser(),e=function(){var a,b,e;e=[];for(a=0,b=c.length;a<b;a++)d=c[a],e.push(f.parse(d));return e}();return a.registerFilter({eventFilterItem:function(a,b){var c,d,f,g,h,i,j;for(g=0,i=e.length;g<i;g++){c=e[g],f=c.evaluateOnItem(b,a),f=f.values.items();for(h=0,j=f.length;h<j;h++){d=f[h];if(d!=="false")return}}return!1},eventModelChange:function(a,b){},events:{onFilterChange:{addListener:function(a){}}}})}(i.filters),(i!=null?i.collection:void 0)!=null&&a.registerFilter({eventFilterItem:i.collection,eventModelChange:function(a,b){},events:{onFilterChange:{addListener:function(a){}}}}),(i!=null?i.expressions:void 0)!=null&&(d=i.dataStore.prepare(i.expressions),j=a.eventModelChange,h=b.Data.initStore({}),l=b.Data.initSet(),a.eventModelChange=function(a,c){var e,g,i,k,m,n,o,p,q,r,s,t,u;m=[],o=[],i=b.Data.initSet(),i=h.getObjectsUnion(l,"mapsTo",i);for(q=0,s=c.length;q<s;q++){e=c[q];if(i.contains(e))m.push(e),a.contains(e)||(g=b.Data.initSet(),h.getSubjectsUnion(b.Data.initSet([e]),"mapsTo",g),g.visit(function(a){var b,c,d;c=h.getItem(a),d=c.mapsTo;if(d!=null){b=d.indexOf(e),b===0?d=d.slice(1,d.length):b===d.length-1?d=d.slice(0,d.length-1):b>-1&&(d=d.slice(0,b).concat(d.slice(b+1,d.length)));return h.updateItems([{id:a,mapsTo:d}])}}));else if(a.contains(e)){n=b.Data.initSet(),u=d.evaluate([e]);for(r=0,t=u.length;r<t;r++)p=u[r],n.add(p);h.contains(e)?h.updateItems([{id:e,mapsTo:n.items()}]):h.loadItems([{id:e,mapsTo:n.items()}])}else m=m.concat(h.getItem(e).mapsTo),o.push(e)}o.length>0&&h.removeItems(o),i=b.Data.initSet(),h.getObjectsUnion(l,"mapsTo",i),m=function(){var a,b,d;d=[];for(a=0,b=m.length;a<b;a++)k=m[a],f.call(c,k)>=0&&d.push(k);return d}();return j(i,m)}),a.dataStore=i.dataStore,a.getItems=a.dataStore.getItems,a.getItem=a.dataStore.getItem,a.removeItems=a.dataStore.removeItems,a.updateItems=a.dataStore.updateItems,a.loadItems=a.dataStore.loadItems,a.prepare=a.dataStore.prepare,a.addType=a.dataStore.addType,a.getType=a.dataStore.getType,a.addProperty=a.dataStore.addProperty,a.getProperty=a.dataStore.getProperty,a.getObjectsUnion=a.dataStore.getObjectsUnion,a.getSubjectsUnion=a.dataStore.getSubjectsUnion,a.dataStore.events.onModelChange.addListener(a.eventModelChange);return a.eventModelChange(a.dataStore,a.dataStore.items())}]))}}),c.namespace("SubSet",function(a){return a.initInstance=function(){var a;a=1<=arguments.length?e.call(arguments,0):[];return b.initView.apply(b,["MITHGrid.Data.SubSet"].concat(e.call(a),[function(a){var b,d,e,f;e=a.options,d=e.key,f=c.initSet(),a.items=f.items,a.contains=f.contains,a.visit=f.visit,a.size=f.size,a.setKey=function(b){d=b;return a.eventModelChange(e.dataStore,e.dataStore.items())},b=e.dataStore.prepare(e.expressions),a.eventModelChange=function(e,g){var h,i,j,k,l;d!=null?j=c.initSet(b.evaluate([d])):j=c.initSet(),h=[];for(k=0,l=g.length;k<l;k++)i=g[k],f.contains(i)?(h.push(i),j.contains(i)||f.remove(i)):j.contains(i)&&(f.add(i),h.push(i));if(h.length>0)return a.events.onModelChange.fire(a,h)},a.dataStore=e.dataStore,a.getItems=a.dataStore.getItems,a.getItem=a.dataStore.getItem,a.removeItems=a.dataStore.removeItems,a.fetchData=a.dataStore.fetchData,a.updateItems=a.dataStore.updateItems,a.loadItems=a.dataStore.loadItems,a.prepare=a.dataStore.prepare,a.addType=a.dataStore.addType,a.getType=a.dataStore.getType,a.addProperty=a.dataStore.addProperty,a.getProperty=a.dataStore.getProperty,a.getObjectsUnion=a.dataStore.getObjectsUnion,a.getSubjectsUnion=a.dataStore.getSubjectsUnion,a.dataStore.events.onModelChange.addListener(a.eventModelChange),a.eventModelChange(a.dataStore,a.dataStore.items());return a.registerPresentation=function(b){a.events.onModelChange.addListener(function(a,c){return b.eventModelChange(a,c)});return b.eventModelChange(a,a.items())}}]))}}),c.namespace("ListPager",function(a){return a.initInstance=function(){var a;a=1<=arguments.length?e.call(arguments,0):[];return b.initInstance.apply(b,["MITHGrid.Data.ListPager"].concat(e.call(a),[function(a){var b,d,e,g,h,i,j,k;i=a.options,d=[],e=0,g=-1,h=void 0,j=void 0,b=function(a){return d.indexOf(a)},k=c.initSet(),a.items=k.items,a.size=k.size,a.contains=k.contains,a.visit=k.visit,a.dataStore=i.dataStore,a.getItems=a.dataStore.getItems,a.getItem=a.dataStore.getItem,a.removeItems=a.dataStore.removeItems,a.fetchData=a.dataStore.fetchData,a.updateItems=a.dataStore.updateItems,a.loadItems=a.dataStore.loadItems,a.prepare=a.dataStore.prepare,a.addType=a.dataStore.addType,a.getType=a.dataStore.getType,a.addProperty=a.dataStore.addProperty,a.getProperty=a.dataStore.getProperty,a.getObjectsUnion=a.dataStore.getObjectsUnion,a.getSubjectsUnion=a.dataStore.getSubjectsUnion,a.setList=function(b){var c,h,i,j,l,m,n,o,p;d=b,c=[];for(i=0,l=d.length;i<l;i++)h=d[i],a.dataStore.contains(h)&&!k.contains(h)?e<=(n=d.indexOf(h))&&n<g&&(c.push(h),k.add(h)):k.contains(h)&&!a.dataStore.contains(h)&&(c.push(h),k.remove(h));o=k.items();for(j=0,m=o.length;j<m;j++){h=o[j];if((p=!h,f.call(d,p)>=0)||!a.dataStore.contains(h))c.push(h),k.remove(h)}if(c.length>0)return a.events.onModelChange.fire(a,c)},a.eventModelChange=function(c,d){var f,h,i,j,l;f=[];for(j=0,l=d.length;j<l;j++)h=d[j],c.contains(h)?(i=b(h),k.contains(h)?(f.push(h),(e>i||i>=g)&&k.remove(h)):e<=i&&i<g&&(k.add(h),f.push(h))):(k.remove(h),f.push(h));if(f.length>0)return a.events.onModelChange.fire(a,f)},a.setKeyRange=function(b,f){var h,i,j,l;b<f?(e=b,g=f):(e=f,g=b),l=k,h=c.initSet(),k=c.initSet(),a.items=k.items,a.size=k.size,a.contains=k.contains,a.visit=k.visit;if(e<g)for(i=e;e<=g?i<=g:i>=g;e<=g?i++:i--)j=d[i],l.contains(j)||h.add(j),k.add(j);l.visit(function(a){if(!k.contains(a))return h.add(a)});if(h.size()>0)return a.events.onModelChange.fire(a,h.items())},a.dataStore.registerPresentation(a);return a.registerPresentation=function(b){a.events.onModelChange.addListener(function(a,c){return b.eventModelChange(a,c)});return b.eventModelChange(a,a.items())}}]))}}),c.namespace("Pager",function(a){return a.initInstance=function(){var a;a=1<=arguments.length?e.call(arguments,0):[];return b.initInstance.apply(b,["MITHGrid.Data.Pager"].concat(e.call(a),[function(a){var b,d,e,f,g,h,i,j,k,l,m;k=a.options,g=[],h=-1,i=-1,j=void 0,l=void 0,e=function(a){var b,c,d;if(a==null)return 0;b=0,d=g.length-1;while(b<d)c=~~((b+d)/2),g[c][0]<a?b=c+1:g[c][0]===a?d=c:d=c-1;while(g[b]!=null&&g[b][0]<a)b+=1;return b},f=function(a){var b,c,d;if(a==null)return g.length-1;b=0,d=g.length-1;while(b<d)c=~~((b+d)/2),g[c][0]<a?b=c+1:d=c-1;while(d>=0&&g[d][0]>=a)d-=1;return d},d=function(a){var b,c;for(b=0,c=g.length;0<=c?b<c:b>c;0<=c?b++:b--)if(g[b][1]===a)return b;return-1},m=c.initSet(),a.items=m.items,a.size=m.size,a.contains=m.contains,a.visit=m.visit,a.dataStore=k.dataStore,a.getItems=a.dataStore.getItems,a.getItem=a.dataStore.getItem,a.removeItems=a.dataStore.removeItems,a.fetchData=a.dataStore.fetchData,a.updateItems=a.dataStore.updateItems,a.loadItems=a.dataStore.loadItems,a.prepare=a.dataStore.prepare,a.addType=a.dataStore.addType,a.getType=a.dataStore.getType,a.addProperty=a.dataStore.addProperty,a.getProperty=a.dataStore.getProperty,a.getObjectsUnion=a.dataStore.getObjectsUnion,a.getSubjectsUnion=a.dataStore.getSubjectsUnion,b=a.prepare(k.expressions),a.eventModelChange=function(c,k){var n,o,p,q,r,s,t;n=[];for(s=0,t=k.length;s<t;s++)p=k[s],c.contains(p)?(r=b.evaluate(p),r.length>0?(b.valueType()==="numeric"?q=parseFloat(r[0]):q=r[0],m.contains(p)?(o=d(p),o===-1?g.push([q,p]):g[o][0]=q,n.push(p),(j!=null&&q<j||l!=null&&q>=l)&&m.remove(p)):(g.push([q,p]),(j==null||q>=j)&&(l==null||q<l)&&(m.add(p),n.push(p)))):m.contains(p)&&(o=d(p),o===0?g=g.slice(1,g.length):o===g.length-1?g=g.slice(0,g.length-1):o!==-1&&(g=g.slice(0,o).concat(g.slice(o+1,g.length))),m.remove(p),n.push(p))):(m.remove(p),n.push(p));g.sort(function(a,b){if(a[0]<b[0])return-1;if(a[0]>b[0])return 1;return 0}),h=e(j),i=f(l);if(n.length>0)return a.events.onModelChange.fire(a,n)},a.setKeyRange=function(b,d){var k,n,o,p;b!=null&&d!=null?b<d?(j=b,l=d):(j=d,l=b):(j=b,l=d),h=e(j),i=f(l),k=c.initSet(),p=m,m=c.initSet(),a.items=m.items,a.size=m.size,a.contains=m.contains,a.visit=m.visit;if(h<=i)for(n=h;h<=i?n<=i:n>=i;h<=i?n++:n--)o=g[n][1],p.contains(o)||k.add(o),m.add(o);p.visit(function(a){if(!m.contains(a))return k.add(a)});if(k.size()>0)return a.events.onModelChange.fire(a,k.items())},a.dataStore.registerPresentation(a);return a.registerPresentation=function(b){a.events.onModelChange.addListener(function(a,c){return b.eventModelChange(a,c)});return b.eventModelChange(a,a.items())}}]))}});return c.namespace("RangePager",function(a){return a.initInstance=function(){var a;a=1<=arguments.length?e.call(arguments,0):[];return b.initInstance.apply(b,["MITHGrid.Data.RangePager"].concat(e.call(a),[function(a){var b,d,e,f;d=a.options,b=c.Pager.initInstance({dataStore:d.dataStore,expressions:d.leftExpressions}),e=c.Pager.initInstance({dataStore:d.dataStore,expressions:d.rightExpressions}),f=c.initSet(),a.items=f.items,a.size=f.size,a.contains=f.contains,a.visit=f.visit,a.dataStore=d.dataStore,a.getItems=a.dataStore.getItems,a.getItem=a.dataStore.getItem,a.removeItems=a.dataStore.removeItems,a.fetchData=a.dataStore.fetchData,a.updateItems=a.dataStore.updateItems,a.loadItems=a.dataStore.loadItems,a.prepare=a.dataStore.prepare,a.addType=a.dataStore.addType,a.getType=a.dataStore.getType,a.addProperty=a.dataStore.addProperty,a.getProperty=a.dataStore.getProperty,a.getObjectsUnion=a.dataStore.getObjectsUnion,a.getSubjectsUnion=a.dataStore.getSubjectsUnion,a.eventModelChange=function(c,d){var g,h,i,j;g=[];for(i=0,j=d.length;i<j;i++)h=d[i],b.contains(h)&&e.contains(h)?(g.push(h),f.add(h)):f.contains(h)&&(g.push(h),f.remove(h));return a.events.onModelChange.fire(a,g)},a.setKeyRange=function(a,c){var d;a!=null&&c!=null&&a>c&&(d=[c,a],a=d[0],c=d[1]),b.setKeyRange(void 0,c);return e.setKeyRange(a,void 0)},b.registerPresentation(a),e.registerPresentation(a),a.setKeyRange(void 0,void 0);return a.registerPresentation=function(b){a.events.onModelChange.addListener(function(a,c){return b.eventModelChange(a,c)});return b.eventModelChange(a,a.items())}}]))}})}),b.namespace("Expression",function(a){var c,d;c={},d={"+":{argumentType:"number",valueType:"number",f:function(a,b){return a+b}},"-":{argumentType:"number",valueType:"number",f:function(a,b){return a-b}},"*":{argumentType:"number",valueType:"number",f:function(a,b){return a*b}},"/":{argumentType:"number",valueType:"number",f:function(a,b){return a/b}},"=":{valueType:"boolean",f:function(a,b){return a===b}},"<>":{valueType:"boolean",f:function(a,b){return a!==b}},"><":{valueType:"boolean",f:function(a,b){return a!==b}},"<":{valueType:"boolean",f:function(a,b){return a<b}},">":{valueType:"boolean",f:function(a,b){return a>b}},"<=":{valueType:"boolean",f:function(a,b){return a<=b}},">=":{valueType:"boolean",f:function(a,b){return a>=b}}},c.controls=a.controls={"if":{f:function(a,b,c,d,e){var f,g;g=a[0].evaluate(b,c,d,e),f=!1,g.forEachValue(function(a){if(a){f=!0;return!0}});return f?a[1].evaluate(b,c,d,e):a[2].evaluate(b,c,d,e)}},foreach:{f:function(a,b,d,e,f){var g,h,i,j,k;g=a[0].evaluate(b,d,e,f),h=b.value,i=d.value,j=[],k="text",d.value=g.valueType,g.forEachValue(function(c){var g;b.value=c,g=a[1].evaluate(b,d,e,f),k=g.valueType;return g.forEachValue(function(a){return j.push(a)})}),b.value=h,d.value=i;return c.initCollection(j,k)}},"default":{f:function(a,b,d,e,f){var g,h,i,j;for(i=0,j=a.length;i<j;i++){g=a[i],h=g.evaluate(b,d,e,f);if(h.size()>0)return h}return c.initCollection([],"text")}}},c.initExpression=function(a){var b;b={},b.evaluate=function(b,c,d,e){var f;f=a.evaluate(b,c,d,e);return{values:f.getSet(),valueType:f.valueType,size:f.size}},b.evaluateOnItem=function(a,b){return this.evaluate({value:a},{value:"item"},"value",b)},b.evaluateSingle=function(b,c,d,e){var f,g;f=a.evaluate(b,c,d,e),g={value:null,valueType:f.valueType},f.forEachValue(function(a){g.value=a;return!0});return g},b.isPath=a.isPath,b.isPath?(b.getPath=function(){return a},b.testExists=function(b,c,d,e){return a.testExists(b,c,d,e)}):(b.getPath=function(){return null},b.testExists=function(a,c,d,e){return b.evaluate(a,c,d,e).values.size()>0}),b.evaluateBackward=function(b,c,d,e){return a.walkBackward([b],c,d,e)},b.walkForward=function(b,c,d){return a.walkForward(b,c,d)},b.walkBackward=function(b,c,d,e){return a.walkBackward(b,c,d,e)};return b},c.initCollection=a.initCollection=function(a,c){var d;d={valueType:c},a instanceof Array?(d.forEachValue=function(b){var c,d,e,f;f=[];for(d=0,e=a.length;d<e;d++){c=a[d];if(b(c)===!0)break;f.push(void 0)}return f},d.getSet=function(){return b.Data.initSet(a)},d.contains=function(b){return f.call(a,b)>=0},d.size=function(){return a.length}):(d.forEachValue=a.visit,d.size=a.size,d.getSet=function(){return a},d.contains=a.contains),d.isPath=!1;return d},c.initConstant=function(a,b){var d;d={},d.evaluate=function(d,e,f,g){return c.initCollection([a],b)},d.isPath=!1;return d},c.initOperator=function(a,b){var e,f,g;e={},g=a,f=b,e.evaluate=function(e,h,i,j){var k,l,m,n,o;m=[],b=[];for(n=0,o=f.length;n<o;n++)k=f[n],b.push(k.evaluate(e,h,i,j));a=d[g],l=a.f,a.argumentType==="number"?b[0].forEachValue(function(a){typeof a!="number"&&(a=parseFloat(a));return b[1].forEachValue(function(b){typeof b!="number"&&(b=parseFloat(b));return m.push(l(a,b))})}):b[0].forEachValue(function(a){return b[1].forEachValue(function(b){return m.push(l(a,b))})});return c.initCollection(m,a.valueType)},e.isPath=!1;return e},c.initFunctionCall=function(a,b){var d,e;d={},e=b,d.evaluate=function(d,f,g,h){var i,j,k,l;b=[];for(j=0,k=e.length;j<k;j++)i=e[j],b.push(i.evaluate(d,f,g,h));if(((l=c.functions[a])!=null?l.f:void 0)!=null)return c.functions[a].f(b);throw new Error("No such function named "+_name)},d.isPath=!1;return d},c.initControlCall=function(a,b){var d;d={},d.evaluate=function(d,e,f,g){return c.controls[a].f(b,d,e,f,g)},d.isPath=!1;return d},c.initPath=function(a,d){var e,f,g,h,i;e={},h=null,i=[],g=function(b,d){var e,f,g,h,j,k,l,m;g=function(a){var c;c=[],b.forEachValue(function(b){return d.getObjects(b,a.property).visit(function(a){return c.push(a)})});return c},f=function(a){var c;c=[],b.forEachValue(function(b){return d.getSubjects(b,a.property).visit(function(a){return c.push(a)})});return c};for(h=0,m=i.length;0<=m?h<m:h>m;0<=m?h++:h--)j=i[h],j.isMultiple?(e=[],j.forward?(e=g(j),a=d.getProperty(j.property),k=a!=null?a.getValueType():"text"):(e=f(j),k="item"),b=c.initCollection(e,k)):j.forward?(l=d.getObjectsUnion(b.getSet(),j.property),a=d.getProperty(j.property),k=a!=null?a.getValueType():"text",b=c.initCollection(l,k)):(l=d.getSubjectsUnion(b.getSet(),j.property),b=c.initCollection(l,"item"));return b},f=function(d,e,f){var g,h,j,k,l,m,n,o;j=function(a){var b;b=[],d.forEachValue(function(c){return f.getSubjects(c,a.property).visit(function(a){if(k>0||e==null||e.contains(a))return b.push(a)})});return b},h=function(a){var b;b=[],d.forEachValue(function(c){return f.getObjects(c,a.property).visit(function(a){if(k>0||e==null||e.contains(a))return b.push(a)})});return b},e instanceof Array&&(e=b.Data.initSet(e));for(k=o=i.length-1;o<=0?k<=0:k>=0;o<=0?k++:k--)l=i[k],l.isMultiple?(g=[],l.forward?(g=j(l),a=f.getProperty(l.property),m=a!=null?a.getValueType():"text"):(g=h(l),m="item"),d=c.initCollection(g,m)):l.forward?(n=f.getSubjectsUnion(d.getSet(),l.property,null,k===0?e:null),d=c.initCollection(n,"item")):(n=f.getObjectsUnion(d.getSet(),l.property,null,k===0?e:null),a=f.getProperty(l.property),m=a!=null?a.getValueType():"text",d=c.initCollection(n,m));return d},a!=null&&i.push({property:a,forward:d,isMultiple:!1}),e.isPath=!0,e.setRootName=function(a){return h=a},e.appendSegment=function(a,b){return i.push({property:a,forward:b[0]===".",isMultiple:b.length>1})},e.getSegment=function(a){var b;if(a<i.length){b=i[a];return{property:b.property,forward:b.forward,isMultiple:b.isMultiple}}return null},e.getLastSegment=function(){return e.getSegment(i.length-1)},e.getSegmentCount=function(){return i.length},e.rangeBackward=function(c,d,e,f){var g,h,j,k,l;j=b.Data.initSet(),k="item";if(i.length>0){h=i[i.length-1];if(h.forward)f.getSubjectsInRange(h.property,c,d,!1,j,i.length===1?e:null);else throw new Error("Last path of segment must be forward");for(g=l=i.length-2;l<=0?g<=0:g>=0;l<=0?g++:g--)h=i[g],h.forward?(j=f.getSubjectsUnion(j,h.property,null,g===0?e:null),k="item"):(j=f.getObjectsUnion(j,h.property,null,g===0?e:null),a=f.getPropertysegment.property,k=a!=null?a.getValueType():"text")}return{valueType:k,values:j,count:j.size()}},e.evaluate=function(a,b,d,e){var f,i,j,k;j=h!=null?h:d,k=b[j]!=null?b[j]:"text",f=null;if(a[j]!=null){i=a[j],i.isSet||i instanceof Array?f=c.initCollection(i,k):f=c.initCollection([i],k);return g(f,e)}throw new Error("No such variable called "+j)},e.testExists=function(a,b,c,d){return e.evaluate(a,b,c,d).size()>0},e.evaluateBackward=function(a,b,d,e){var g;g=c.initCollection([a],b);return f(g,d,e)},e.walkForward=function(a,b,d){return g(c.initCollection
(a,b),d)},e.walkBackward=function(a,b,d,e){return f(c.initCollection(a,b),d,e)};return e},c.initParser=a.initParser=function(){var a,b;b={},a=function(a,b){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;p=a.token(),d=c.initScanner,g=function(){a.next();return p=a.token()},m=function(){var a,b,e;b=j();while(p!=null&&p.type===d.OPERATOR&&((e=p.value)==="*"||e==="/"))a=p.value,g(),b=c.initOperator(a,[b,j()]);return b},l=function(){var a,b,e;b=m();while(p!=null&&p.type===d.OPERATOR&&((e=p.value)==="+"||e==="-"))a=p.value,g(),b=c.initOperator(a,[b,m()]);return b},h=function(){var a,b,e;a=l();while(p!=null&&p.type===d.OPERATOR&&((e=p.value)==="="||e==="<>"||e==="<"||e===">"||e==="<="||e===">="))b=p.value,g(),a=c.initOperator(b,[a,l()]);return a},i=function(){var a;a=[h()];while(p!=null&&p.type===d.DELIMITER&&p.value===",")g(),a.push(h());return a},f=function(){return p!=null?p.start:a.index()},k=function(){var a,b;b=c.initPath();while(p!=null&&p.type===d.PATH_OPERATOR){a=p.value,g();if(p!=null&&p.type===d.IDENTIFIER)b.appendSegment(p.value,a),g();else throw new Error("Missing property ID at position "+f())}return b},j=function(){var a,b,e;e=null,a=[];if(p==null)throw new Error("Missing factor at end of expression");switch(p.type){case d.NUMBER:e=c.initConstant(p.value,"number"),g();break;case d.STRING:e=c.initConstant(p.value,"text"),g();break;case d.PATH_OPERATOR:e=k();break;case d.IDENTIFIER:b=p.value,g();if(c.controls[b]!=null){if(p==null||p.type!==d.DELIMITER||p.value!=="(")throw new Error("Missing ( to start "+b+" at position "+f());g(),p!=null&&p.type===d.DELIMITER&&p.value===")"?a=[]:a=i(),e=c.initControlCall(b,a);if(p!=null&&p.type===d.DELIMITER&&p.value===")")g();else throw new Error("Missing ) to end "+b+" at position "+f())}else if(p!=null&&p.type===d.DELIMITER&&p.value==="("){g(),p!=null&&p.type===d.DELIMITER&&p.value===")"?a=[]:a=i(),e=c.initFunctionCall(b,a);if(p!=null&&p.type===d.DELIMITER&&p.value===")")g();else throw new Error("Missing ) after function call "+b+" at position "+f())}else e=k(),e.setRootName(b);break;case d.DELIMITER:if(p.value!=="(")throw new Error("Unexpected text "+p.value+" at position "+f());g(),e=h();if(p!=null&&p.type===d.DELIMITER&&p.value===")")g();else throw new Error("Missing ) at position "+f());break;default:throw new Error("Unexpected text "+p.value+" at position "+f())}return e};if(b){o=i(),e=[];for(q=0,r=o.length;q<r;q++)n=o[q],e.push(c.initExpression(n));return e}return[c.initExpression(h())]},b.parse=function(b,d,e){var f;d==null&&(d=0),e==null&&(e={}),f=c.initScanner(b,d);try{return a(f,!1)[0]}finally{e.index=f.token()!=null?f.token().start:f.index()}};return b},c.initScanner=function(a,b){var d,e,f,g,h,i;e={},h=a+" ",g=a.length,f=b,i=null,d=function(a){return"0123456789".indexOf(a)>=0},e.token=function(){return i},e.index=function(){return f},e.next=function(){var a,b,e,j;i=null;while(f<g&&" \t\r\n".indexOf(h.charAt(f))>=0)f+=1;if(f<g){b=h.charAt(f),e=h.charAt(f+1);if(".!".indexOf(b)<0){if("<>".indexOf(b)<0){if("+-*/=".indexOf(b)<0){if("()".indexOf(b)<0){if("\"'".indexOf(b)<0){if(d(b)){j=f;while(j<g&&d(h.charAt(j)))j+=1;if(j<g&&h.charAt(j)==="."){j+=1;while(j<g&&d(h.charAt(j)))j+=1}i={type:c.initScanner.NUMBER,value:parseFloat(h.substring(f,j)),start:f,end:j};return f=j}j=f;while(j<g){a=h.charAt(j);if("(),.!@ \t".indexOf(a)>=0)break;j+=1}i={type:c.initScanner.IDENTIFIER,value:h.substring(f,j),start:f,end:j};return f=j}j=f+1;while(j<g){if(h.charAt(j)===b&&h.charAt(j-1)!=="\\")break;j+=1}if(j<g){i={type:c.initScanner.STRING,value:h.substring(f+1,j).replace(/\\'/g,"'").replace(/\\"/g,'"'),start:f,end:j+1};return f=j+1}throw new Error("Unterminated string starting at "+String(f))}i={type:c.initScanner.DELIMITER,value:b,start:f,end:f+1};return f+=1}i={type:c.initScanner.OPERATOR,value:b,start:f,end:f+1};return f+=1}if(e==="="||"<>".indexOf(e)>=0&&b!==e){i={type:c.initScanner.OPERATOR,value:b+e,start:f,end:f+2};return f+=2}i={type:c.initScanner.OPERATOR,value:b,start:f,end:f+1};return f+=1}if(e==="@"){i={type:c.initScanner.PATH_OPERATOR,value:b+e,start:f,end:f+2};return f+=2}i={type:c.initScanner.PATH_OPERATOR,value:b,start:f,end:f+1};return f+=1}},e.next();return e},c.initScanner.DELIMITER=0,c.initScanner.NUMBER=1,c.initScanner.STRING=2,c.initScanner.IDENTIFIER=3,c.initScanner.OPERATOR=4,c.initScanner.PATH_OPERATOR=5,c.functions={},c.FunctionUtilities={};return a.registerSimpleMappingFunction=function(a,d,e){return c.functions[a]={f:function(a){var f,g,h,i,j;h=b.Data.initSet(),g=function(a){return a.forEachValue(function(a){var b;b=d(a);if(b!=null)return h.add(b)})};for(i=0,j=a.length;i<j;i++)f=a[i],g(f);return c.initCollection(h,e)}}}}),b.namespace("Presentation",function(c){c.initInstance=function(){var c;c=1<=arguments.length?e.call(arguments,0):[];return b.initInstance.apply(b,["MITHGrid.Presentation"].concat(e.call(c),[function(b,c){var d,e,f,g,h;d=null,h={},f=b.options.lenses||{},g=b.options,a(c).empty(),e=void 0,g.lensKey||(g.lensKey=[".type"]),b.getLens=function(a){var b,c;e!=null&&(c=e.evaluate([a]),b=c[0]);if(b!=null&&f[b]!=null)return{render:f[b]}},b.addLens=function(a,c){f[a]=c;return b.selfRender()},b.removeLens=function(a){return delete f[a]},b.hasLens=function(a){return f[a]!=null},b.visitRenderings=function(a){var b,c;for(b in h){c=h[b];if(!1===a(b,c))return}},b.renderingFor=function(a){return h[a]},b.renderItems=function(a,f){var i,j,k;e==null&&(e=a.prepare(g.lensKey)),j=f.length,k=j,k>200&&(k=parseInt(Math.sqrt(k),10)+1),k<1&&(k=1),i=function(e){var g,l,m,o,p;if(e<j){g=e+k,g>j&&(g=j);for(m=e;e<=g?m<g:m>g;e<=g?m++:m--)o=f[m],l=a.contains(o)&&b.hasLensFor(o),h[o]!=null?l?h[o].update(a.getItem(o)):(d===o&&h[o].eventUnfocus!=null&&h[o].eventUnfocus(),h[o].remove!=null&&h[o].remove(),delete h[o]):l&&(p=b.render(c,a,o),p!=null&&(h[o]=p,d===o&&p.eventFocus!=null&&p.eventFocus()));return setTimeout(function(){return i(g)},0)}return b.finishDisplayUpdate()},b.startDisplayUpdate();return i(0)},b.render=function(a,c,d){var e;e=b.getLens(d);if(e!=null)return e.render(a,b,c,d)},b.hasLensFor=function(a){var c;c=b.getLens(a);return c!=null},b.eventModelChange=b.renderItems,b.startDisplayUpdate=function(){},b.finishDisplayUpdate=function(){},b.selfRender=function(){return b.renderItems(b.dataView,b.dataView.items())},b.eventFocusChange=function(a){var c;d!=null&&(c=b.renderingFor(d)),d!==a&&(c!=null&&c.eventUnfocus!=null&&c.eventUnfocus(),a!=null&&(c=b.renderingFor(a),c!=null&&c.eventFocus!=null&&c.eventFocus()),d=a);return d},b.getFocusedRendering=function(){return d!=null?b.renderingFor(d):null},b.dataView=b.options.dataView;return b.dataView.registerPresentation(b)}]))};return c.namespace("SimpleText",function(a){return a.initInstance=function(){var a,c;a=1<=arguments.length?e.call(arguments,0):[];return(c=b.Presentation).initInstance.apply(c,["MITHGrid.Presentation.SimpleText"].concat(e.call(a),[function(a,b){}]))}})}),b.namespace("Facet",function(c){c.initInstance=function(){var c;c=1<=arguments.length?e.call(arguments,0):[];return b.initInstance.apply(b,["MITHGrid.Facet"].concat(e.call(c),[function(b,c){var d;d=b.options,b.selfRender=function(){},b.eventFilterItem=function(a,b){return!1},b.eventModelChange=function(a,b){},b.constructFacetFrame=function(b,c){var d;d={},a(b).addClass("mithgrid-facet"),d.header=a("<div class='header' />"),c.onClearAllSelections!=null&&(d.controls=a("<div class='control' title='Clear Selection'>"),d.counter=a("<span class='counter'></span>"),d.controls.append(d.counter),d.header.append(d.controls)),d.title=a("<span class='title'></span>"),d.title.text(c.facetLabel||""),d.header.append(d.title),d.bodyFrame=a("<div class='body-frame'></div>"),d.body=a("<div class='body'></div>"),d.bodyFrame.append(d.body),a(b).append(d.header),a(b).append(d.bodyFrame),c.onClearAllSelections!=null&&d.controls.bind("click",c.onClearAllSelections),d.setSelectionCount=function(a){d.counter.innerHTML=a;return a>0?d.counter.show():d.counter.hide()};return d};return d.dataView.registerFilter(b)}]))},c.namespace("TextSearch",function(d){return d.initInstance=function(){var d;d=1<=arguments.length?e.call(arguments,0):[];return c.initInstance.apply(c,["MITHGrid.Facet.TextSearch"].concat(e.call(d),[function(c){var d,e,f;e=c.options,e.expressions!=null&&(a.isArray(e.expressions)||(e.expressions=[e.expressions],f=function(){var a,c,f,g;f=e.expressions,g=[];for(a=0,c=f.length;a<c;a++)d=f[a],g.push(b.Expression.initParser().parse(d));return g}())),c.eventFilterItem=function(a,b){var d,g,h,i,j,k,l,m;if(c.text!=null&&e.expressions!=null)for(i=0,k=f.length;i<k;i++){d=f[i],g=d.evaluateOnItem(b,a),m=g.values.items();for(j=0,l=m.length;j<l;j++){h=m[j];if(h.toLowerCase().indexOf(c.text)>=0)return}}return!1},c.eventModelChange=function(a,b){};return c.selfRender=function(){var b,d;b=c.constructFacetFrame(container,null,{facetLabel:e.facetLabel}),a(container).addClass("mithgrid-facet-textsearch"),d=a("<input type='text'>"),b.body.append(d);return d.keyup(function(){c.text=a.trim(d.val().toLowerCase());return c.events.onFilterChange.fire()})}}]))}}),c.namespace("List",function(d){return d.initInstance=function(){var d;d=1<=arguments.length?e.call(arguments,0):[];return c.initInstance.apply(c,["MITHGrid.Facet.List"].concat(e.call(d),[function(c){var d,e,g;e=c.options,c.selections=[],e.expressions!=null&&(a.isArray(e.expressions)||(e.expressions=[e.expressions],g=function(){var a,c,f,g;f=e.expressions,g=[];for(a=0,c=f.length;a<c;a++)d=f[a],g.push(b.Expression.initParser().parse(d));return g}())),c.eventFilterItem=function(a,b){var d,h,i,j,k,l,m,n;if(c.text!=null&&e.expressions!=null)for(j=0,l=g.length;j<l;j++){d=g[j],h=d.evaluateOnItem(b,a),n=h.values.items();for(k=0,m=n.length;k<m;k++){i=n[k];if(f.call(c.selections,i)>=0)return}}};return c.selfRender=function(){var a;return a=c.constructFacetFrame(container,null,{facetLabel:e.facetLabel,resizable:!0})}}]))}});return c.namespace("Range",function(b){return b.initInstance=function(){var b;b=1<=arguments.length?e.call(arguments,0):[];return c.initInstance.apply(c,["MITHGrid.Facet.Range"].concat(e.call(b),[function(b){var c;c=b.options,c.min==null&&(c.min=0),c.max==null&&(c.max=100),c.step==null&&(c.step=1/30);return b.selfRender=function(){var d,e;d=b.constructFacetFrame(container,null,{facetLabel:c.facetLabel,resizable:!1}),e=a("<input type='range'>"),e.attr({min:c.min,max:c.max,step:c.step}),d.body.append(e);return e.event(function(){b.value=e.val();return b.events.onFilterChange.fire()})}}]))}})}),b.namespace("Controller",function(c){c.initInstance=function(){var c;c=1<=arguments.length?e.call(arguments,0):[];return b.initInstance.apply(b,["MITHGrid.Controller"].concat(e.call(c),[function(c){var d,f;d=c.options,d.selectors==null&&(d.selectors={}),(f=d.selectors)[""]==null&&(f[""]=""),c.initBind=function(c){return b.initInstance(d.bind,function(b){var e;e={"":a(c)},b.locate=function(b){var f,g;g=d.selectors[b];if(g!=null){g===""?f=a(c):f=a(c).find(g),e[g]=f;return f}},b.fastLocate=function(a){var c;c=d.selectors[a];if(c!=null){if(e[c]!=null)return e[c];return b.locate(a)}},b.refresh=function(b){var f,g,h,i;for(h=0,i=b.length;h<i;h++)f=b[h],g=d.selectors[f],g!=null&&(g===""?e[""]=a(c):e[g]=a(c).find(g))};return b.clearCache=function(){return e={"":a(c)}}})},c.bind=function(){var a,b,d;d=arguments[0],a=2<=arguments.length?e.call(arguments,1):[],b=c.initBind(d),c.applyBindings.apply(c,[b].concat(e.call(a))),b.unbind=function(){return c.removeBindings.apply(c,[b].concat(e.call(a)))};return b},c.applyBindings=function(){var a,b;b=arguments[0],a=2<=arguments.length?e.call(arguments,1):[]};return c.removeBindings=function(){var a,b;b=arguments[0],a=2<=arguments.length?e.call(arguments,1):[]}}]))};return c.namespace("Raphael",function(a){return a.initInstance=function(){var a,c;a=1<=arguments.length?e.call(arguments,0):[];return(c=b.Controller).initInstance.apply(c,["MITHGrid.Controller.Raphael"].concat(e.call(a),[function(a){var b;b=a.initBind;return a.initBind=function(a){var c,d,e,f,g;c=b(a.node),f=c.locate,e=c.fastLocate,g=c.refresh,d=c.bind,c.locate=function(b){return b==="raphael"?a:f(b)},c.fastLocate=function(b){return b==="raphael"?a:e(b)},c.refresh=function(a){var b;a=function(){var c,d,e;e=[];for(c=0,d=a.length;c<d;c++)b=a[c],b!=="raphael"&&e.push(b);return e}();return g(a)};return c}}]))}})}),b.namespace("Application",function(c){return c.initInstance=function(){var c;c=1<=arguments.length?e.call(arguments,0):[];return b.initInstance.apply(b,["MITHGrid.Application"].concat(e.call(c),[function(c,d){var e,f,g;f=[],c.presentation={},c.facet={},c.component={},c.dataStore={},c.dataView={},c.controller={},g=c.options,e=function(){var a,b,d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;if((g!=null?g.dataStores:void 0)!=null){p=g.dataStores;for(j in p)d=p[j],c.addDataStore(j,d)}if((g!=null?g.dataViews:void 0)!=null){q=g.dataViews;for(l in q)k=q[l],c.addDataView(l,k)}if((g!=null?g.controllers:void 0)!=null){r=g.controllers;for(a in r)b=r[a],c.addController(a,b)}if((g!=null?g.facets:void 0)!=null){s=g.facets;for(e in s)f=s[e],c.addFacet(e,f)}if((g!=null?g.components:void 0)!=null){t=g.components;for(a in t)b=t[a],c.addComponent(a,b)}if((g!=null?g.presentations:void 0)!=null){u=g.presentations;for(h in u)i=u[h],c.addPresentation(h,i)}if((g!=null?g.plugins:void 0)!=null){o=g.plugins,v=[];for(m=0,n=o.length;m<n;m++)i=o[m],v.push(c.addPlugin(i));return v}},c.ready=function(a){return f.push(a)},c.addDataStore=function(a,d){var e,f,g,h,i,j,k,l;c.dataStore[a]==null?(g=b.Data.Store.initInstance(),c.dataStore[a]=g,g.addType("Item"),g.addProperty("label",{valueType:"text"}),g.addProperty("type",{valueType:"text"}),g.addProperty("id",{valueType:"text"})):g=c.dataStore[a];if((d!=null?d.types:void 0)!=null){j=d.types;for(h in j)i=j[h],g.addType(h)}if((d!=null?d.properties:void 0)!=null){k=d.properties,l=[];for(e in k)f=k[e],l.push(g.addProperty(e,f));return l}},c.addDataView=function(a,d){var e,f,g,h,i;d.type!=null&&d.type.initInstance!=null?e=d.type.initInstance:e=b.Data.View.initInstance,i={dataStore:c.dataStore[d.dataStore]||c.dataView[d.dataStore]};if(c.dataView[a]==null){for(f in d)g=d[f],f!=="type"&&!i[f]&&(i[f]=g);h=e(i);return c.dataView[a]=h}},c.addController=function(b,d){var e,f;f=a.extend(!0,{},d),f.application=c,e=d.type.initInstance(f);return c.controller[b]=e},c.addFacet=function(b,e){var f;f=a.extend(!0,{},e);return c.ready(function(){var g,h;h=a(d).find(e.container),a.isArray(h)&&(h=h[0]),f.dataView=c.dataView[e.dataView],f.application=c,g=e.type.initFacet(h,f),c.facet[b]=g;return g.selfRender()})},c.addComponent=function(b,e){var f;f=a.extend(!0,{},cconfig);return c.ready(function(){var g,h,i,j,k,l;i=a(d).find(f.container),a.isArray(i)&&(i=i[0]),f.application=c;if(h.components!=null){f.components={},k=h.components;for(g in k)h=k[g],typeof h=="string"?f.components[g]=c.component[g]:(j=a.extend(!0,{},ccconfig),j.application=c,f.components[g]=h.type.initInstance(j))}if(h.controllers!=null){f.controllers={},l=e.controllers;for(g in l)h=l[g],typeof h=="string"?f.controllers[g]=c.controller[g]:(j=a.extend(!0,{},ccconfig),j.application=c,f.controllers[g]=h.type.initInstance(j))}return c.component[b]=h.type.initInstance(i,f)})},c.addPresentation=function(b,e){var f;f=a.extend(!0,{},e);return c.ready(function(){var g,h,i,j,k,l,m,n,o;l=a(d).find(f.container),a.isArray(l)&&(l=l[0]),f.dataView=c.dataView[e.dataView],f.application=c;if(e.components!=null){f.components={},n=e.components;for(h in n)i=n[h],typeof i=="string"?f.components[h]=c.component[h]:(j=a.extend(!0,{},ccconfig),j.application=c,f.components[h]=i.type.initInstance(j))}if(e.controllers!=null){f.controllers={},o=e.controllers;for(g in o)i=o[g],typeof i=="string"?f.controllers[g]=c.controller[g]:(k=a.extend(!0,{},i),k.application=c,f.controllers[g]=i.type.initInstance(k))}m=e.type.initInstance(l,f),c.presentation[b]=m;return m.selfRender()})},c.addPlugin=function(b){var e,f,g,h,i,j,k,l,m,n,o,p;e=a.extend(!0,{},b),e.application=c,f=e.type.initPlugin(e);if(f!=null){if((e!=null?e.dataView:void 0)!=null){f.dataView=c.dataView[e.dataView],m=f.getTypes();for(k in m)l=m[k],f.dataView.addType(k);n=f.getProperties();for(i in n)j=n[i],f.dataView.addProperty(i,j)}o=f.getPresentations(),p=[];for(g in o)h=o[g],p.push(function(b,g){return c.ready(function(){var h,i,j;j=a.extend(!0,{},g.options),h=a(d).find(g.container),a.isArray(h)&&(h=h[0]),(g!=null?g.lenses:void 0)!=null&&(j.lenses=g.lenses),g.dataView!=null?j.dataView=c.dataView[g.dataView]:e.dataView!=null&&(j.dataView=c.dataView[e.dataView]),j.application=c,i=g.type.initInstance(h,j),f.presentation[b]=i;return i.selfRender()})});return p}},e();return c.run=function(){return a(document).ready(function(){var a,b,d;for(b=0,d=f.length;b<d;b++)a=f[b],a();f=[];return c.ready=function(a){return a()}})}}]))}}),b.namespace("Plugin",function(a){return a.initPlugin=function(a,b){var c,d;d={options:b,presentation:{}},c=[],d.getTypes=function(){return(b!=null?b.types:void 0)!=null?b.types:[]},d.getProperties=function(){return(b!=null?b.properties:void 0)!=null?b.properties:[]},d.getComponents=function(){return(b!=null?b.components:void 0)!=null?b.components:[]},d.getPresentations=function(){return(b!=null?b.presentations:void 0)!=null?b.presentations:[]},d.ready=c.push,d.eventReady=function(a){var b,e,f;for(e=0,f=c.length;e<f;e++)b=c[e],b(a);c=[];return d.ready=function(b){return b(a)}};return d}}),b.initView=b.initInstance,b.Data.initSet=b.Data.Set.initInstance,b.Data.initType=b.Data.Type.initInstance,b.Data.initProperty=b.Data.Property.initInstance,b.Data.initStore=b.Data.Store.initInstance,b.Data.initView=b.Data.View.initInstance,b.Presentation.initPresentation=b.Presentation.initInstance,b.Presentation.SimpleText.initPresentation=b.Presentation.SimpleText.initInstance;return b.Application.initApp=b.Application.initInstance}(b,a),a.defaults("MITHGrid.Data.Store",{events:{onModelChange:null,onBeforeLoading:null,onAfterLoading:null,onBeforeUpdating:null,onAfterUpdating:null}}),a.defaults("MITHGrid.Data.View",{events:{onModelChange:null,onFilterItem:"preventable"}}),a.defaults("MITHGrid.Data.SubSet",{events:{onModelChange:null}}),a.defaults("MITHGrid.Data.Pager",{events:{onModelChange:null}}),a.defaults("MITHGrid.Data.RangePager",{events:{onModelChange:null}}),a.defaults("MITHGrid.Data.ListPager",{events:{onModelChange:null}}),a.defaults("MITHGrid.Facet",{events:{onFilterChange:null}}),a.defaults("MITHGrid.Facet.TextSearch",{facetLabel:"Search",expressions:[".label"]})}).call(this)
;