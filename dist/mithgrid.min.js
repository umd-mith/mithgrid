/*
 * mithgrid JavaScript Library v0.0.1
 *
 * Date: Wed Jan 4 08:46:44 2012 -0500
 *
 * (c) Copyright University of Maryland 2011.  All rights reserved.
 *
 * (c) Copyright Texas A&M University 2010.  All rights reserved.
 *
 * 2. Redistributions in binary form must reproduce the above copyright
 *    documentation and/or other materials provided with the distribution.
 *
 * 3. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */
(function(){var a,b,c,d,e=Array.prototype.slice,f=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1};a=(c=this.MITHGrid)!=null?c:this.MITHGrid={},b=(d=this.jQuery)!=null?d:this.jQuery={},function(a,b){var c,d,g,h,i,j,k,l,m,n;(typeof window!="undefined"&&window!==null?(n=window.console)!=null?n.log:void 0:void 0)!=null?b.debug=window.console.log:b.debug=function(){},b.error=function(){b.debug.call({},arguments);return{arguments:arguments}},k=function(a,c){var d;a[c]==null&&(d={namespace:function(a){return k(d,a)},debug:b.debug});return a[c]=d},b.namespace=function(a){return k(b,a)},b.globalNamespace=function(a){var c,d,e;c=window,c[a]||(c[a]={}),(d=c[a]).debug||(d.debug=b.debug),(e=c[a]).namespace||(e.namespace=function(b){return k(c[a],b)});return c[a]},b.normalizeArgs=function(b,c,d,e){e==null&&a.isPlainObject(d)&&(e=d,d=void 0),d==null&&typeof c!="string"&&(a.isArray(c)||(d=c,c=[])),e==null?typeof c=="string"?(c=[c,b],e={}):a.isArray(c)?(c.push(b),e={}):(e=c,c=b):typeof c=="string"?c=[c,b]:a.isArray(c)?c.push(b):c=b;return[c,d,e]},j={},b.defaults=function(b,c){j[b]||(j[b]={});return j[b]=a.extend(!0,j[b],c)},b.initEventFirer=function(a,b){var c,d;d={},d.isPreventable=a,d.isUnicast=b,c=[],d.addListener=function(a,b){return c.push([a,b])},d.removeListener=function(a){var b;return typeof a=="string"?c=function(){var d,e,f;f=[];for(d=0,e=c.length;d<e;d++)b=c[d],b[1]!==a&&f.push(b);return f}():c=function(){var d,e,f;f=[];for(d=0,e=c.length;d<e;d++)b=c[d],b[0]!==a&&f.push(b);return f}()},b?d.fire=function(){var a,b;a=1<=arguments.length?e.call(arguments,0):[];if(c.length<=0)return!0;try{return(b=c[0])[0].apply(b,a)}catch(d){return console.log(d)}}:a?d.fire=function(){var a,b,d,f,g,h;a=1<=arguments.length?e.call(arguments,0):[],f=!0;for(g=0,h=c.length;g<h;g++){d=c[g],b=d[0];try{f=b.apply(null,a)}catch(i){console.log(i)}if(f===!1)return!1}return!0}:d.fire=function(){var a,b,d,f;a=1<=arguments.length?e.call(arguments,0):[];for(d=0,f=c.length;d<f;d++){b=c[d];try{b[0].apply(b,a)}catch(g){console.log(b[0],a,g)}}return!0};return d},l=0,b.initView=function(c,d,e){var g,h,i,k,m,n,o,p,q;e==null&&(e=d,d=void 0),e==null&&typeof c!="string"&&!a.isArray(c)&&(e=c,c=null),n={},m={};if(c!=null){typeof c=="string"&&(c=[c]),c.reverse();for(o=0,p=c.length;o<p;o++){k=c[o],g=k.split("."),k=g.shift(),m=a.extend(!0,{},j[k]||{});while(g.length>0)k=k+"."+g.shift(),m=a.extend(!0,m,j[k]||{})}}m=a.extend(!0,m,e||{}),l+=1,n.id=l,n.options=m,n.container=d,n.events={};if(n.options.events!=null){q=n.options.events;for(i in q)h=q[i],h!=null?typeof h=="string"&&(h=[h]):h=[],n.events[i]=b.initEventFirer(f.call(h,"preventable")>=0,f.call(h,"unicast")>=0)}return n},g=b.namespace("Data"),g.namespace("Set"),g.initSet=g.Set.initInstance=function(a){var b,c,d,e,f,g,h,i;g={},d={},b=0,f=!0,e=[],g.isSet=!0,g.items=function(){var a;if(f){e=[];for(a in d)typeof a=="string"&&d[a]===!0&&e.push(a)}return e},g.add=function(a){if(d[a]==null){d[a]=!0,f=!0;return b+=1}},g.remove=function(a){if(d[a]!=null){delete d[a],f=!0;return b-=1}},g.empty=function(){d={},b=0,f=!1,e=[];return},g.visit=function(a){var b,c;c=[];for(b in d)if(a(b)===!0)break;return c},g.contains=function(a){return d[a]!=null},g.size=function(){return f?g.items().length:e.length};if(a instanceof Array)for(h=0,i=a.length;h<i;h++)c=a[h],g.add(c);return g},g.namespace("Type"),g.initType=g.Type.initInstance=function(a){var b;return b={name:a,custom:{}}},g.namespace("Property"),g.initProperty=g.Property.initInstance=function(a){var b;return b={name:a,getValueType:function(){var a;return(a=b.valueType)!=null?a:"text"}}},g.namespace("Store"),g.initStore=g.Store.initInstance=function(c){var d,e,h,i,j,k,l,m,n,o;k=!1,l=g.initSet(),o={},j={},m={},i={},c!=null?c:c={},n=b.initView("MITHGrid.Data.Store",c),n.items=l.items,n.contains=l.contains,n.visit=l.visit,h=function(a,b,c,d){var e,g,h;h=a[b],h==null&&(h={values:{},counts:{}},a[b]=h),e=h.values[c],g=h.counts[c],e==null&&(e=[],h.values[c]=e);if(g==null)g={},h.counts[c]=g;else if(f.call(e,d)>=0){g[d]+=1;return}e.push(d);return g[d]=1},e=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n;g=a[b];if(g!=null){f=g.values[c];if(f!=null){if(e!=null){m=[];for(i=0,k=f.length;i<k;i++)h=f[i],m.push(e.contains(h)?d.add(h):void 0);return m}n=[];for(j=0,l=f.length;j<l;j++)h=f[j],n.push(d.add(h));return n}}},d=function(a,b,c,d,f){d==null&&(d=g.initSet()),b.visit(function(b){return e(a,b,c,d,f)});return d},n.addProperty=function(a,b){var c;c=g.initProperty(a),(b!=null?b.valueType:void 0)!=null&&(c.valueType=b.valueType,j[a]=c);return c},n.getProperty=function(a){var b;return(b=j[a])!=null?b:g.initProperty(a)},n.addType=function(a,b){var c;c=g.initType(a),o[a]=c;return c},n.getType=function(a){var b;return(b=o[a])!=null?b:g.initType(a)},n.getItem=function(a){var b,c;return(b=(c=m[a])!=null?c.values:void 0)!=null?b:{}},n.getItems=function(b){if(!a.isArray(b))return[n.getItem(b)];return a.map(b,function(a,b){return n.getItem(a)})},n.fetchData=function(b){return a.ajax({url:b,dataType:"json",success:function(a,b){return n.loadData(a)}})},n.removeItems=function(b,c){var d,e,f,g,h,j,k,o;e=[],f=function(b,c,d,e){var f,g,h,i,j,k,l;h=b[c];if(h!=null){f=h.values[d],g=h.counts[d];if(f==null||g==null)return;g[e]-=1;if(g[e]<1){i=a.inArray(e,f),i===0?f=f.slice(1,f.length):i===f.length-1?f=f.slice(0,i):i>0&&(f=f.slice(0,i).concat(f.slice(i+1,f.length))),f.length>0?h.values[d]=f:delete h.values[d],delete g[e],k=0;for(j in g)l=g[j],k+=l;if(k===0)return delete b[c]}}},g=function(a,b,c){f(m,a,b,c);return f(i,c,b,a)},j=function(a,b,c){var d,e,f,h;h=[];for(e=0,f=c.length;e<f;e++)d=c[e],h.push(g(a,b,d));return h},h=function(b,c){var d,e,f,g;d=n.getItem(b),g=d.type,a.isArray(g)&&(g=g[0]);for(f in d){e=d[f];if(typeof f!="string"||f==="id"||f==="type")continue;j(b,f,e)}return j(b,"type",[g])};for(k=0,o=b.length;k<o;k++)d=b[k],h(d,g),e.push(d),l.remove(d);n.events.onModelChange.fire(n,e);if(c!=null)return c()},n.updateItems=function(b,c){var d,e,f,g,j,k,l,o;f=[],j=function(b,c,d,e){var f,g,h,i;h=b[c];if(h!=null){f=h.values[d],g=h.counts[d];if(f==null||g==null)return;g[e]-=1;if(g[e]<1){i=a.inArray(e,f),i===0?f=f.slice(1,f.length):i===f.length-1?f=f.slice(0,i):i>0&&(f=f.slice(0,i).concat(f.slice(i+1,f.length))),f.length>0?h.values[d]=f:delete h.values[d];return delete g[e]}}},g=function(a,b,c){h(m,a,b,c);return h(i,c,b,a)},k=function(a,b,c){j(m,a,b,c);return j(i,c,b,a)},o=function(b,c,d){var e,f,g,h,i,j,k,l,m,o;f=b.id,o=b.type,e=!1,g=function(a,b){var c,d,e;d=!0;if(a.length!==b.length)return!1;for(c=0,e=a.length;0<=e?c<e:c>e;0<=e?c++:c--)a[c]!==b[c]&&(d=!1);return d},l=function(a,b,c){var e,f,g,h;h=[];for(f=0,g=c.length;f<g;f++)e=c[f],h.push(d(a,b,e));return h},k=function(a,b,d){var e,f,g,h;h=[];for(f=0,g=d.length;f<g;f++)e=d[f],h.push(c(a,b,e));return h},a.isArray(f)&&(f=f[0]),a.isArray(o)&&(o=o[0]),i=n.getItem(f);for(j in b){h=b[j];if(typeof j!="string"||j==="id"||j==="type")continue;a.isArray(h)||(h=[h]),m=h.length,i[j]==null?(k(f,j,h),e=!0):g(h,i[j])||(e=!0,l(f,j,i[j]),k(f,j,h))}return e},n.events.onBeforeUpdating.fire(n),l=b.length,d=parseInt(l/100,10),d>200&&(d=200),d<1&&(d=1),e=function(a){var h,i,j;h=a+d,h>l&&(h=l);for(j=a;a<=h?j<h:j>h;a<=h?j++:j--)i=b[j],typeof i=="object"&&o(i,g,k)&&f.push(i.id);if(h<l)return setTimeout(function(){return e(h)},0);n.events.onAfterUpdating.fire(n),n.events.onModelChange.fire(n,f);if(c!=null)return c()};return e(0)},n.loadItems=function(c,d){var e,f,g,j,k,o;g=[],j=function(a,b,c){h(m,a,b,c);return h(i,c,b,a)},k=function(c,d){var e,f,h,i,k,m;if(c.id==null)throw b.error("Item entry has no id: ",c);if(c.type==null)throw b.error("Item entry has no type: ",c);e=c.id,h=c.type,a.isArray(e)&&(e=e[0]),a.isArray(h)&&(h=h[0]),l.add(e),g.push(e),j(e,"type",h),j(e,"id",e),m=[];for(f in c){i=c[f];if(typeof f!="string")continue;m.push(function(){var b,c,d;if(f!=="id"&&f!=="type"){if(a.isArray(i)){d=[];for(b=0,c=i.length;b<c;b++)k=i[b],d.push(j(e,f,k));return d}if(i!=null)return j(e,f,i)}}())}return m},n.events.onBeforeLoading.fire(n),o=c.length,d!=null?(e=parseInt(o/100,10),e>200&&(e=200)):e=o,e<1&&(e=1),f=function(a){var b,h,i;b=a+e,b>o&&(b=o);for(i=a;a<=b?i<b:i>b;a<=b?i++:i--)h=c[i],typeof h=="object"&&k(h);if(b<o)return setTimeout(function(){return f(b)},0);n.events.onAfterLoading.fire(n),n.events.onModelChange.fire(n,g);if(d!=null)return setTimeout(d,0)};return f(0)},n.prepare=function(a){var c,d,e,f;e=b.Expression.initParser(),d=function(){var b,d,f;f=[];for(b=0,d=a.length;b<d;b++)c=a[b],f.push(e.parse(c));return f}(),f=void 0;return{evaluate:function(a){var b,c,e,g,h;c=[],f=void 0,e=function(b){var d;d=b.evaluateOnItem(a,n),f||(f=d.valueType);return c=c.concat(d.values.items())};for(g=0,h=d.length;g<h;g++)b=d[g],e(b);return c},valueType:function(){return f}}},n.getObjectsUnion=function(a,b,c,e){return d(m,a,b,c,e)},n.getSubjectsUnion=function(a,b,c,e){return d(i,a,b,c,e)},n.registerPresentation=function(a){n.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)});return a.eventModelChange(n,n.items())};return n},g.namespace("View"),g.initView=g.View.initInstance=function(a){var c,d,e,h,i,j,k,l,m,n;l=b.initView("MITHGrid.Data.View",a),j=g.initSet(),d=function(a){return!1!==l.events.onFilterItem.fire(l.dataStore,a)},e=function(a){var b,c,e,f;e=l.dataStore.items(),f=e.length;if(f===0)a();else{f>200?(b=parseInt(f/100,10),b>200&&(b=200)):b=f,b<1&&(b=1),c=function(g){var h,i,k;h=g+b,h>f&&(h=f);for(i=g;g<=h?i<h:i>h;g<=h?i++:i--)k=e[i],d(k)?j.add(k):j.remove(k);if(h<f)return setTimeout(function(){return c(h)},0);l.items=j.items,l.size=j.size,l.contains=j.contains,l.visit=j.visit;if(a!=null)return setTimeout(a,0)};return c(0)}},l.registerFilter=function(a){l.events.onFilterItem.addListener(function(b,c){return a.eventFilterItem(b,c)}),l.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)});return a.events.onFilterChange.addListener(l.eventFilterChange)},l.registerPresentation=function(a){l.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)});return e(function(){return a.eventModelChange(l,l.items())})},l.items=j.items,l.size=j.size,l.contains=j.contains,l.visit=j.visit,l.eventFilterChange=function(){var a;a=g.initSet(l.items());return e(function(){var b,c,d,e,f,h,i,j;b=g.initSet(),i=a.items();for(d=0,f=i.length;d<f;d++)c=i[d],l.contains(c)||b.add(c);j=l.items();for(e=0,h=j.length;e<h;e++)c=j[e],a.contains(c)||b.add(c);if(b.size()>0)return l.events.onModelChange.fire(l,b.items())})},l.eventModelChange=function(a,b){var c,e,f,h;c=g.initSet();for(f=0,h=b.length;f<h;f++)e=b[f],a.contains(e)?d(e)?(j.add(e),c.add(e)):j.contains(e)&&(c.add(e),j.remove(e)):(c.add(e),j.remove(e));if(c.size()>0)return l.events.onModelChange.fire(l,c.items())},(a!=null?(m=a.types)!=null?m.length:void 0:void 0)>0&&function(a){return l.registerFilter({eventFilterItem:function(b,c){var d,e,g,h;d=b.getItem(c);if(d.type==null)return!1;for(g=0,h=a.length;g<h;g++){e=a[g];if(f.call(d.type,e)>=0)return}return!1},eventModelChange:function(a,b){},events:{onFilterChange:{addListener:function(a){}}}})}(a.types),(a!=null?(n=a.filters)!=null?n.length:void 0:void 0)>0&&function(a){var c,d,e;e=b.Expression.initParser(),d=function(){var b,d,f;f=[];for(b=0,d=a.length;b<d;b++)c=a[b],f.push(e.parse(c));return f}();return l.registerFilter({eventFilterItem:function(a,b){var c,e,f,g,h,i,j;for(g=0,i=d.length;g<i;g++){c=d[g],f=c.evaluateOnItem(b,a),f=f.values.items();for(h=0,j=f.length;h<j;h++){e=f[h];if(e!=="false")return}}return!1},eventModelChange:function(a,b){},events:{onFilterChange:{addListener:function(a){}}}})}(a.filters),(a!=null?a.collection:void 0)!=null&&l.registerFilter({eventFilterItem:a.collection,eventModelChange:function(a,b){},events:{onFilterChange:{addListener:function(a){}}}}),(a!=null?a.expressions:void 0)!=null&&(c=a.dataStore.prepare(a.expressions),i=l.eventModelChange,h=b.Data.initStore({}),k=b.Data.initSet(),l.eventModelChange=function(a,d){var e,g,j,l,m,n,o,p,q,r,s,t,u;m=[],o=[],j=b.Data.initSet(),j=h.getObjectsUnion(k,"mapsTo",j);for(q=0,s=d.length;q<s;q++){e=d[q];if(j.contains(e))m.push(e),a.contains(e)||(g=b.Data.initSet(),h.getSubjectsUnion(b.Data.initSet([e]),"mapsTo",g),g.visit(function(a){var b,c,d;c=h.getItem(a),d=c.mapsTo;if(d!=null){b=d.indexOf(e),b===0?d=d.slice(1,d.length):b===d.length-1?d=d.slice(0,d.length-1):b>-1&&(d=d.slice(0,b).concat(d.slice(b+1,d.length)));return h.updateItems([{id:a,mapsTo:d}])}}));else if(a.contains(e)){n=b.Data.initSet(),u=c.evaluate([e]);for(r=0,t=u.length;r<t;r++)p=u[r],n.add(p);h.contains(e)?h.updateItems([{id:e,mapsTo:n.items()}]):h.loadItems([{id:e,mapsTo:n.items()}])}else m=m.concat(h.getItem(e).mapsTo),o.push(e)}o.length>0&&h.removeItems(o),j=b.Data.initSet(),h.getObjectsUnion(k,"mapsTo",j),m=function(){var a,b,c;c=[];for(a=0,b=m.length;a<b;a++)l=m[a],f.call(d,l)>=0&&c.push(l);return c}();return i(j,m)}),l.dataStore=a.dataStore,l.getItems=l.dataStore.getItems,l.getItem=l.dataStore.getItem,l.removeItems=l.dataStore.removeItems,l.fetchData=l.dataStore.fetchData,l.updateItems=l.dataStore.updateItems,l.loadItems=l.dataStore.loadItems,l.prepare=l.dataStore.prepare,l.addType=l.dataStore.addType,l.getType=l.dataStore.getType,l.addProperty=l.dataStore.addProperty,l.getProperty=l.dataStore.getProperty,l.getObjectsUnion=l.dataStore.getObjectsUnion,l.getSubjectsUnion=l.dataStore.getSubjectsUnion,l.dataStore.events.onModelChange.addListener(l.eventModelChange);return l},g.namespace("ListPager"),g.ListPager.initInstance=function(a){var c,d,e,f,h,i,j,k;k=b.initView("MITHGrid.Data.ListPager",a),a=k.options,d=[],e=0,f=-1,h=void 0,i=void 0,c=function(a){return d.indexOf(a)},j=g.initSet(),k.items=j.items,k.size=j.size,k.contains=j.contains,k.visit=j.visit,k.dataStore=a.dataStore,k.getItems=k.dataStore.getItems,k.getItem=k.dataStore.getItem,k.removeItems=k.dataStore.removeItems,k.fetchData=k.dataStore.fetchData,k.updateItems=k.dataStore.updateItems,k.loadItems=k.dataStore.loadItems,k.prepare=k.dataStore.prepare,k.addType=k.dataStore.addType,k.getType=k.dataStore.getType,k.addProperty=k.dataStore.addProperty,k.getProperty=k.dataStore.getProperty,k.getObjectsUnion=k.dataStore.getObjectsUnion,k.getSubjectsUnion=k.dataStore.getSubjectsUnion,k.setList=function(a){var b,c,g,h,i,l,m,n;d=a,b=[];for(g=0,i=d.length;g<i;g++)c=d[g],k.dataStore.contains(c)&&!j.contains(c)?e<=(m=d.offset(c))&&m<f&&(b.push(c),j.add(c)):j.contains(c)&&!k.dataStore.contains(c)&&(b.push(c),j.remove(c));n=j.items();for(h=0,l=n.length;h<l;h++)c=n[h],k.dataStore.contains(c)||(b.push(c),j.remove(c));if(b.length>0)return k.events.onModelChange.fire(k,b)},k.eventModelChange=function(a,b){var d,g,h,i,l;d=[];for(i=0,l=b.length;i<l;i++)g=b[i],a.contains(g)?(h=c(g),j.contains(g)?(d.push(g),(e>h||h>=f)&&j.remove(g)):e<=h&&h<f&&(j.add(g),d.push(g))):(j.remove(g),d.push(g));if(d.length>0)return k.events.onModelChange.fire(k,d)},k.setKeyRange=function(a,b){var c,h;a<b?(e=a,f=b):(e=b,f=a),j=g.initSet(),k.items=j.items,k.size=j.size,k.contains=j.contains,k.visit=j.visit;if(e<f)for(c=e;e<=f?c<=f:c>=f;e<=f?c++:c--)h=d[c],oldSet.contains(h)||changedItems.add(h),j.add(h);oldSet.visit(function(a){if(!j.contains(a))return changedItems.add(a)});if(changedItems.size()>0)return k.events.onModelChange.fire(k,changedItems.items())},k.dataStore.registerPresentation(k),k.registerPresentation=function(a){k.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)});return a.eventModelChange(k,k.items())};return k},g.namespace("Pager"),g.initPager=g.Pager.initInstance=function(a){var c,d,e,f,h,i,j,k,l,m,n;n=b.initView("MITHGrid.Data.Pager",a),a=n.options,h=[],i=-1,j=-1,k=void 0,l=void 0,e=function(a){var b,c,d;if(a==null)return 0;b=0;if(a!=null){d=h.length-1;while(b<d)c=~~((b+d)/2),h[c][0]<a?b=c+1:h[c][0]===a?d=c:d=c-1}return b},f=function(a){var b,c,d;if(a==null)return h.length-1;b=0,d=h.length-1;if(a!=null)while(b<d)c=~~((b+d)/2),h[c][0]>a?d=c-1:b=c+1;return d},d=function(a){var b,c;for(b=0,c=h.length;0<=c?b<c:b>c;0<=c?b++:b--)if(h[b][1]===a)return b;return-1},m=g.initSet(),n.items=m.items,n.size=m.size,n.contains=m.contains,n.visit=m.visit,n.dataStore=a.dataStore,n.getItems=n.dataStore.getItems,n.getItem=n.dataStore.getItem,n.removeItems=n.dataStore.removeItems,n.fetchData=n.dataStore.fetchData,n.updateItems=n.dataStore.updateItems,n.loadItems=n.dataStore.loadItems,n.prepare=n.dataStore.prepare,n.addType=n.dataStore.addType,n.getType=n.dataStore.getType,n.addProperty=n.dataStore.addProperty,n.getProperty=n.dataStore.getProperty,n.getObjectsUnion=n.dataStore.getObjectsUnion,n.getSubjectsUnion=n.dataStore.getSubjectsUnion,c=n.prepare(a.expressions),n.eventModelChange=function(a,b){var g,o,p,q,r,s,t;g=[];for(s=0,t=b.length;s<t;s++)p=b[s],a.contains(p)?(r=c.evaluate(p),r.length>0?(c.valueType()==="numeric"?q=parseFloat(r[0]):q=r[0],m.contains(p)?(o=d(p),o===-1?h.push([q,p]):h[o][0]=q,g.push(p),(k!=null&&q<k||l!=null&&q>l)&&m.remove(p)):(h.push([q,p]),(k==null||q>=k)&&(l==null||q<=l)&&(m.add(p),g.push(p)))):m.contains(p)&&(o=d(p),o===0?h=h.slice(1,h.length):o===h.length-1?h=h.slice(0,h.length-1):o!==-1&&(h=h.slice(0,o).concat(h.slice(o+1,h.length))),m.remove(p),g.push(p))):(m.remove(p),g.push(p));h.sort(function(a,b){if(a[0]<b[0])return-1;if(a[0]>b[0])return 1;return 0}),i=e(k),j=f(l);if(g.length>0)return n.events.onModelChange.fire(n,g)},n.setKeyRange=function(a,b){var c,d,o,p;a!=null&&b!=null?a<b?(k=a,l=b):(k=b,l=a):(k=a,l=b),i=e(k),j=f(l),c=g.initSet(),p=m,m=g.initSet(),n.items=m.items,n.size=m.size,n.contains=m.contains,n.visit=m.visit;if(i<j)for(d=i;i<=j?d<=j:d>=j;i<=j?d++:d--)o=h[d][1],p.contains(o)||c.add(o),m.add(o);p.visit(function(a){if(!m.contains(a))return c.add(a)});if(c.size()>0)return n.events.onModelChange.fire(n,c.items())},n.dataStore.registerPresentation(n),n.registerPresentation=function(a){n.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)});return a.eventModelChange(n,n.items())};return n},g.namespace("RangePager"),g.initRangePager=g.RangePager.initInstance=function(a){var c,d,e,f;f=b.initView("MITHGrid.Data.RangePager",a),a=f.options,c=g.Pager.initInstance({dataStore:a.dataStore,expressions:a.leftExpressions}),d=g.Pager.initInstance({dataStore:a.dataStore,expressions:a.rightExpressions}),e=g.initSet(),f.items=e.items,f.size=e.size,f.contains=e.contains,f.visit=e.visit,f.dataStore=a.dataStore,f.getItems=f.dataStore.getItems,f.getItem=f.dataStore.getItem,f.removeItems=f.dataStore.removeItems,f.fetchData=f.dataStore.fetchData,f.updateItems=f.dataStore.updateItems,f.loadItems=f.dataStore.loadItems,f.prepare=f.dataStore.prepare,f.addType=f.dataStore.addType,f.getType=f.dataStore.getType,f.addProperty=f.dataStore.addProperty,f.getProperty=f.dataStore.getProperty,f.getObjectsUnion=f.dataStore.getObjectsUnion,f.getSubjectsUnion=f.dataStore.getSubjectsUnion,f.eventModelChange=function(a,b){var g,h,i,j;g=[];for(i=0,j=b.length;i<j;i++)h=b[i],c.contains(h)&&d.contains(h)?(g.push(h),e.add(h)):(e.contains(h)&&g.push(h),e.remove(h));if(g.length>0)return f.events.onModelChange.fire(f,g)},f.setKeyRange=function(a,b){var e;a>b&&(e=[b,a],a=e[0],b=e[1]),c.setKeyRange(void 0,b);return d.setKeyRange(a,void 0)},f.setKeyRange(void 0,void 0),c.registerPresentation(f),d.registerPresentation(f),f.registerPresentation=function(a){f.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)});return a.eventModelChange(f,f.items())};return f},h=b.namespace("Expression"),m={"+":{argumentType:"number",valueType:"number",f:function(a,b){return a+b}},"-":{argumentType:"number",valueType:"number",f:function(a,b){return a-b}},"*":{argumentType:"number",valueType:"number",f:function(a,b){return a*b}},"/":{argumentType:"number",valueType:"number",f:function(a,b){return a/b}},"=":{valueType:"boolean",f:function(a,b){return a===b}},"<>":{valueType:"boolean",f:function(a,b){return a!==b}},"><":{valueType:"boolean",f:function(a,b){return a!==b}},"<":{valueType:"boolean",f:function(a,b){return a<b}},">":{valueType:"boolean",f:function(a,b){return a>b}},"<=":{valueType:"boolean",f:function(a,b){return a<=b}},">=":{valueType:"boolean",f:function(a,b){return a>=b}}},h.controls={"if":{f:function(a,b,c,d,e){var f,g;g=a[0].evaluate(b,c,d,e),f=!1,g.forEachValue(function(a){if(a){f=!0;return!0}});return f?a[1].evaluate(b,c,d,e):a[2].evaluate(b,c,d)}},foreach:{f:function(a,b,c,d,e){var f,g,i,j,k;f=a[0].evaluate(b,c,d,e),g=b.value,i=c.value,j=[],k="text",c.value=f.valueType,f.forEachValue(function(f){var g;b.value=f,g=a[1].evaluate(b,c,d,e),k=g.valueType;return g.forEachValue(function(a){return j.push(a)})}),b.value=g,c.value=i;return h.initCollection(j,k)}},"default":{f:function(a,b,c,d,e){var f,g,i,j;for(i=0,j=a.length;i<j;i++){f=a[i],g=f.evaluate(b,c,d,e);if(g.size()>0)return g}return h.initCollection([],"text")}}},h.initExpression=function(a){var b;b={},b.evaluate=function(b,c,d,e){var f;f=a.evaluate(b,c,d,e);return{values:f.getSet(),valueType:f.valueType,size:f.size}},b.evaluateOnItem=function(a,b){return this.evaluate({value:a},{value:"item"},"value",b)},b.evaluateSingle=function(b,c,d,e){var f,g;f=a.evaluate(b,c,d,e),g={value:null,valueType:f.valueType},f.forEachValue(function(a){g.value=a;return!0});return g},b.isPath=a.isPath,b.isPath?(b.getPath=function(){return a},b.testExists=function(b,c,d,e){return a.testExists(b,c,d,e)}):(b.getPath=function(){return null},b.testExists=function(a,c,d,e){return b.evaluate(a,c,d,e).values.size()>0}),b.evaluateBackward=function(b,c,d,e){return a.walkBackward([b],c,d,e)},b.walkForward=function(b,c,d){return a.walkForward(b,c,d)},b.walkBackward=function(b,c,d,e){return a.walkBackward(b,c,d,e)};return b},h.initCollection=function(a,c){var d;d={valueType:c},a instanceof Array?(d.forEachValue=function(b){var c,d,e,f;f=[];for(d=0,e=a.length;d<e;d++){c=a[d];if(b(c)===!0)break}return f},d.getSet=function(){return b.Data.initSet(a)},d.contains=function(b){return f.call(a,b)>=0},d.size=function(){return a.length}):(d.forEachValue=a.visit,d.size=a.size,d.getSet=function(){return a},d.contains=a.contains),d.isPath=!1;return d},h.initConstant=function(a,b){var c;c={},c.evaluate=function(c,d,e,f){return h.initCollection([a],b)},c.isPath=!1;return c},h.initOperator=function(a,b){var c,d,e;c={},e=a,d=b,c.evaluate=function(c,f,g,i){var j,k,l,n,o;l=[],b=[];for(n=0,o=d.length;n<o;n++)j=d[n],b.push(j.evaluate(c,f,g,i));a=m[e],k=a.f,a.argumentType==="number"?b[0].forEachValue(function(a){typeof a!="number"&&(a=parseFloat(a));return b[1].forEachValue(function(b){typeof b!="number"&&(b=parseFloat(b));return l.push(k(a,b))})}):b[0].forEachValue(function(a){return b[1].forEachValue(function(b){return l.push(k(a,b))})});return h.initCollection(l,a.valueType)},c.isPath=!1;return c},h.initFunctionCall=function(a,b){var c,d;c={},d=b,c.evaluate=function(c,e,f,g){var i,j,k,l;b=[];for(j=0,k=d.length;j<k;j++)i=d[j],b.push(i.evaluate(c,e,f,g));if(((l=h.functions[a])!=null?l.f:void 0)!=null)return h.functions[a].f(b);throw new Error("No such function named "+_name)},c.isPath=!1;return c},h.initControlCall=function(a,b){var c;c={},c.evaluate=function(c,d,e,f){return h.controls[a].f(b,c,d,e,f)},c.isPath=!1;return c},h.initPath=function(a,c){var d,e,f,g,i;d={},g=null,i=[],f=function(b,c){var d,e,f,g,j,k,l,m;f=function(a){var d;d=[],b.forEachValue(function(b){return c.getObjects(b,a.property).visit(function(a){return d.push(a)})});return d},e=function(a){var d;d=[],b.forEachValue(function(b){return c.getSubjects(b,a.property).visit(function(a){return d.push(a)})});return d};for(g=0,m=i.length;0<=m?g<m:g>m;0<=m?g++:g--)j=i[g],j.isMultiple?(d=[],j.forward?(d=f(j),a=c.getProperty(j.property),k=a!=null?a.getValueType():"text"):(d=e(j),k="item"),b=h.initCollection(d,k)):j.forward?(l=c.getObjectsUnion(b.getSet(),j.property),a=c.getProperty(j.property),k=a!=null?a.getValueType():"text",b=h.initCollection(l,k)):(l=c.getSubjectsUnion(b.getSet(),j.property),b=h.initCollection(l,"item"));return b},e=function(c,d,e){var f,g,j,k,l,m,n,o;j=function(a){var b;b=[],c.forEachValue(function(c){return e.getSubjects(c,a.property).visit(function(a){if(k>0||d==null||d.contains(a))return b.push(a)})});return b},g=function(a){var b;b=[],c.forEachValue(function(c){return e.getObjects(c,a.property).visit(function(a){if(k>0||d==null||d.contains(a))return b.push(a)})});return b},d instanceof Array&&(d=b.Data.initSet(d));for(k=o=i.length-1;o<=0?k<=0:k>=0;o<=0?k++:k--)l=i[k],l.isMultiple?(f=[],l.forward?(f=j(l),a=e.getProperty(l.property),m=a!=null?a.getValueType():"text"):(f=g(l),m="item"),c=h.initCollection(f,m)):l.forward?(n=e.getSubjectsUnion(c.getSet(),l.property,null,k===0?d:null),c=h.initCollection(n,"item")):(n=e.getObjectsUnion(c.getSet(),l.property,null,k===0?d:null),a=e.getProperty(l.property),m=a!=null?a.getValueType():"text",c=h.initCollection(n,m));return c},a!=null&&i.push({property:a,forward:c,isMultiple:!1}),d.isPath=!0,d.setRootName=function(a){return g=a},d.appendSegment=function(a,b){return i.push({property:a,forward:b[0]===".",isMultiple:b.length>1})},d.getSegment=function(a){var b;if(a<i.length){b=i[a];return{property:b.property,forward:b.forward,isMultiple:b.isMultiple}}return null},d.getLastSegment=function(){return d.getSegment(i.length-1)},d.getSegmentCount=function(){return i.length},d.rangeBackward=function(c,d,e,f){var g,h,j,k,l;j=b.Data.initSet(),k="item";if(i.length>0){h=i[i.length-1];if(h.forward)f.getSubjectsInRange(h.property,c,d,!1,j,i.length===1?e:null);else throw new Error("Last path of segment must be forward");for(g=l=i.length-2;l<=0?g<=0:g>=0;l<=0?g++:g--)h=i[g],h.forward?(j=f.getSubjectsUnion(j,h.property,null,g===0?e:null),k="item"):(j=f.getObjectsUnion(j,h.property,null,g===0?e:null),a=f.getPropertysegment.property,k=a!=null?a.getValueType():"text")}return{valueType:k,values:j,count:j.size()}},d.evaluate=function(a,b,c,d){var e,i,j,k;j=g!=null?g:c,k=b[j]!=null?b[j]:"text",e=null;if(a[j]!=null){i=a[j],i.isSet||i instanceof Array?e=h.initCollection(i,k):e=h.initCollection([i],k);return f(e,d)}throw new Error("No such variable called "+j)},d.testExists=function(a,b,c,e){return d.evaluate(a,b,c,e).size()>0},d.evaluateBackward=function(a,b,c,d){var f;f=h.initCollection([a],b);return e(f,c,d)},d.walkForward=function(a,b,c){return f(h.initCollection(a,b),c)},d.walkBackward=function(a,b,c,d){return e(h.initCollection(a,b),c,d)};return d},h.initParser=function(){var a,b;b={},a=function(a,b){var c,d,e,f,g,i,j,k,l,m,n,o,p,q,r;p=a.token(),c=h.initScanner,f=function(){a.next();return p=a.token()},m=function(){var a,b,d;b=j();while(p!=null&&p.type===c.OPERATOR&&((d=p.value)==="*"||d==="/"))a=p.value,f(),b=h.initOperator(a,[b,j()]);return b},l=function(){var a,b,d;b=m();while(p!=null&&p.type===c.OPERATOR&&((d=p.value)==="+"||d==="-"))a=p.value,f(),b=h.initOperator(a,[b,m()]);return b},g=function(){var a,b,d;a=l();while(p!=null&&p.type===c.OPERATOR&&((d=p.value)==="="||d==="<>"||d==="<"||d===">"||d==="<="||d===">="))b=p.value,f(),a=h.initOperator(b,[a,l()]);return a},i=function(){var a;a=[g()];while(p!=null&&p.type===c.DELIMITER&&p.value===",")f(),a.push(g());return a},e=function(){return p!=null?p.start:a.index()},k=function(){var a,b;b=h.initPath();while(p!=null&&p.type===c.PATH_OPERATOR){a=p.value,f();if(p!=null&&p.type===c.IDENTIFIER)b.appendSegment(p.value,a),f();else throw new Error("Missing property ID at position "+e())}return b},j=function(){var a,b,d;d=null,a=[];if(p==null)throw new Error("Missing factor at end of expression");switch(p.type){case c.NUMBER:d=h.initConstant(p.value,"number"),f();break;case c.STRING:d=h.initConstant(p.value,"text"),f();break;case c.PATH_OPERATOR:d=k();break;case c.IDENTIFIER:b=p.value,f();if(h.controls[b]!=null){if(p==null||p.type!==c.DELIMITER||p.value!=="(")throw new Error("Missing ( to start "+b+" at position "+e());f(),p!=null&&p.type===c.DELIMITER&&p.value===")"?a=[]:a=i(),d=h.initControlCall(b,a);if(p!=null&&p.type===c.DELIMITER&&p.value===")")f();else throw new Error("Missing ) to end "+b+" at position "+e())}else if(p!=null&&p.type===c.DELIMITER&&p.value==="("){f(),p!=null&&p.type===c.DELIMITER&&p.value===")"?a=[]:a=i(),d=h.initFunctionCall(b,a);if(p!=null&&p.type===c.DELIMITER&&p.value===")")f();else throw new Error("Missing ) after function call "+b+" at position "+e())}else d=k(),d.setRootName(b);break;case c.DELIMITER:if(p.value!=="(")throw new Error("Unexpected text "+p.value+" at position "+e());f(),d=g();if(p!=null&&p.type===c.DELIMITER&&p.value===")")f();else throw new Error("Missing ) at position "+e());break;default:throw new Error("Unexpected text "+p.value+" at position "+e())}return d};if(b){o=i(),d=[];for(q=0,r=o.length;q<r;q++)n=o[q],d.push(h.initExpression(n));return d}return[h.initExpression(g())]},b.parse=function(b,c,d){var e;c!=null?c:c=0,d!=null?d:d={},e=h.initScanner(b,c);try{return a(e,!1)[0]}finally{d.index=e.token()!=null?e.token().start:e.index()}};return b},h.initScanner=function(a,b){var c,d,e,f,g,i;d={},g=a+" ",f=a.length,e=b,i=null,c=function(a){return"0123456789".indexOf(a)>=0},d.token=function(){return i},d.index=function(){return e},d.next=function(){var a,b,d,j;i=null;while(e<f&&" \t\r\n".indexOf(g.charAt(e))>=0)e+=1;if(e<f){b=g.charAt(e),d=g.charAt(e+1);if(".!".indexOf(b)<0){if("<>".indexOf(b)<0){if("+-*/=".indexOf(b)<0){if("()".indexOf(b)<0){if("\"'".indexOf(b)<0){if(c(b)){j=e;while(j<f&&c(g.charAt(j)))j+=1;if(j<f&&g.charAt(j)==="."){j+=1;while(j<f&&c(g.charAt(j)))j+=1}i={type:h.initScanner.NUMBER,value:parseFloat(g.substring(e,j)),start:e,end:j};return e=j}j=e;while(j<f){a=g.charAt(j);if("(),.!@ \t".indexOf(a)>=0)break;j+=1}i={type:h.initScanner.IDENTIFIER,value:g.substring(e,j),start:e,end:j};return e=j}j=e+1;while(j<f){if(g.charAt(j)===b&&g.charAt(j-1)!=="\\")break;j+=1}if(j<f){i={type:h.initScanner.STRING,value:g.substring(e+1,j).replace(/\\'/g,"'").replace(/\\"/g,'"'),start:e,end:j+1};return e=j+1}throw new Error("Unterminated string starting at "+String(e))}i={type:h.initScanner.DELIMITER,value:b,start:e,end:e+1};return e+=1}i={type:h.initScanner.OPERATOR,value:b,start:e,end:e+1};return e+=1}if(d==="="||"<>".indexOf(d)>=0&&b!==d){i={type:h.initScanner.OPERATOR,value:b+d,start:e,end:e+2};return e+=2}i={type:h.initScanner.OPERATOR,value:b,start:e,end:e+1};return e+=1}if(d==="@"){i={type:h.initScanner.PATH_OPERATOR,value:b+d,start:e,end:e+2};return e+=2}i={type:h.initScanner.PATH_OPERATOR,value:b,start:e,end:e+1};return e+=1}},d.next();return d},h.initScanner.DELIMITER=0,h.initScanner.NUMBER=1,h.initScanner.STRING=2,h.initScanner.IDENTIFIER=3,h.initScanner.OPERATOR=4,h.initScanner.PATH_OPERATOR=5,h.functions={},h.FunctionUtilities={},h.FunctionUtilities.registerSimpleMappingFunction=function(a,c,d){return h.functions[a]={f:function(a){var e,f,g,i,j;g=b.Data.initSet(),f=function(a){return a.forEachValue(function(a){var b;b=c(a);if(b!=null)return g.add(b)})};for(i=0,j=a.length;i<j;i++)e=a[i],f(e);return h.initCollection(g,d)}}},b.namespace("Presentation"),b.Presentation.initPresentation=function(c,d,e){var f,g,h,i,j,k;k=b.normalizeArgs("MITHGrid.Presentation",c,d,e),c=k[0],d=k[1],e=k[2],j=b.initView(c,d,e),f=null,i={},h=j.options.lenses||{},e=j.options,a(d).empty(),g=void 0,e.lensKey||(e.lensKey=[".type"]),j.getLens=function(a){var b,c;g!=null&&(c=g.evaluate([a]),b=c[0]);if(b!=null&&h[b]!=null)return{render:h[b]}},j.addLens=function(a,b){return h[a]=b},j.removeLens=function(a){return delete h[a]},j.renderingFor=function(a){return i[a]},j.renderItems=function(a,b){var c,h,k;g==null&&(g=a.prepare(e.lensKey)),h=b.length,k=h,k>200&&(k=parseInt(Math.sqrt(k),10)+1),k<1&&(k=1),c=function(e){var g,l,m,n,o;if(e<h){g=e+k,g>h&&(g=h);for(m=e;e<=g?m<g:m>g;e<=g?m++:m--)n=b[m],l=a.contains(n),i[n]!=null?l?i[n].update(a.getItem(n)):(f===n&&i[n].eventUnfocus!=null&&i[n].eventUnfocus(),i[n].remove!=null&&i[n].remove(),delete i[n]):l&&(o=j.render(d,a,n),o!=null&&(i[n]=o,f===n&&o.eventFocus!=null&&o.eventFocus()));return setTimeout(function(){return c(g)},0)}return j.finishDisplayUpdate()},j.startDisplayUpdate();return c(0)},j.render=function(a,b,c){var d;d=j.getLens(c);if(d!=null)return d.render(a,j,b,c)},j.eventModelChange=j.renderItems,j.startDisplayUpdate=function(){},j.finishDisplayUpdate=function(){},j.selfRender=function(){return j.renderItems(j.dataView,j.dataView.items())},j.eventFocusChange=function(a){var b;f!=null&&(b=j.renderingFor(f)),f!==a&&(b!=null&&b.eventUnfocus!=null&&b.eventUnfocus(),a!=null&&(b=j.renderingFor(a),b!=null&&b.eventFocus!=null&&b.eventFocus()),f=a);return f},j.dataView=j.options.dataView,j.dataView.registerPresentation(j);return j},b.Presentation.namespace("SimpleText"),b.Presentation.SimpleText.initPresentation=function(a,c,d){var e,f;f=b.normalizeArgs("MITHGrid.Presentation.SimpleText",a,c,d),a=f[0],c=f[1],d=f[2
],e=b.Presentation.initPresentation(a,c,d);return e},i=b.namespace("Facet"),i.initFacet=function(c,d,e){var f;f=b.initView(c,d,e),e=f.options,f.selfRender=function(){},f.eventFilterItem=function(a,b){return!1},f.eventModelChange=function(a,b){},f.constructFacetFrame=function(b,c){var d;d={},a(b).addClass("mithgrid-facet"),d.header=a("<div class='header' />"),c.onClearAllSelections!=null&&(d.controls=a("<div class='control' title='Clear Selection'>"),d.counter=a("<span class='counter'></span>"),d.controls.append(d.counter),d.header.append(d.controls)),d.title=a("<span class='title'></span>"),d.title.text(c.facetLabel||""),d.header.append(d.title),d.bodyFrame=a("<div class='body-frame'></div>"),d.body=a("<div class='body'></div>"),d.bodyFrame.append(d.body),a(b).append(d.header),a(b).append(d.bodyFrame),c.onClearAllSelections!=null&&d.controls.bind("click",c.onClearAllSelections),d.setSelectionCount=function(a){d.counter.innerHTML=a;return a>0?d.counter.show():d.counter.hide()};return d},f.events||(f.events={}),f.events.onFilterChange=fluid.event.getEventFirer(),e.dataView.registerFilter(f);return f},i.namespace("TextSearch"),i.TextSearch.initFacet=function(c,d){var e,f,g;g=i.initFacet("MITHGrid.Facet.TextSearch",c,d),d=g.options,d.expressions!=null&&(a.isArray(d.expressions)||(d.expressions=[d.expressions],f=function(){var a,c,f,g;f=d.expressions,g=[];for(a=0,c=f.length;a<c;a++)e=f[a],g.push(b.Expression.initParser().parse(e));return g}())),g.eventFilterItem=function(a,b){var c,e,h,i,j,k,l,m;if(g.text!=null&&d.expressions!=null)for(i=0,k=f.length;i<k;i++){c=f[i],e=c.evaluateOnItem(b,a),m=e.values.items();for(j=0,l=m.length;j<l;j++){h=m[j];if(h.toLowerCase().indexOf(g.text)>=0)return}}return!1},g.eventModelChange=function(a,b){},g.selfRender=function(){var b,e;b=g.constructFacetFrame(c,null,{facetLabel:d.facetLabel}),a(c).addClass("mithgrid-facet-textsearch"),e=a("<input type='text'>"),b.body.append(e);return e.keyup(function(){g.text=a.trim(e.val().toLowerCase());return g.events.onFilterChange.fire()})};return g},i.namespace("List"),i.List.initFacet=function(c,d){var e,g,h;h=i.initFacet("MITHGrid.Facet.List",c,d),d=h.options,h.selections=[],d.expressions!=null&&(a.isArray(d.expressions)||(d.expressions=[d.expressions],g=function(){var a,c,f,g;f=d.expressions,g=[];for(a=0,c=f.length;a<c;a++)e=f[a],g.push(b.Expression.initParser().parse(e));return g}())),h.eventFilterItem=function(a,b){var c,e,i,j,k,l,m,n,o;if(h.text!=null&&d.expressions!=null){o=[];for(j=0,l=g.length;j<l;j++){c=g[j],e=c.evaluateOnItem(b,a),n=e.values.items();for(k=0,m=n.length;k<m;k++){i=n[k];if(f.call(h.selections,i)>=0)return}}return o}},h.selfRender=function(){var a;return a=h.constructFacetFrame(c,null,{facetLabel:d.facetLabel,resizable:!0})};return h},i.namespace("Range"),i.Range.initFacet=function(b,c){var d;d=i.initFacet("MITHGrid.Facet.Range",b,c),c=d.options,c.min||(c.min=0),c.max||(c.max=100),c.step||(c.step=1/30),d.selfRender=function(){var e,f;e=d.constructFacetFrame(b,null,{facetLabel:c.facetLabel,resizable:!1}),f=a("<input type='range'>"),f.attr({min:c.min,max:c.max,step:c.step}),e.body.append(f);return f.event(function(){d.value=f.val();return d.events.onFilterChange.fire()})};return d},d=b.namespace("Controller"),d.initController=function(c,d){var f,g,h,i,j;j=b.normalizeArgs("MITHGrid.Controller",c,void 0,d),c=j[0],f=j[1],d=j[2],i=b.initView(c,d),d=i.options,d.selectors||(d.selectors={}),g=function(c){var e,f;e=b.initView(d.bind),f={"":a(c)},e.locate=function(b){var e,g;g=d.selectors[b];if(g!=null){g===""?e=a(c):e=a(c).find(g),f[g]=e;return e}},e.fastLocate=function(a){var b;b=d.selectors[a];if(b!=null){if(f[b]!=null)return f[b];return e.locate(a)}},e.refresh=function(b){var e,g,h,i;for(h=0,i=b.length;h<i;h++)e=b[h],g=d.selectors[e],g!=null&&(g===""?f[""]=a(c):f[g]=a(c).find(g))},e.clearCache=function(){return f={"":a(c)}};return e},h=function(a){var b,c,d,e,f;b=g(a.node),e=b.locate,d=b.fastLocate,f=b.refresh,c=b.bind,b.locate=function(b){return b==="raphael"?a:e(b)},b.fastLocate=function(b){return b==="raphael"?a:d(b)},b.refresh=function(a){var b;a=function(){var c,d,e;e=[];for(c=0,d=a.length;c<d;c++)b=a[c],b!=="raphael"&&e.push(b);return e}();return f(a)};return b},i.initBind=function(b){return typeof b=="string"?g(a(b)):b.node!=null?h(b):g(b)},i.bind=function(){var a,b,c;c=arguments[0],a=2<=arguments.length?e.call(arguments,1):[],b=i.initBind(c),i.applyBindings.apply(i,[b].concat(e.call(a)));return b},i.applyBindings=function(){var a,b;b=arguments[0],a=2<=arguments.length?e.call(arguments,1):[]};return i},d.initRaphaelController=d.initController,c=b.namespace("Application"),c.initApp=function(c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;x=b.normalizeArgs("MITHGrid.Application",c,d,e),c=x[0],d=x[1],e=x[2],n=b.initView(c,d,e),i=[],n.presentation={},n.facet={},n.dataStore={},n.dataView={},n.controller={},e=n.options,n.ready=function(a){return i.push(a)};if((e!=null?e.variables:void 0)!=null){y=e.variables,w=function(a,c){var d,e,f,g,h,i,j,k;i=c["default"],c.is||(c.is="rw");if((j=c.is)==="rw"||j==="w")e=c.filter,h=c.validate,d=c.event||"on"+a+"Change",g=c.setter||"set"+a,n.events[d]=b.initEventFirer(),e!=null?h!=null?n[g]=function(a){a=h(e(a));if(i!==a){i=a;return n.events[d].fire(i)}}:n[g]=function(a){a=e(a);if(i!==a){i=a;return n.events[d].fire(i)}}:h!=null?n[g]=function(a){a=h(a);if(i!==a){i=a;return n.events[d].fire(i)}}:n[g]=function(a){if(i!==a){i=a;return n.events[d].fire(i)}};if((k=c.is)==="r"||k==="rw"){f=c.getter||"get"+a;return n[f]=function(){return i}}};for(r in y)f=y[r],w(r,f)}if((e!=null?e.dataStores:void 0)!=null){z=e.dataStores;for(m in z){f=z[m],n.dataStore[m]==null?(l=b.Data.initStore(),n.dataStore[m]=l,l.addType("Item"),l.addProperty("label",{valueType:"text"}),l.addProperty("type",{valueType:"text"}),l.addProperty("id",{valueType:"text"})):l=n.dataStore[m];if((f!=null?f.types:void 0)!=null){A=f.types;for(o in A)p=A[o],l.addType(o)}if((f!=null?f.properties:void 0)!=null){B=f.properties;for(j in B)k=B[j],l.addProperty(j,k)}}}if((e!=null?e.dataViews:void 0)!=null){C=e.dataViews;for(u in C){t=C[u],t.type!=null&&t.type.initInstance!=null?g=t.type.initInstance:g=b.Data.View.initInstance,v={dataStore:n.dataStore[t.dataStore]||n.dataView[t.dataStore]};if(n.dataView[u]==null){for(h in t)q=t[h],h!=="type"&&!v[h]&&(v[h]=q);s=g(v),n.dataView[u]=s}}}(e!=null?e.controllers:void 0)!=null&&n.ready(function(){var b,c,d,f,g,h;g=e.controllers,h=[];for(b in g)c=g[b],f=a.extend(!0,{},c),f.application=n,d=c.type.initController(f),h.push(n.controller[b]=d);return h}),(e!=null?e.viewSetup:void 0)!=null&&(a.isFunction(e.viewSetup)?n.ready(function(){return e.viewSetup(a(d))}):n.ready(function(){return a(d).append(e.viewSetup)})),(e!=null?e.facets:void 0)!=null&&n.ready(function(){var b,c,f,g,h,i,j;i=e.facets,j=[];for(b in i)f=i[b],h=a.extend(!0,{},f),g=a(d).find(f.container),a.isArray(g)&&(g=g[0]),h.dataView=n.dataView[f.dataView],h.application=n,c=f.type.initFacet(g,h),n.facet[b]=c,j.push(c.selfRender());return j}),(e!=null?e.presentations:void 0)!=null&&n.ready(function(){var b,c,f,g,h,i,j,k,l,m,o;l=e.presentations,o=[];for(g in l){h=l[g],j=a.extend(!0,{},h),i=a(d).find(j.container),a.isArray(i)&&(i=i[0]),j.dataView=n.dataView[h.dataView],j.application=n;if(h.controllers!=null){j.controllers={},m=h.controllers;for(b in m)c=m[b],typeof c=="string"?j.controllers[b]=n.controller[b]:(f=a.extend(!0,{},c),f.application=n,j.controllers[b]=c.type.initController(f))}k=h.type.initPresentation(i,j),n.presentation[g]=k,o.push(k.selfRender())}return o}),(e!=null?e.plugins:void 0)!=null&&n.ready(function(){var b,c,f,g,h,i,j,k,l,m,o,p,q,r,s;r=e.plugins,s=[];for(p=0,q=r.length;p<q;p++)b=r[p],f=b.type.initPlugin(b),s.push(function(){var e,p,q,r;if(f!=null){if((b!=null?b.dataView:void 0)!=null){f.dataView=n.dataView[b.dataView],e=f.getTypes();for(m in e)o=e[m],f.dataView.addType(m);p=f.getProperties();for(j in p)k=p[j],f.dataView.addProperty(j,k)}q=f.getPresentations(),r=[];for(g in q)h=q[g],l=a.extend(!0,{},h.options),c=a(d).find(h.container),a.isArray(c)&&(c=c[0]),(h!=null?h.lenses:void 0)!=null&&(l.lenses=h.lenses),h.dataView!=null?l.dataView=n.dataView[h.dataView]:b.dataView!=null&&(l.dataView=n.dataView[b.dataView]),l.application=n,i=h.type.initPresentation(c,l),f.presentation[g]=i,r.push(i.selfRender());return r}}());return s}),n.run=function(){return a(document).ready(function(){var a,b,c;for(b=0,c=i.length;b<c;b++)a=i[b],a();i=[];return n.ready=function(a){return setTimeout(a,0)}})};return n},b.namespace("Plugin");return b.Plugin.initPlugin=function(a,b){var c,d;d={options:b,presentation:{}},c=[],d.getTypes=function(){return(b!=null?b.types:void 0)!=null?b.types:[]},d.getProperties=function(){return(b!=null?b.properties:void 0)!=null?b.properties:[]},d.getPresentations=function(){return(b!=null?b.presentations:void 0)!=null?b.presentations:[]},d.ready=c.push,d.eventReady=function(a){var b,e,f;for(e=0,f=c.length;e<f;e++)b=c[e],b(a);c=[];return d.ready=function(b){return b(a)}};return d}}(b,a),a.defaults("MITHGrid.Data.Store",{events:{onModelChange:null,onBeforeLoading:null,onAfterLoading:null,onBeforeUpdating:null,onAfterUpdating:null}}),a.defaults("MITHGrid.Data.View",{events:{onModelChange:null,onFilterItem:"preventable"}}),a.defaults("MITHGrid.Data.Pager",{events:{onModelChange:null}}),a.defaults("MITHGrid.Data.RangePager",{events:{onModelChange:null}}),a.defaults("MITHGrid.Facet",{}),a.defaults("MITHGrid.Facet.TextSearch",{facetLabel:"Search",expressions:[".label"]})}).call(this);