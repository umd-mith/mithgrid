---
layout: docco
title: mithgrid/code/src/core.coffee.html
---
<div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../index.html" class="source"><span class="file_name">README</span></a><a href="../src/application.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">application.coffee</span></a><a href="../src/controller.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">controller.coffee</span></a><a href="../src/core.coffee.html" class="source selected"><span class="base_path">src / </span><span class="file_name">core.coffee</span></a><a href="../src/data.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">data.coffee</span></a><a href="../src/expression.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">expression.coffee</span></a><a href="../src/facet.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">facet.coffee</span></a><a href="../src/intro.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">intro.coffee</span></a><a href="../src/outro.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">outro.coffee</span></a><a href="../src/plugin.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">plugin.coffee</span></a><a href="../src/presentation.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">presentation.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>core.coffee</h1><div class="filepath">src/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div><h1>namespace management</h1>

<p>These functions are available as properties of the global MITHGrid object. The debug() and namespace()
functions are properties of all namespaces created using MITHGrid.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><h2>MITHGrid.debug</h2>

<p>If you don't know if the console.log is available, use MITHGrid.debug. If console.log is available, it's the same
function. Otherwise, it's a NOP.</p>
</td><td class="code"><div class="highlight"><pre><span class="k">if</span> <span class="nb">window</span><span class="o">?</span><span class="p">.</span><span class="nx">console</span><span class="o">?</span><span class="p">.</span><span class="nx">log</span><span class="o">?</span>
  <span class="nv">MITHGrid.debug = </span><span class="nb">window</span><span class="p">.</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span>
<span class="k">else</span> 
  <span class="nv">MITHGrid.debug = </span><span class="nf">() -&gt;</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><h2>MITHGrid.error</h2>

<p>MITHGrid.error will be like MITHGrid.debug except that it will return the arguments in an object that can be thrown as
an error. It is used in the data store loadItems() function.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">MITHGrid.error = </span><span class="nf">() -&gt;</span>
  <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">debug</span><span class="p">.</span><span class="nx">call</span> <span class="p">{},</span> <span class="nx">arguments</span>
  <span class="p">{</span> <span class="s">&#39;arguments&#39;</span><span class="o">:</span> <span class="nx">arguments</span> <span class="p">}</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><h2>MITHGrid.namespace</h2>

<p>Ensures the namespace exists as a property of the MITHGrid global.
Any namespace created will have the debug() and namespace()
functions available.</p>

<p>Parameters:</p>

<ul>
<li>nom - the name of the namespace</li>
<li>fn  - optional callback to be called with the new namespace</li>
</ul>

<p>Returns:</p>

<p>The object corresponding to the namespace.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">MITHGrid.namespace = </span><span class="nf">(nom, fn) -&gt;</span>
  <span class="nx">genericNamespacer</span> <span class="nx">MITHGrid</span><span class="p">,</span> <span class="nx">nom</span><span class="p">,</span> <span class="nx">fn</span>
  </pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>We need a general way to handle namespace creation. We do this so we can use closures when creating the
namespace.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">genericNamespacer = </span><span class="nf">(base, nom, fn) -&gt;</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>TODO: check for '.' in nom</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">bits = </span><span class="nx">nom</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
  <span class="k">while</span> <span class="nx">bits</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="o">!</span><span class="nx">base</span><span class="p">[</span><span class="nx">bits</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
      <span class="nv">base = </span><span class="nx">genericNamespacer</span> <span class="nx">base</span><span class="p">,</span> <span class="nx">bits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nx">bits</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
  <span class="k">if</span> <span class="o">!</span><span class="nx">base</span><span class="p">[</span><span class="nx">bits</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">?</span>
    <span class="nv">newbase =</span>
      <span class="nv">namespace: </span><span class="nf">(nom2, fn2) -&gt;</span>
        <span class="nx">genericNamespacer</span> <span class="nx">newbase</span><span class="p">,</span> <span class="nx">nom2</span><span class="p">,</span> <span class="nx">fn2</span>
      <span class="nv">debug: </span><span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">debug</span>
    <span class="nx">base</span><span class="p">[</span><span class="nx">bits</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">newbase</span>
  <span class="k">if</span> <span class="nx">fn</span><span class="o">?</span>
    <span class="nx">fn</span> <span class="nx">base</span><span class="p">[</span><span class="nx">bits</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
  <span class="nx">base</span><span class="p">[</span><span class="nx">bits</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><h2>MITHGrid.globalNamespace</h2>

<p>Ensures the namespace exists in the global space.
Any namespace created will have the debug() and namespace() functions available.</p>

<p>Parameters:</p>

<ul>
<li>nom - the name of the namespace</li>
<li>fn  - optional callback to be called with the new namespace</li>
</ul>

<p>Returns:</p>

<p>The object corresponding to the namespace.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">MITHGrid.globalNamespace = </span><span class="nf">(nom, fn) -&gt;</span>
  <span class="nv">globals = </span><span class="nb">window</span>
  <span class="nx">globals</span><span class="p">[</span><span class="nx">nom</span><span class="p">]</span> <span class="o">or=</span> <span class="p">{}</span>
  
  <span class="nx">globals</span><span class="p">[</span><span class="nx">nom</span><span class="p">][</span><span class="s">&quot;debug&quot;</span><span class="p">]</span> <span class="o">or=</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">debug</span>
  <span class="nx">globals</span><span class="p">[</span><span class="nx">nom</span><span class="p">][</span><span class="s">&quot;namespace&quot;</span><span class="p">]</span> <span class="o">or=</span> <span class="nf">(n, f) -&gt;</span>
    <span class="nx">genericNamespacer</span> <span class="nx">globals</span><span class="p">[</span><span class="nx">nom</span><span class="p">],</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">f</span>
  <span class="k">if</span> <span class="nx">fn</span><span class="o">?</span>
    <span class="nx">fn</span> <span class="nx">globals</span><span class="p">[</span><span class="nx">nom</span><span class="p">]</span>
  <span class="nx">globals</span><span class="p">[</span><span class="nx">nom</span><span class="p">]</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><h1>that-ism helper functions</h1>

<p>These functions are available as properties of the global MITHGrid object.    </p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><h2>MITHGrid.normalizeArgs</h2>

<p>Accepts the arguments passed in from the constructor and sorts out the various pieces.</p>

<p>Parameters:</p>

<ul>
<li>type - the namespace of the object initializer</li>
<li>types - an optional array of super namespaces</li>
<li>container - an optional DOM object managed by the object being initialized</li>
<li>options - an optional object holding configuration information for the object initializer</li>
</ul>

<p>Returns:</p>

<p>An array of three elements: a list of namespaces, the DOM container, and the options object.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">MITHGrid.normalizeArgs = </span><span class="nf">(args...) -&gt;</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>String
optional String/Array
optional DOM/String
optional Object
optional Function</p>
</td><td class="code"><div class="highlight"><pre>  
  <span class="nv">callbacks = </span><span class="p">[]</span>
  <span class="nv">t = </span><span class="nx">args</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>
  <span class="k">while</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isFunction</span> <span class="nx">t</span>
    <span class="nx">callbacks</span><span class="p">.</span><span class="nx">push</span> <span class="nx">t</span>
    <span class="nv">t = </span><span class="nx">args</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>
  
  <span class="k">if</span> <span class="nx">callbacks</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="nv">cb = </span><span class="nf">(t...) -&gt;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="nx">callbacks</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="nv">cb = </span><span class="nx">callbacks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">else</span>
    <span class="nv">cb = </span><span class="nf">(t...) -&gt;</span>
      <span class="k">for</span> <span class="nx">c</span> <span class="k">in</span> <span class="nx">callbacks</span>
        <span class="nx">c</span><span class="p">(</span><span class="nx">t</span><span class="p">...)</span>
  
  <span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isPlainObject</span> <span class="nx">t</span>
    <span class="nv">options = </span><span class="nx">t</span>
  <span class="k">else</span>
    <span class="nx">args</span><span class="p">.</span><span class="nx">push</span> <span class="nx">t</span>
    <span class="nv">options = </span><span class="p">{}</span>
  </pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>while the front of args is a string, we shift into the type array</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">types = </span><span class="p">[]</span>
  <span class="k">while</span> <span class="k">typeof</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;string&quot;</span>
    <span class="k">if</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">in</span> <span class="p">[</span><span class="s">&quot;</span><span class="err">#</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span><span class="p">]</span>
      <span class="k">break</span>
    <span class="nx">types</span><span class="p">.</span><span class="nx">push</span> <span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
  
  <span class="nv">types = </span><span class="nx">types</span><span class="p">.</span><span class="nx">reverse</span><span class="p">()</span>
  
  <span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nv">types = </span><span class="nx">types</span><span class="p">.</span><span class="nx">concat</span> <span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
  
  <span class="k">if</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="nv">container = </span><span class="nx">args</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>
  <span class="k">else</span>
    <span class="nv">container = </span><span class="kc">null</span>
      
  <span class="p">[</span> <span class="nx">types</span><span class="p">,</span> <span class="nx">container</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span> <span class="p">]</span>
  

<span class="nv">MITHGridDefaults = </span><span class="p">{}</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><h2>MITHGrid.defaults</h2>

<p>Allows default configuration values to be set for a given namespace.</p>

<p>Parameters:</p>

<ul>
<li>namespace - the namespace for which the defaults should be set</li>
<li>defaults - object containing default configuration information</li>
</ul>

<p>Returns: Nothing.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">MITHGrid.defaults = </span><span class="nf">(namespace, defaults) -&gt;</span>
  <span class="nx">MITHGridDefaults</span><span class="p">[</span><span class="nx">namespace</span><span class="p">]</span> <span class="o">or=</span> <span class="p">{}</span>
  <span class="nx">MITHGridDefaults</span><span class="p">[</span><span class="nx">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">MITHGridDefaults</span><span class="p">[</span><span class="nx">namespace</span><span class="p">],</span> <span class="nx">defaults</span><span class="p">)</span>
  </pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><h1>Synchonizer</h1>

<h2>MITHGrid.initSynchronizer</h2>

<p>Parameters:</p>

<ul>
<li>callbacks - an object with an optional "done" property providing a function to call when the counter is zero and
the done() method has been called.</li>
</ul>

<p>Returns:</p>

<p>The synchronizer object.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">MITHGrid.initSynchronizer = </span><span class="nf">(callbacks) -&gt;</span>
  <span class="nv">that = </span><span class="p">{}</span>
  <span class="nv">counter = </span><span class="mi">1</span>
  <span class="nv">done = </span><span class="kc">false</span>
  <span class="nv">fired = </span><span class="kc">false</span>
  <span class="k">if</span> <span class="o">!</span><span class="nx">callbacks</span><span class="p">.</span><span class="nx">done</span><span class="o">?</span>
    <span class="nv">that.increment = </span><span class="nf">() -&gt;</span>
    <span class="nv">that.decrement = </span><span class="nx">that</span><span class="p">.</span><span class="nx">increment</span>
    <span class="nv">that.done = </span><span class="nx">that</span><span class="p">.</span><span class="nx">increment</span>
    <span class="nv">that.add = </span><span class="nf">(v) -&gt;</span>
  <span class="k">else</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><h3>#increment</h3>

<p>Increments the synchronizer counter by one.</p>

<p>Returns:</p>

<p>The new value of the synchronizer counter.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">that.increment = </span><span class="nf">() -&gt;</span> <span class="nx">counter</span> <span class="o">+=</span> <span class="mi">1</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><h3>#add</h3>

<p>Adds the indicated number to the synchronizer.</p>

<p>Parameters:</p>

<ul>
<li>n - how much to add to the synchronizer counter</li>
</ul>

<p>Returns:</p>

<p>The new value of the synchronizer counter.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">that.add = </span><span class="nf">(n) -&gt;</span> <span class="nx">counter</span> <span class="o">+=</span> <span class="nx">n</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><h3>#decrement</h3>

<p>Decrements the synchronizer counter by one.</p>

<p>Returns:</p>

<p>The new value of the synchronizer counter.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">that.decrement = </span><span class="nf">() -&gt;</span>
      <span class="nx">counter</span> <span class="o">-=</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="nx">counter</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">done</span> <span class="o">and</span> <span class="o">!</span><span class="nx">fired</span>
        <span class="nv">fired = </span><span class="kc">true</span>
        <span class="nx">callbacks</span><span class="p">.</span><span class="nx">done</span>
      <span class="nx">counter</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><h3>#done</h3>

<p>Marks the synchronizer as done. The counter should monotonically decrease after this. Once it is zero, the
"done" callback will run.</p>

<p>Returns:</p>

<p>The new value of the synchronizer counter. If it is zero, then the "done" callback should be scheduled to run.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">that.done = </span><span class="nf">() -&gt;</span>
      <span class="nv">done = </span><span class="kc">true</span>
      <span class="nx">that</span><span class="p">.</span><span class="nx">decrement</span><span class="p">()</span>

  <span class="nx">that</span>
       </pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><h1>EventFirer</h1>

<h2>MITHGrid.initEventFirer</h2>

<p>Parameters:</p>

<ul>
<li>isPreventable - true if a listener can prevent further listeners from receiving the event</li>
<li>isUnicast - true if only one listener receives the event</li>
</ul>

<p>Returns:</p>

<p>The EventFirer object.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">MITHGrid.initEventFirer = </span><span class="nf">(isPreventable, isUnicast) -&gt;</span>
  <span class="nv">that = </span><span class="p">{}</span>
  <span class="nv">that.isPreventable = </span><span class="nx">isPreventable</span>
  <span class="nv">that.isUnicast = </span><span class="nx">isUnicast</span>
  <span class="nv">listeners = </span><span class="p">[]</span>
  </pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><h3>#addListener</h3>

<p>Adds a listener to an event.</p>

<p>Parameters:</p>

<ul>
<li>listener - function to call when event fires</li>
<li>namespace - optional namespace parameter that can be used to remove listeners</li>
</ul>

<p>Returns: Nothing.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">that.addListener = </span><span class="nf">(listener, namespace) -&gt;</span>
    <span class="nx">listeners</span><span class="p">.</span><span class="nx">push</span> <span class="p">[</span><span class="nx">listener</span><span class="p">,</span> <span class="nx">namespace</span><span class="p">]</span>
  </pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><h3>#removeListener</h3>

<p>Removes a listener (or set of listeners) from an event firer.</p>

<p>Parameters:</p>

<ul>
<li>listener - function or string to remove from list of listeners</li>
</ul>

<p>Returns: Nothing.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">that.removeListener = </span><span class="nf">(listener) -&gt;</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">listener</span> <span class="o">==</span> <span class="s">&quot;string&quot;</span>
      <span class="nv">listeners = </span><span class="p">(</span><span class="nx">l</span> <span class="k">for</span> <span class="nx">l</span> <span class="k">in</span> <span class="nx">listeners</span> <span class="k">when</span> <span class="nx">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">listener</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">listeners = </span><span class="p">(</span><span class="nx">l</span> <span class="k">for</span> <span class="nx">l</span> <span class="k">in</span> <span class="nx">listeners</span> <span class="k">when</span> <span class="nx">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">listener</span><span class="p">)</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><h3>#fire</h3>

<p>Fire's behavior depends on the type of event that is firing.</p>

<p>If a unicast event, then fire() will call the first listener. All other listeners will be ignored.</p>

<p>If the event is preventable, then fire() will call each listener in turn until either it runs out of
listeners or a listener returns the "false" value.</p>

<p>If the event is neither unicast nor preventable, then fire() will call each listener in turn. After all listeners
are called, it will return the "true" value.</p>

<p>Parameters:</p>

<ul>
<li>args... - all arguments are passed to the listener without modification</li>
</ul>

<p>Returns:</p>

<p>Fire's behavior depends on the type of event that is firing.</p>

<p>A unicast event will always return the value returned by the listener. If there are no listeners, it will return
the "true" value.</p>

<p>If the event is preventable, then fire() will return the "false" value if a listener returns "false". Otherwise,
it will return "true".</p>

<p>If neither unicast nor preventabe, then fire() will return "true" regardless of how many listeners are called.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="k">if</span> <span class="nx">isUnicast</span>
    <span class="nv">that.fire = </span><span class="nf">(args...) -&gt;</span>
      <span class="k">if</span> <span class="nx">listeners</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">try</span>
          <span class="nx">listeners</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">](</span><span class="nx">args</span><span class="p">...)</span>
        <span class="k">catch</span> <span class="nx">e</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">e</span>
      <span class="k">else</span>
        <span class="kc">true</span>
  <span class="k">else</span> <span class="k">if</span> <span class="nx">isPreventable</span>

    <span class="nv">that.fire = </span><span class="nf">(args...) -&gt;</span>
      <span class="nv">r = </span><span class="kc">true</span>
      <span class="k">for</span> <span class="nx">listener</span> <span class="k">in</span> <span class="nx">listeners</span>
        <span class="nv">l = </span><span class="nx">listener</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">try</span>
          <span class="nv">r = </span><span class="nx">l</span><span class="p">(</span><span class="nx">args</span><span class="p">...)</span>
        <span class="k">catch</span> <span class="nx">e</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">e</span>
        <span class="k">if</span> <span class="nx">r</span> <span class="o">==</span> <span class="kc">false</span>
          <span class="k">return</span> <span class="kc">false</span>
      <span class="kc">true</span>
  <span class="k">else</span>

    <span class="nv">that.fire = </span><span class="nf">(args...) -&gt;</span>
      <span class="k">for</span> <span class="nx">listener</span> <span class="k">in</span> <span class="nx">listeners</span>
        <span class="k">try</span>
          <span class="nx">listener</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="nx">args</span><span class="p">...)</span>
        <span class="k">catch</span> <span class="nx">e</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">listener</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">e</span>
      <span class="kc">true</span>
  

  
  <span class="nx">that</span>
  </pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><h1>Object Instances</h1>

<p>We use a local global to track how many objects we've initialized so we can assign a unique number
to each. This is useful when debugging to see if you are creating the right number of objects or too many.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">initViewCounter = </span><span class="mi">0</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><h2>MITHGrid.initInstance</h2>

<p>Initialize an object based on that-ism principles.</p>

<p>Parameters:</p>

<ul>
<li>namespace - the name of the object type being initialized</li>
<li>container - optional DOM object in which this object can place content</li>
<li>config - object containing configuration information for this object</li>
</ul>

<p>Returns:</p>

<p>The instantiated and initialized object.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">MITHGrid.initInstance = </span><span class="nf">(args...) -&gt;</span>
  <span class="p">[</span><span class="nx">namespace</span><span class="p">,</span> <span class="nx">container</span><span class="p">,</span> <span class="nx">config</span><span class="p">,</span> <span class="nx">cb</span><span class="p">]</span> <span class="o">=</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">normalizeArgs</span> <span class="nx">args</span><span class="p">...</span>
  <span class="nv">that = </span><span class="p">{}</span>
  <span class="nv">optionsArray = </span><span class="p">[</span> <span class="p">]</span>
  <span class="k">if</span> <span class="nx">namespace</span><span class="o">?</span> 
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">namespace</span> <span class="o">==</span> <span class="s">&quot;string&quot;</span>
      <span class="nv">namespace = </span><span class="p">[</span> <span class="nx">namespace</span> <span class="p">]</span>
    <span class="nx">namespace</span><span class="p">.</span><span class="nx">reverse</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">ns</span> <span class="k">in</span> <span class="nx">namespace</span>
      <span class="nv">bits = </span><span class="nx">ns</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
      <span class="nv">ns = </span><span class="nx">bits</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">MITHGridDefaults</span><span class="p">[</span><span class="nx">ns</span><span class="p">]</span><span class="o">?</span>
        <span class="nx">optionsArray</span><span class="p">.</span><span class="nx">push</span> <span class="nx">MITHGridDefaults</span><span class="p">[</span><span class="nx">ns</span><span class="p">]</span>
      <span class="k">while</span> <span class="nx">bits</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="nv">ns = </span><span class="nx">ns</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="nx">bits</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">MITHGridDefaults</span><span class="p">[</span><span class="nx">ns</span><span class="p">]</span><span class="o">?</span>
          <span class="nx">optionsArray</span><span class="p">.</span><span class="nx">push</span> <span class="nx">MITHGridDefaults</span><span class="p">[</span><span class="nx">ns</span><span class="p">]</span>
  <span class="k">if</span> <span class="nx">config</span><span class="o">?</span>
    <span class="nx">optionsArray</span><span class="p">.</span><span class="nx">push</span> <span class="nx">config</span>

  <span class="nv">options = </span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">optionsArray</span><span class="p">...)</span>
  
  <span class="nx">initViewCounter</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="nv">that.id = </span><span class="nx">initViewCounter</span>
  <span class="nv">that.options = </span><span class="nx">options</span>
  <span class="nv">that.container = </span><span class="nx">container</span>
  <span class="nv">that.events = </span><span class="p">{}</span>
  
  <span class="k">if</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">events</span><span class="o">?</span>
    <span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">c</span> <span class="k">of</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">events</span>
      <span class="k">if</span> <span class="nx">c</span><span class="o">?</span>
        <span class="k">if</span> <span class="k">typeof</span> <span class="nx">c</span> <span class="o">==</span> <span class="s">&quot;string&quot;</span>
          <span class="nv">c = </span><span class="p">[</span> <span class="nx">c</span> <span class="p">]</span>
      <span class="k">else</span>
        <span class="nv">c = </span><span class="p">[]</span>
      <span class="nx">that</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">initEventFirer</span><span class="p">(</span> <span class="p">(</span><span class="s">&quot;preventable&quot;</span> <span class="k">in</span> <span class="nx">c</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;unicast&quot;</span> <span class="k">in</span> <span class="nx">c</span><span class="p">))</span>
  <span class="k">if</span> <span class="nx">cb</span><span class="o">?</span>
    <span class="nx">cb</span> <span class="nx">that</span><span class="p">,</span> <span class="nx">container</span>
  <span class="nx">that</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><h1>Global Behaviors</h1>

<p>Sometimes, we need to do things on a global basis without having to create an object for each application, component,
or plugin.</p>

<h2>Window Resize Handler</h2>

<p>Use MITHGrid.events.onWindowResize.addListener( fn() { } ) to receive notifications when the browser window is resized.</p>
</td><td class="code"><div class="highlight"><pre><span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">namespace</span> <span class="s">&#39;events&#39;</span><span class="p">,</span> <span class="nf">(events) -&gt;</span>
  <span class="nv">events.onWindowResize = </span><span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">initEventFirer</span><span class="p">(</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span> <span class="p">)</span>
  
  <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span> <span class="o">-&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">resize</span> <span class="o">-&gt;</span>
      <span class="nx">setTimeout</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onWindowResize</span><span class="p">.</span><span class="nx">fire</span><span class="p">,</span> <span class="mi">0</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><h2>Mouse capture</h2>

<p>To receive notices of mouse movement and mouse button up events regardless of where they are in the document,
register appropriate functions.</p>
</td><td class="code"><div class="highlight"><pre><span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">namespace</span> <span class="s">&#39;mouse&#39;</span><span class="p">,</span> <span class="nf">(mouse) -&gt;</span>
  <span class="nv">mouseCaptureCallbacks = </span><span class="p">[]</span>
    
  <span class="nv">mouse.capture = </span><span class="nf">(cb) -&gt;</span>
    <span class="nv">oldCB = </span><span class="nx">mouseCaptureCallbacks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nx">mouseCaptureCallbacks</span><span class="p">.</span><span class="nx">unshift</span> <span class="nx">cb</span>
    <span class="k">if</span> <span class="nx">mouseCaptureCallbacks</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><p>it was zero before, so no bindings
$(document).mousedown (e) ->
e.preventDefault()
mouseCaptureCallbacks[0].call e, "mousedown"</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">mousemove</span> <span class="nf">(e) -&gt;</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
        <span class="nx">mouseCaptureCallbacks</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">call</span> <span class="nx">e</span><span class="p">,</span> <span class="s">&quot;mousemove&quot;</span>
      <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">mouseup</span> <span class="nf">(e) -&gt;</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
        <span class="nx">mouseCaptureCallbacks</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">call</span> <span class="nx">e</span><span class="p">,</span> <span class="s">&quot;mouseup&quot;</span>
    <span class="nx">oldCB</span>
  
  <span class="nv">mouse.uncapture = </span><span class="o">-&gt;</span>
    <span class="nv">oldCB = </span><span class="nx">mouseCaptureCallbacks</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">mouseCaptureCallbacks</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span></pre></div></td></tr><tr id="section-27"><td class="docs"><div class="pilwrap"><a href="#section-27" class="pilcrow">&#182;</a></div><p>$(document).unbind "mousedown"</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">unbind</span> <span class="s">&quot;mousemove&quot;</span>
      <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">unbind</span> <span class="s">&quot;mouseup&quot;</span>
    <span class="nx">oldCB</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Sat Apr 28 2012 20:09:58 GMT-0400 (EDT)  </div><div id="projectname"><a href="../index.html">MITHgrid</a></div></div>